--选择训练集的role_id以及label
create table raw_data --关联后的特征总表，用于拆分训练集和测试集   
    as
select 
    a.role_id,
    if(b.role_id is NULL, 0, 1) as label
from 
(
    select 
    role_id 
    from 
    src_userinfo_day
    where dt>=20150514 and dt<=20150520 and role_id!='-1' 
    group by role_id
    having MAX(role_level)>=40
) a  -- 20150514~20150520期间40级以上活跃玩家
left outer join
(
    select 
    role_id
    from 
    src_itembuy_day
    where dt>=20150521 and dt<=20150527 and item_id='583003' 
    group by role_id
) b  -- 20150521-20150527期间这些玩家是否购买作为标签
on a.role_id = b.role_id; 

--选择测试集的role_id
create table role_id_test
    as
select
    role_id
from 
    src_userinfo_day 
where
    dt>=20150521 and dt <=20150527 and role_id!='-1' 
group by 
    role_id 
having 
    MAX(role_level)>=40;

        --比较登录日志登录次数与userinfo区别
        select
            a.role_id,
            a.login_times,
            b.info_times
        from 
        (select role_id, 
            count(login_time) as login_times
        from 
            src_loginrole_day
        where
            login_time >= unix_timestamp('2015-05-14 00:00:00')
            and login_time <= unix_timestamp('2015-05-21 00:00:00')
            and role_id!='-1'
        group by
            role_id)a
        left join
        (select role_id,
            count(*) as info_times
        from
            src_userinfo_day
        where
            dt>=20150521 and dt <=20150527 and role_id!='-1' 
        group by 
            role_id)b
        on a.role_id = b.role_id
        limit 100;

        --统计第一周登陆次数
        create table login_times_14_20
            as
        select
            b.role_id as role_id,
            a.login_times as login_times     
        from 
        (select role_id, 
            count(login_time) as login_times
        from 
            src_loginrole_day
        where
            login_time >= unix_timestamp('2015-05-14 00:00:00')
            and login_time <= unix_timestamp('2015-05-21 00:00:00')
            and role_id!='-1'
        group by
            role_id)a
        right outer join
            (select * from raw_data)b
        on a.role_id = b.role_id;

        --统计第二周登陆次数
        create table login_times_21_27
            as
        select
            b.role_id as role_id,
            a.login_times as login_times     
        from 
        (select role_id, 
            count(login_time) as login_times
        from 
            src_loginrole_day
        where
            login_time >= unix_timestamp('2015-05-21 00:00:00')
            and login_time <= unix_timestamp('2015-05-28 00:00:00')
            and role_id!='-1'
        group by
            role_id)a
        right outer join
            (select * from role_id_test)b
        on a.role_id = b.role_id;

        --统计创建账号距离20150528多少小时
        create table time_after_create
            as 
        select
            role_id,
            max(pmod(unix_timestamp('2015-05-28 00:00:00')-create_time, 3600)) as time_after_create
        from
            src_LoginRole_day
        group by
            role_id;

--汇总玩家登陆日志数据,可以处理多列,第一周
create table login_day_1
    as
select 
    a.role_id,
    concat_ws(',', collect_set(distinct a.device_model)) as device_model,
    concat_ws(',', collect_set(distinct a.os_name)) as os_name,
    concat_ws(',', collect_set(distinct a.os_ver)) as os_ver,
    concat_ws(',', collect_set(distinct a.app_channel)) as app_channel,
    concat_ws(',', collect_set(distinct a.app_ver)) as app_ver,
    concat_ws(',', collect_set(distinct a.server)) as server,
    count(login_time) as login_times_week,
    max(pmod(unix_timestamp('2015-05-21 00:00:00')-create_time,3600)) as time_after_create--到最后预测时间创建账号过了几个小时
from 
(select *
from (
       select src_LoginRole_day.*, ROW_NUMBER() OVER(PARTITION BY role_id, device_model, os_name, os_ver, app_channel, app_ver, server order by 1) RN
       from src_LoginRole_day
       where
           login_time >= unix_timestamp('2015-05-14 00:00:00')
           and login_time <= unix_timestamp('2015-05-21 00:00:00')
           and role_id!='-1'
)a
 WHERE a.RN=1)a
group by a.role_id;

--汇总玩家登陆日志数据,可以处理多列,第二周
create table login_day_2
    as
select 
    a.role_id,
    concat_ws(',', collect_set(distinct a.device_model)) as device_model,
    concat_ws(',', collect_set(distinct a.os_name)) as os_name,
    concat_ws(',', collect_set(distinct a.os_ver)) as os_ver,
    concat_ws(',', collect_set(distinct a.app_channel)) as app_channel,
    concat_ws(',', collect_set(distinct a.app_ver)) as app_ver,
    concat_ws(',', collect_set(distinct a.server)) as server,
    count(login_time) as login_times_week,
    max(pmod(unix_timestamp('2015-05-28 00:00:00')-create_time,3600)) as time_after_create--到最后预测时间创建账号过了几个小时
from 
(select *
from (
       select src_LoginRole_day.*, ROW_NUMBER() OVER(PARTITION BY role_id, device_model, os_name, os_ver, app_channel, app_ver, server order by 1) RN
       from src_LoginRole_day
       where
           login_time >= unix_timestamp('2015-05-21 00:00:00')
           and login_time <= unix_timestamp('2015-05-28 00:00:00')
           and role_id!='-1'
)a
 WHERE a.RN=1)a
group by a.role_id;

--统计每天购买不同商品花了多少元宝 第一周
create table items_buy_day_1 as
select a.role_id as role_id, 
max(a.dt20150514item500000) as dt20150514item500000, max(a.dt20150514item500001) as dt20150514item500001, max(a.dt20150514item500002) as dt20150514item500002, max(a.dt20150514item510000) as dt20150514item510000, max(a.dt20150514item510001) as dt20150514item510001, max(a.dt20150514item510002) as dt20150514item510002, max(a.dt20150514item510003) as dt20150514item510003, max(a.dt20150514item510007) as dt20150514item510007, max(a.dt20150514item520091) as dt20150514item520091, max(a.dt20150514item525002) as dt20150514item525002, max(a.dt20150514item581000) as dt20150514item581000, max(a.dt20150514item581001) as dt20150514item581001, max(a.dt20150514item583001) as dt20150514item583001, max(a.dt20150514item583002) as dt20150514item583002, max(a.dt20150514item583003) as dt20150514item583003, max(a.dt20150514item584003) as dt20150514item584003, max(a.dt20150514item590603) as dt20150514item590603, max(a.dt20150515item500000) as dt20150515item500000, max(a.dt20150515item500001) as dt20150515item500001, max(a.dt20150515item500002) as dt20150515item500002, max(a.dt20150515item510000) as dt20150515item510000, max(a.dt20150515item510001) as dt20150515item510001, max(a.dt20150515item510002) as dt20150515item510002, max(a.dt20150515item510003) as dt20150515item510003, max(a.dt20150515item510007) as dt20150515item510007, max(a.dt20150515item520091) as dt20150515item520091, max(a.dt20150515item525002) as dt20150515item525002, max(a.dt20150515item581000) as dt20150515item581000, max(a.dt20150515item581001) as dt20150515item581001, max(a.dt20150515item583001) as dt20150515item583001, max(a.dt20150515item583002) as dt20150515item583002, max(a.dt20150515item583003) as dt20150515item583003, max(a.dt20150515item584003) as dt20150515item584003, max(a.dt20150515item590603) as dt20150515item590603, max(a.dt20150516item500000) as dt20150516item500000, max(a.dt20150516item500001) as dt20150516item500001, max(a.dt20150516item500002) as dt20150516item500002, max(a.dt20150516item510000) as dt20150516item510000, max(a.dt20150516item510001) as dt20150516item510001, max(a.dt20150516item510002) as dt20150516item510002, max(a.dt20150516item510003) as dt20150516item510003, max(a.dt20150516item510007) as dt20150516item510007, max(a.dt20150516item520091) as dt20150516item520091, max(a.dt20150516item525002) as dt20150516item525002, max(a.dt20150516item581000) as dt20150516item581000, max(a.dt20150516item581001) as dt20150516item581001, max(a.dt20150516item583001) as dt20150516item583001, max(a.dt20150516item583002) as dt20150516item583002, max(a.dt20150516item583003) as dt20150516item583003, max(a.dt20150516item584003) as dt20150516item584003, max(a.dt20150516item590603) as dt20150516item590603, max(a.dt20150517item500000) as dt20150517item500000, max(a.dt20150517item500001) as dt20150517item500001, max(a.dt20150517item500002) as dt20150517item500002, max(a.dt20150517item510000) as dt20150517item510000, max(a.dt20150517item510001) as dt20150517item510001, max(a.dt20150517item510002) as dt20150517item510002, max(a.dt20150517item510003) as dt20150517item510003, max(a.dt20150517item510007) as dt20150517item510007, max(a.dt20150517item520091) as dt20150517item520091, max(a.dt20150517item525002) as dt20150517item525002, max(a.dt20150517item581000) as dt20150517item581000, max(a.dt20150517item581001) as dt20150517item581001, max(a.dt20150517item583001) as dt20150517item583001, max(a.dt20150517item583002) as dt20150517item583002, max(a.dt20150517item583003) as dt20150517item583003, max(a.dt20150517item584003) as dt20150517item584003, max(a.dt20150517item590603) as dt20150517item590603, max(a.dt20150518item500000) as dt20150518item500000, max(a.dt20150518item500001) as dt20150518item500001, max(a.dt20150518item500002) as dt20150518item500002, max(a.dt20150518item510000) as dt20150518item510000, max(a.dt20150518item510001) as dt20150518item510001, max(a.dt20150518item510002) as dt20150518item510002, max(a.dt20150518item510003) as dt20150518item510003, max(a.dt20150518item510007) as dt20150518item510007, max(a.dt20150518item520091) as dt20150518item520091, max(a.dt20150518item525002) as dt20150518item525002, max(a.dt20150518item581000) as dt20150518item581000, max(a.dt20150518item581001) as dt20150518item581001, max(a.dt20150518item583001) as dt20150518item583001, max(a.dt20150518item583002) as dt20150518item583002, max(a.dt20150518item583003) as dt20150518item583003, max(a.dt20150518item584003) as dt20150518item584003, max(a.dt20150518item590603) as dt20150518item590603, max(a.dt20150519item500000) as dt20150519item500000, max(a.dt20150519item500001) as dt20150519item500001, max(a.dt20150519item500002) as dt20150519item500002, max(a.dt20150519item510000) as dt20150519item510000, max(a.dt20150519item510001) as dt20150519item510001, max(a.dt20150519item510002) as dt20150519item510002, max(a.dt20150519item510003) as dt20150519item510003, max(a.dt20150519item510007) as dt20150519item510007, max(a.dt20150519item520091) as dt20150519item520091, max(a.dt20150519item525002) as dt20150519item525002, max(a.dt20150519item581000) as dt20150519item581000, max(a.dt20150519item581001) as dt20150519item581001, max(a.dt20150519item583001) as dt20150519item583001, max(a.dt20150519item583002) as dt20150519item583002, max(a.dt20150519item583003) as dt20150519item583003, max(a.dt20150519item584003) as dt20150519item584003, max(a.dt20150519item590603) as dt20150519item590603, max(a.dt20150520item500000) as dt20150520item500000, max(a.dt20150520item500001) as dt20150520item500001, max(a.dt20150520item500002) as dt20150520item500002, max(a.dt20150520item510000) as dt20150520item510000, max(a.dt20150520item510001) as dt20150520item510001, max(a.dt20150520item510002) as dt20150520item510002, max(a.dt20150520item510003) as dt20150520item510003, max(a.dt20150520item510007) as dt20150520item510007, max(a.dt20150520item520091) as dt20150520item520091, max(a.dt20150520item525002) as dt20150520item525002, max(a.dt20150520item581000) as dt20150520item581000, max(a.dt20150520item581001) as dt20150520item581001, max(a.dt20150520item583001) as dt20150520item583001, max(a.dt20150520item583002) as dt20150520item583002, max(a.dt20150520item583003) as dt20150520item583003, max(a.dt20150520item584003) as dt20150520item584003, max(a.dt20150520item590603) as dt20150520item590603
from (
select role_id,
case dt when '20150514' then
    case item_id when '500000' then sum(yuanbao) end
    end as dt20150514item500000,
case dt when '20150514' then
    case item_id when '500001' then sum(yuanbao) end
    end as dt20150514item500001,
case dt when '20150514' then
    case item_id when '500002' then sum(yuanbao) end
    end as dt20150514item500002,
case dt when '20150514' then
    case item_id when '510000' then sum(yuanbao) end
    end as dt20150514item510000,
case dt when '20150514' then
    case item_id when '510001' then sum(yuanbao) end
    end as dt20150514item510001,
case dt when '20150514' then
    case item_id when '510002' then sum(yuanbao) end
    end as dt20150514item510002,
case dt when '20150514' then
    case item_id when '510003' then sum(yuanbao) end
    end as dt20150514item510003,
case dt when '20150514' then
    case item_id when '510007' then sum(yuanbao) end
    end as dt20150514item510007,
case dt when '20150514' then
    case item_id when '520091' then sum(yuanbao) end
    end as dt20150514item520091,
case dt when '20150514' then
    case item_id when '525002' then sum(yuanbao) end
    end as dt20150514item525002,
case dt when '20150514' then
    case item_id when '581000' then sum(yuanbao) end
    end as dt20150514item581000,
case dt when '20150514' then
    case item_id when '581001' then sum(yuanbao) end
    end as dt20150514item581001,
case dt when '20150514' then
    case item_id when '583001' then sum(yuanbao) end
    end as dt20150514item583001,
case dt when '20150514' then
    case item_id when '583002' then sum(yuanbao) end
    end as dt20150514item583002,
case dt when '20150514' then
    case item_id when '583003' then sum(yuanbao) end
    end as dt20150514item583003,
case dt when '20150514' then
    case item_id when '584003' then sum(yuanbao) end
    end as dt20150514item584003,
case dt when '20150514' then
    case item_id when '590603' then sum(yuanbao) end
    end as dt20150514item590603,
case dt when '20150515' then
    case item_id when '500000' then sum(yuanbao) end
    end as dt20150515item500000,
case dt when '20150515' then
    case item_id when '500001' then sum(yuanbao) end
    end as dt20150515item500001,
case dt when '20150515' then
    case item_id when '500002' then sum(yuanbao) end
    end as dt20150515item500002,
case dt when '20150515' then
    case item_id when '510000' then sum(yuanbao) end
    end as dt20150515item510000,
case dt when '20150515' then
    case item_id when '510001' then sum(yuanbao) end
    end as dt20150515item510001,
case dt when '20150515' then
    case item_id when '510002' then sum(yuanbao) end
    end as dt20150515item510002,
case dt when '20150515' then
    case item_id when '510003' then sum(yuanbao) end
    end as dt20150515item510003,
case dt when '20150515' then
    case item_id when '510007' then sum(yuanbao) end
    end as dt20150515item510007,
case dt when '20150515' then
    case item_id when '520091' then sum(yuanbao) end
    end as dt20150515item520091,
case dt when '20150515' then
    case item_id when '525002' then sum(yuanbao) end
    end as dt20150515item525002,
case dt when '20150515' then
    case item_id when '581000' then sum(yuanbao) end
    end as dt20150515item581000,
case dt when '20150515' then
    case item_id when '581001' then sum(yuanbao) end
    end as dt20150515item581001,
case dt when '20150515' then
    case item_id when '583001' then sum(yuanbao) end
    end as dt20150515item583001,
case dt when '20150515' then
    case item_id when '583002' then sum(yuanbao) end
    end as dt20150515item583002,
case dt when '20150515' then
    case item_id when '583003' then sum(yuanbao) end
    end as dt20150515item583003,
case dt when '20150515' then
    case item_id when '584003' then sum(yuanbao) end
    end as dt20150515item584003,
case dt when '20150515' then
    case item_id when '590603' then sum(yuanbao) end
    end as dt20150515item590603,
case dt when '20150516' then
    case item_id when '500000' then sum(yuanbao) end
    end as dt20150516item500000,
case dt when '20150516' then
    case item_id when '500001' then sum(yuanbao) end
    end as dt20150516item500001,
case dt when '20150516' then
    case item_id when '500002' then sum(yuanbao) end
    end as dt20150516item500002,
case dt when '20150516' then
    case item_id when '510000' then sum(yuanbao) end
    end as dt20150516item510000,
case dt when '20150516' then
    case item_id when '510001' then sum(yuanbao) end
    end as dt20150516item510001,
case dt when '20150516' then
    case item_id when '510002' then sum(yuanbao) end
    end as dt20150516item510002,
case dt when '20150516' then
    case item_id when '510003' then sum(yuanbao) end
    end as dt20150516item510003,
case dt when '20150516' then
    case item_id when '510007' then sum(yuanbao) end
    end as dt20150516item510007,
case dt when '20150516' then
    case item_id when '520091' then sum(yuanbao) end
    end as dt20150516item520091,
case dt when '20150516' then
    case item_id when '525002' then sum(yuanbao) end
    end as dt20150516item525002,
case dt when '20150516' then
    case item_id when '581000' then sum(yuanbao) end
    end as dt20150516item581000,
case dt when '20150516' then
    case item_id when '581001' then sum(yuanbao) end
    end as dt20150516item581001,
case dt when '20150516' then
    case item_id when '583001' then sum(yuanbao) end
    end as dt20150516item583001,
case dt when '20150516' then
    case item_id when '583002' then sum(yuanbao) end
    end as dt20150516item583002,
case dt when '20150516' then
    case item_id when '583003' then sum(yuanbao) end
    end as dt20150516item583003,
case dt when '20150516' then
    case item_id when '584003' then sum(yuanbao) end
    end as dt20150516item584003,
case dt when '20150516' then
    case item_id when '590603' then sum(yuanbao) end
    end as dt20150516item590603,
case dt when '20150517' then
    case item_id when '500000' then sum(yuanbao) end
    end as dt20150517item500000,
case dt when '20150517' then
    case item_id when '500001' then sum(yuanbao) end
    end as dt20150517item500001,
case dt when '20150517' then
    case item_id when '500002' then sum(yuanbao) end
    end as dt20150517item500002,
case dt when '20150517' then
    case item_id when '510000' then sum(yuanbao) end
    end as dt20150517item510000,
case dt when '20150517' then
    case item_id when '510001' then sum(yuanbao) end
    end as dt20150517item510001,
case dt when '20150517' then
    case item_id when '510002' then sum(yuanbao) end
    end as dt20150517item510002,
case dt when '20150517' then
    case item_id when '510003' then sum(yuanbao) end
    end as dt20150517item510003,
case dt when '20150517' then
    case item_id when '510007' then sum(yuanbao) end
    end as dt20150517item510007,
case dt when '20150517' then
    case item_id when '520091' then sum(yuanbao) end
    end as dt20150517item520091,
case dt when '20150517' then
    case item_id when '525002' then sum(yuanbao) end
    end as dt20150517item525002,
case dt when '20150517' then
    case item_id when '581000' then sum(yuanbao) end
    end as dt20150517item581000,
case dt when '20150517' then
    case item_id when '581001' then sum(yuanbao) end
    end as dt20150517item581001,
case dt when '20150517' then
    case item_id when '583001' then sum(yuanbao) end
    end as dt20150517item583001,
case dt when '20150517' then
    case item_id when '583002' then sum(yuanbao) end
    end as dt20150517item583002,
case dt when '20150517' then
    case item_id when '583003' then sum(yuanbao) end
    end as dt20150517item583003,
case dt when '20150517' then
    case item_id when '584003' then sum(yuanbao) end
    end as dt20150517item584003,
case dt when '20150517' then
    case item_id when '590603' then sum(yuanbao) end
    end as dt20150517item590603,
case dt when '20150518' then
    case item_id when '500000' then sum(yuanbao) end
    end as dt20150518item500000,
case dt when '20150518' then
    case item_id when '500001' then sum(yuanbao) end
    end as dt20150518item500001,
case dt when '20150518' then
    case item_id when '500002' then sum(yuanbao) end
    end as dt20150518item500002,
case dt when '20150518' then
    case item_id when '510000' then sum(yuanbao) end
    end as dt20150518item510000,
case dt when '20150518' then
    case item_id when '510001' then sum(yuanbao) end
    end as dt20150518item510001,
case dt when '20150518' then
    case item_id when '510002' then sum(yuanbao) end
    end as dt20150518item510002,
case dt when '20150518' then
    case item_id when '510003' then sum(yuanbao) end
    end as dt20150518item510003,
case dt when '20150518' then
    case item_id when '510007' then sum(yuanbao) end
    end as dt20150518item510007,
case dt when '20150518' then
    case item_id when '520091' then sum(yuanbao) end
    end as dt20150518item520091,
case dt when '20150518' then
    case item_id when '525002' then sum(yuanbao) end
    end as dt20150518item525002,
case dt when '20150518' then
    case item_id when '581000' then sum(yuanbao) end
    end as dt20150518item581000,
case dt when '20150518' then
    case item_id when '581001' then sum(yuanbao) end
    end as dt20150518item581001,
case dt when '20150518' then
    case item_id when '583001' then sum(yuanbao) end
    end as dt20150518item583001,
case dt when '20150518' then
    case item_id when '583002' then sum(yuanbao) end
    end as dt20150518item583002,
case dt when '20150518' then
    case item_id when '583003' then sum(yuanbao) end
    end as dt20150518item583003,
case dt when '20150518' then
    case item_id when '584003' then sum(yuanbao) end
    end as dt20150518item584003,
case dt when '20150518' then
    case item_id when '590603' then sum(yuanbao) end
    end as dt20150518item590603,
case dt when '20150519' then
    case item_id when '500000' then sum(yuanbao) end
    end as dt20150519item500000,
case dt when '20150519' then
    case item_id when '500001' then sum(yuanbao) end
    end as dt20150519item500001,
case dt when '20150519' then
    case item_id when '500002' then sum(yuanbao) end
    end as dt20150519item500002,
case dt when '20150519' then
    case item_id when '510000' then sum(yuanbao) end
    end as dt20150519item510000,
case dt when '20150519' then
    case item_id when '510001' then sum(yuanbao) end
    end as dt20150519item510001,
case dt when '20150519' then
    case item_id when '510002' then sum(yuanbao) end
    end as dt20150519item510002,
case dt when '20150519' then
    case item_id when '510003' then sum(yuanbao) end
    end as dt20150519item510003,
case dt when '20150519' then
    case item_id when '510007' then sum(yuanbao) end
    end as dt20150519item510007,
case dt when '20150519' then
    case item_id when '520091' then sum(yuanbao) end
    end as dt20150519item520091,
case dt when '20150519' then
    case item_id when '525002' then sum(yuanbao) end
    end as dt20150519item525002,
case dt when '20150519' then
    case item_id when '581000' then sum(yuanbao) end
    end as dt20150519item581000,
case dt when '20150519' then
    case item_id when '581001' then sum(yuanbao) end
    end as dt20150519item581001,
case dt when '20150519' then
    case item_id when '583001' then sum(yuanbao) end
    end as dt20150519item583001,
case dt when '20150519' then
    case item_id when '583002' then sum(yuanbao) end
    end as dt20150519item583002,
case dt when '20150519' then
    case item_id when '583003' then sum(yuanbao) end
    end as dt20150519item583003,
case dt when '20150519' then
    case item_id when '584003' then sum(yuanbao) end
    end as dt20150519item584003,
case dt when '20150519' then
    case item_id when '590603' then sum(yuanbao) end
    end as dt20150519item590603,
case dt when '20150520' then
    case item_id when '500000' then sum(yuanbao) end
    end as dt20150520item500000,
case dt when '20150520' then
    case item_id when '500001' then sum(yuanbao) end
    end as dt20150520item500001,
case dt when '20150520' then
    case item_id when '500002' then sum(yuanbao) end
    end as dt20150520item500002,
case dt when '20150520' then
    case item_id when '510000' then sum(yuanbao) end
    end as dt20150520item510000,
case dt when '20150520' then
    case item_id when '510001' then sum(yuanbao) end
    end as dt20150520item510001,
case dt when '20150520' then
    case item_id when '510002' then sum(yuanbao) end
    end as dt20150520item510002,
case dt when '20150520' then
    case item_id when '510003' then sum(yuanbao) end
    end as dt20150520item510003,
case dt when '20150520' then
    case item_id when '510007' then sum(yuanbao) end
    end as dt20150520item510007,
case dt when '20150520' then
    case item_id when '520091' then sum(yuanbao) end
    end as dt20150520item520091,
case dt when '20150520' then
    case item_id when '525002' then sum(yuanbao) end
    end as dt20150520item525002,
case dt when '20150520' then
    case item_id when '581000' then sum(yuanbao) end
    end as dt20150520item581000,
case dt when '20150520' then
    case item_id when '581001' then sum(yuanbao) end
    end as dt20150520item581001,
case dt when '20150520' then
    case item_id when '583001' then sum(yuanbao) end
    end as dt20150520item583001,
case dt when '20150520' then
    case item_id when '583002' then sum(yuanbao) end
    end as dt20150520item583002,
case dt when '20150520' then
    case item_id when '583003' then sum(yuanbao) end
    end as dt20150520item583003,
case dt when '20150520' then
    case item_id when '584003' then sum(yuanbao) end
    end as dt20150520item584003,
case dt when '20150520' then
    case item_id when '590603' then sum(yuanbao) end
    end as dt20150520item590603
from src_Itembuy_day
group by role_id, dt, item_id
)a
group by role_id;

--统计每天购买不同商品花了多少元宝 第二周
create table items_buy_day_2 as
select a.role_id as role_id, 
max(a.dt20150521item500000) as dt20150521item500000, max(a.dt20150521item500001) as dt20150521item500001, max(a.dt20150521item500002) as dt20150521item500002, max(a.dt20150521item510000) as dt20150521item510000, max(a.dt20150521item510001) as dt20150521item510001, max(a.dt20150521item510002) as dt20150521item510002, max(a.dt20150521item510003) as dt20150521item510003, max(a.dt20150521item510007) as dt20150521item510007, max(a.dt20150521item520091) as dt20150521item520091, max(a.dt20150521item525002) as dt20150521item525002, max(a.dt20150521item581000) as dt20150521item581000, max(a.dt20150521item581001) as dt20150521item581001, max(a.dt20150521item583001) as dt20150521item583001, max(a.dt20150521item583002) as dt20150521item583002, max(a.dt20150521item583003) as dt20150521item583003, max(a.dt20150521item584003) as dt20150521item584003, max(a.dt20150521item590603) as dt20150521item590603, max(a.dt20150522item500000) as dt20150522item500000, max(a.dt20150522item500001) as dt20150522item500001, max(a.dt20150522item500002) as dt20150522item500002, max(a.dt20150522item510000) as dt20150522item510000, max(a.dt20150522item510001) as dt20150522item510001, max(a.dt20150522item510002) as dt20150522item510002, max(a.dt20150522item510003) as dt20150522item510003, max(a.dt20150522item510007) as dt20150522item510007, max(a.dt20150522item520091) as dt20150522item520091, max(a.dt20150522item525002) as dt20150522item525002, max(a.dt20150522item581000) as dt20150522item581000, max(a.dt20150522item581001) as dt20150522item581001, max(a.dt20150522item583001) as dt20150522item583001, max(a.dt20150522item583002) as dt20150522item583002, max(a.dt20150522item583003) as dt20150522item583003, max(a.dt20150522item584003) as dt20150522item584003, max(a.dt20150522item590603) as dt20150522item590603, max(a.dt20150523item500000) as dt20150523item500000, max(a.dt20150523item500001) as dt20150523item500001, max(a.dt20150523item500002) as dt20150523item500002, max(a.dt20150523item510000) as dt20150523item510000, max(a.dt20150523item510001) as dt20150523item510001, max(a.dt20150523item510002) as dt20150523item510002, max(a.dt20150523item510003) as dt20150523item510003, max(a.dt20150523item510007) as dt20150523item510007, max(a.dt20150523item520091) as dt20150523item520091, max(a.dt20150523item525002) as dt20150523item525002, max(a.dt20150523item581000) as dt20150523item581000, max(a.dt20150523item581001) as dt20150523item581001, max(a.dt20150523item583001) as dt20150523item583001, max(a.dt20150523item583002) as dt20150523item583002, max(a.dt20150523item583003) as dt20150523item583003, max(a.dt20150523item584003) as dt20150523item584003, max(a.dt20150523item590603) as dt20150523item590603, max(a.dt20150524item500000) as dt20150524item500000, max(a.dt20150524item500001) as dt20150524item500001, max(a.dt20150524item500002) as dt20150524item500002, max(a.dt20150524item510000) as dt20150524item510000, max(a.dt20150524item510001) as dt20150524item510001, max(a.dt20150524item510002) as dt20150524item510002, max(a.dt20150524item510003) as dt20150524item510003, max(a.dt20150524item510007) as dt20150524item510007, max(a.dt20150524item520091) as dt20150524item520091, max(a.dt20150524item525002) as dt20150524item525002, max(a.dt20150524item581000) as dt20150524item581000, max(a.dt20150524item581001) as dt20150524item581001, max(a.dt20150524item583001) as dt20150524item583001, max(a.dt20150524item583002) as dt20150524item583002, max(a.dt20150524item583003) as dt20150524item583003, max(a.dt20150524item584003) as dt20150524item584003, max(a.dt20150524item590603) as dt20150524item590603, max(a.dt20150525item500000) as dt20150525item500000, max(a.dt20150525item500001) as dt20150525item500001, max(a.dt20150525item500002) as dt20150525item500002, max(a.dt20150525item510000) as dt20150525item510000, max(a.dt20150525item510001) as dt20150525item510001, max(a.dt20150525item510002) as dt20150525item510002, max(a.dt20150525item510003) as dt20150525item510003, max(a.dt20150525item510007) as dt20150525item510007, max(a.dt20150525item520091) as dt20150525item520091, max(a.dt20150525item525002) as dt20150525item525002, max(a.dt20150525item581000) as dt20150525item581000, max(a.dt20150525item581001) as dt20150525item581001, max(a.dt20150525item583001) as dt20150525item583001, max(a.dt20150525item583002) as dt20150525item583002, max(a.dt20150525item583003) as dt20150525item583003, max(a.dt20150525item584003) as dt20150525item584003, max(a.dt20150525item590603) as dt20150525item590603, max(a.dt20150526item500000) as dt20150526item500000, max(a.dt20150526item500001) as dt20150526item500001, max(a.dt20150526item500002) as dt20150526item500002, max(a.dt20150526item510000) as dt20150526item510000, max(a.dt20150526item510001) as dt20150526item510001, max(a.dt20150526item510002) as dt20150526item510002, max(a.dt20150526item510003) as dt20150526item510003, max(a.dt20150526item510007) as dt20150526item510007, max(a.dt20150526item520091) as dt20150526item520091, max(a.dt20150526item525002) as dt20150526item525002, max(a.dt20150526item581000) as dt20150526item581000, max(a.dt20150526item581001) as dt20150526item581001, max(a.dt20150526item583001) as dt20150526item583001, max(a.dt20150526item583002) as dt20150526item583002, max(a.dt20150526item583003) as dt20150526item583003, max(a.dt20150526item584003) as dt20150526item584003, max(a.dt20150526item590603) as dt20150526item590603, max(a.dt20150527item500000) as dt20150527item500000, max(a.dt20150527item500001) as dt20150527item500001, max(a.dt20150527item500002) as dt20150527item500002, max(a.dt20150527item510000) as dt20150527item510000, max(a.dt20150527item510001) as dt20150527item510001, max(a.dt20150527item510002) as dt20150527item510002, max(a.dt20150527item510003) as dt20150527item510003, max(a.dt20150527item510007) as dt20150527item510007, max(a.dt20150527item520091) as dt20150527item520091, max(a.dt20150527item525002) as dt20150527item525002, max(a.dt20150527item581000) as dt20150527item581000, max(a.dt20150527item581001) as dt20150527item581001, max(a.dt20150527item583001) as dt20150527item583001, max(a.dt20150527item583002) as dt20150527item583002, max(a.dt20150527item583003) as dt20150527item583003, max(a.dt20150527item584003) as dt20150527item584003, max(a.dt20150527item590603) as dt20150527item590603
from (
select role_id,
case dt when '20150521' then
    case item_id when '500000' then sum(yuanbao) end
    end as dt20150521item500000,
case dt when '20150521' then
    case item_id when '500001' then sum(yuanbao) end
    end as dt20150521item500001,
case dt when '20150521' then
    case item_id when '500002' then sum(yuanbao) end
    end as dt20150521item500002,
case dt when '20150521' then
    case item_id when '510000' then sum(yuanbao) end
    end as dt20150521item510000,
case dt when '20150521' then
    case item_id when '510001' then sum(yuanbao) end
    end as dt20150521item510001,
case dt when '20150521' then
    case item_id when '510002' then sum(yuanbao) end
    end as dt20150521item510002,
case dt when '20150521' then
    case item_id when '510003' then sum(yuanbao) end
    end as dt20150521item510003,
case dt when '20150521' then
    case item_id when '510007' then sum(yuanbao) end
    end as dt20150521item510007,
case dt when '20150521' then
    case item_id when '520091' then sum(yuanbao) end
    end as dt20150521item520091,
case dt when '20150521' then
    case item_id when '525002' then sum(yuanbao) end
    end as dt20150521item525002,
case dt when '20150521' then
    case item_id when '581000' then sum(yuanbao) end
    end as dt20150521item581000,
case dt when '20150521' then
    case item_id when '581001' then sum(yuanbao) end
    end as dt20150521item581001,
case dt when '20150521' then
    case item_id when '583001' then sum(yuanbao) end
    end as dt20150521item583001,
case dt when '20150521' then
    case item_id when '583002' then sum(yuanbao) end
    end as dt20150521item583002,
case dt when '20150521' then
    case item_id when '583003' then sum(yuanbao) end
    end as dt20150521item583003,
case dt when '20150521' then
    case item_id when '584003' then sum(yuanbao) end
    end as dt20150521item584003,
case dt when '20150521' then
    case item_id when '590603' then sum(yuanbao) end
    end as dt20150521item590603,
case dt when '20150522' then
    case item_id when '500000' then sum(yuanbao) end
    end as dt20150522item500000,
case dt when '20150522' then
    case item_id when '500001' then sum(yuanbao) end
    end as dt20150522item500001,
case dt when '20150522' then
    case item_id when '500002' then sum(yuanbao) end
    end as dt20150522item500002,
case dt when '20150522' then
    case item_id when '510000' then sum(yuanbao) end
    end as dt20150522item510000,
case dt when '20150522' then
    case item_id when '510001' then sum(yuanbao) end
    end as dt20150522item510001,
case dt when '20150522' then
    case item_id when '510002' then sum(yuanbao) end
    end as dt20150522item510002,
case dt when '20150522' then
    case item_id when '510003' then sum(yuanbao) end
    end as dt20150522item510003,
case dt when '20150522' then
    case item_id when '510007' then sum(yuanbao) end
    end as dt20150522item510007,
case dt when '20150522' then
    case item_id when '520091' then sum(yuanbao) end
    end as dt20150522item520091,
case dt when '20150522' then
    case item_id when '525002' then sum(yuanbao) end
    end as dt20150522item525002,
case dt when '20150522' then
    case item_id when '581000' then sum(yuanbao) end
    end as dt20150522item581000,
case dt when '20150522' then
    case item_id when '581001' then sum(yuanbao) end
    end as dt20150522item581001,
case dt when '20150522' then
    case item_id when '583001' then sum(yuanbao) end
    end as dt20150522item583001,
case dt when '20150522' then
    case item_id when '583002' then sum(yuanbao) end
    end as dt20150522item583002,
case dt when '20150522' then
    case item_id when '583003' then sum(yuanbao) end
    end as dt20150522item583003,
case dt when '20150522' then
    case item_id when '584003' then sum(yuanbao) end
    end as dt20150522item584003,
case dt when '20150522' then
    case item_id when '590603' then sum(yuanbao) end
    end as dt20150522item590603,
case dt when '20150523' then
    case item_id when '500000' then sum(yuanbao) end
    end as dt20150523item500000,
case dt when '20150523' then
    case item_id when '500001' then sum(yuanbao) end
    end as dt20150523item500001,
case dt when '20150523' then
    case item_id when '500002' then sum(yuanbao) end
    end as dt20150523item500002,
case dt when '20150523' then
    case item_id when '510000' then sum(yuanbao) end
    end as dt20150523item510000,
case dt when '20150523' then
    case item_id when '510001' then sum(yuanbao) end
    end as dt20150523item510001,
case dt when '20150523' then
    case item_id when '510002' then sum(yuanbao) end
    end as dt20150523item510002,
case dt when '20150523' then
    case item_id when '510003' then sum(yuanbao) end
    end as dt20150523item510003,
case dt when '20150523' then
    case item_id when '510007' then sum(yuanbao) end
    end as dt20150523item510007,
case dt when '20150523' then
    case item_id when '520091' then sum(yuanbao) end
    end as dt20150523item520091,
case dt when '20150523' then
    case item_id when '525002' then sum(yuanbao) end
    end as dt20150523item525002,
case dt when '20150523' then
    case item_id when '581000' then sum(yuanbao) end
    end as dt20150523item581000,
case dt when '20150523' then
    case item_id when '581001' then sum(yuanbao) end
    end as dt20150523item581001,
case dt when '20150523' then
    case item_id when '583001' then sum(yuanbao) end
    end as dt20150523item583001,
case dt when '20150523' then
    case item_id when '583002' then sum(yuanbao) end
    end as dt20150523item583002,
case dt when '20150523' then
    case item_id when '583003' then sum(yuanbao) end
    end as dt20150523item583003,
case dt when '20150523' then
    case item_id when '584003' then sum(yuanbao) end
    end as dt20150523item584003,
case dt when '20150523' then
    case item_id when '590603' then sum(yuanbao) end
    end as dt20150523item590603,
case dt when '20150524' then
    case item_id when '500000' then sum(yuanbao) end
    end as dt20150524item500000,
case dt when '20150524' then
    case item_id when '500001' then sum(yuanbao) end
    end as dt20150524item500001,
case dt when '20150524' then
    case item_id when '500002' then sum(yuanbao) end
    end as dt20150524item500002,
case dt when '20150524' then
    case item_id when '510000' then sum(yuanbao) end
    end as dt20150524item510000,
case dt when '20150524' then
    case item_id when '510001' then sum(yuanbao) end
    end as dt20150524item510001,
case dt when '20150524' then
    case item_id when '510002' then sum(yuanbao) end
    end as dt20150524item510002,
case dt when '20150524' then
    case item_id when '510003' then sum(yuanbao) end
    end as dt20150524item510003,
case dt when '20150524' then
    case item_id when '510007' then sum(yuanbao) end
    end as dt20150524item510007,
case dt when '20150524' then
    case item_id when '520091' then sum(yuanbao) end
    end as dt20150524item520091,
case dt when '20150524' then
    case item_id when '525002' then sum(yuanbao) end
    end as dt20150524item525002,
case dt when '20150524' then
    case item_id when '581000' then sum(yuanbao) end
    end as dt20150524item581000,
case dt when '20150524' then
    case item_id when '581001' then sum(yuanbao) end
    end as dt20150524item581001,
case dt when '20150524' then
    case item_id when '583001' then sum(yuanbao) end
    end as dt20150524item583001,
case dt when '20150524' then
    case item_id when '583002' then sum(yuanbao) end
    end as dt20150524item583002,
case dt when '20150524' then
    case item_id when '583003' then sum(yuanbao) end
    end as dt20150524item583003,
case dt when '20150524' then
    case item_id when '584003' then sum(yuanbao) end
    end as dt20150524item584003,
case dt when '20150524' then
    case item_id when '590603' then sum(yuanbao) end
    end as dt20150524item590603,
case dt when '20150525' then
    case item_id when '500000' then sum(yuanbao) end
    end as dt20150525item500000,
case dt when '20150525' then
    case item_id when '500001' then sum(yuanbao) end
    end as dt20150525item500001,
case dt when '20150525' then
    case item_id when '500002' then sum(yuanbao) end
    end as dt20150525item500002,
case dt when '20150525' then
    case item_id when '510000' then sum(yuanbao) end
    end as dt20150525item510000,
case dt when '20150525' then
    case item_id when '510001' then sum(yuanbao) end
    end as dt20150525item510001,
case dt when '20150525' then
    case item_id when '510002' then sum(yuanbao) end
    end as dt20150525item510002,
case dt when '20150525' then
    case item_id when '510003' then sum(yuanbao) end
    end as dt20150525item510003,
case dt when '20150525' then
    case item_id when '510007' then sum(yuanbao) end
    end as dt20150525item510007,
case dt when '20150525' then
    case item_id when '520091' then sum(yuanbao) end
    end as dt20150525item520091,
case dt when '20150525' then
    case item_id when '525002' then sum(yuanbao) end
    end as dt20150525item525002,
case dt when '20150525' then
    case item_id when '581000' then sum(yuanbao) end
    end as dt20150525item581000,
case dt when '20150525' then
    case item_id when '581001' then sum(yuanbao) end
    end as dt20150525item581001,
case dt when '20150525' then
    case item_id when '583001' then sum(yuanbao) end
    end as dt20150525item583001,
case dt when '20150525' then
    case item_id when '583002' then sum(yuanbao) end
    end as dt20150525item583002,
case dt when '20150525' then
    case item_id when '583003' then sum(yuanbao) end
    end as dt20150525item583003,
case dt when '20150525' then
    case item_id when '584003' then sum(yuanbao) end
    end as dt20150525item584003,
case dt when '20150525' then
    case item_id when '590603' then sum(yuanbao) end
    end as dt20150525item590603,
case dt when '20150526' then
    case item_id when '500000' then sum(yuanbao) end
    end as dt20150526item500000,
case dt when '20150526' then
    case item_id when '500001' then sum(yuanbao) end
    end as dt20150526item500001,
case dt when '20150526' then
    case item_id when '500002' then sum(yuanbao) end
    end as dt20150526item500002,
case dt when '20150526' then
    case item_id when '510000' then sum(yuanbao) end
    end as dt20150526item510000,
case dt when '20150526' then
    case item_id when '510001' then sum(yuanbao) end
    end as dt20150526item510001,
case dt when '20150526' then
    case item_id when '510002' then sum(yuanbao) end
    end as dt20150526item510002,
case dt when '20150526' then
    case item_id when '510003' then sum(yuanbao) end
    end as dt20150526item510003,
case dt when '20150526' then
    case item_id when '510007' then sum(yuanbao) end
    end as dt20150526item510007,
case dt when '20150526' then
    case item_id when '520091' then sum(yuanbao) end
    end as dt20150526item520091,
case dt when '20150526' then
    case item_id when '525002' then sum(yuanbao) end
    end as dt20150526item525002,
case dt when '20150526' then
    case item_id when '581000' then sum(yuanbao) end
    end as dt20150526item581000,
case dt when '20150526' then
    case item_id when '581001' then sum(yuanbao) end
    end as dt20150526item581001,
case dt when '20150526' then
    case item_id when '583001' then sum(yuanbao) end
    end as dt20150526item583001,
case dt when '20150526' then
    case item_id when '583002' then sum(yuanbao) end
    end as dt20150526item583002,
case dt when '20150526' then
    case item_id when '583003' then sum(yuanbao) end
    end as dt20150526item583003,
case dt when '20150526' then
    case item_id when '584003' then sum(yuanbao) end
    end as dt20150526item584003,
case dt when '20150526' then
    case item_id when '590603' then sum(yuanbao) end
    end as dt20150526item590603,
case dt when '20150527' then
    case item_id when '500000' then sum(yuanbao) end
    end as dt20150527item500000,
case dt when '20150527' then
    case item_id when '500001' then sum(yuanbao) end
    end as dt20150527item500001,
case dt when '20150527' then
    case item_id when '500002' then sum(yuanbao) end
    end as dt20150527item500002,
case dt when '20150527' then
    case item_id when '510000' then sum(yuanbao) end
    end as dt20150527item510000,
case dt when '20150527' then
    case item_id when '510001' then sum(yuanbao) end
    end as dt20150527item510001,
case dt when '20150527' then
    case item_id when '510002' then sum(yuanbao) end
    end as dt20150527item510002,
case dt when '20150527' then
    case item_id when '510003' then sum(yuanbao) end
    end as dt20150527item510003,
case dt when '20150527' then
    case item_id when '510007' then sum(yuanbao) end
    end as dt20150527item510007,
case dt when '20150527' then
    case item_id when '520091' then sum(yuanbao) end
    end as dt20150527item520091,
case dt when '20150527' then
    case item_id when '525002' then sum(yuanbao) end
    end as dt20150527item525002,
case dt when '20150527' then
    case item_id when '581000' then sum(yuanbao) end
    end as dt20150527item581000,
case dt when '20150527' then
    case item_id when '581001' then sum(yuanbao) end
    end as dt20150527item581001,
case dt when '20150527' then
    case item_id when '583001' then sum(yuanbao) end
    end as dt20150527item583001,
case dt when '20150527' then
    case item_id when '583002' then sum(yuanbao) end
    end as dt20150527item583002,
case dt when '20150527' then
    case item_id when '583003' then sum(yuanbao) end
    end as dt20150527item583003,
case dt when '20150527' then
    case item_id when '584003' then sum(yuanbao) end
    end as dt20150527item584003,
case dt when '20150527' then
    case item_id when '590603' then sum(yuanbao) end
    end as dt20150527item590603
from src_Itembuy_day
group by role_id, dt, item_id
)a
group by role_id;

--统计免费元宝的消费情况（role_id,dt+item_id）第一周
create table items_buy_day_free_1 as
select a.role_id as role_id, 
max(a.dt20150514item500000) as dt20150514item500000free, max(a.dt20150514item500001) as dt20150514item500001free, max(a.dt20150514item500002) as dt20150514item500002free, max(a.dt20150514item510000) as dt20150514item510000free, max(a.dt20150514item510001) as dt20150514item510001free, max(a.dt20150514item510002) as dt20150514item510002free, max(a.dt20150514item510003) as dt20150514item510003free, max(a.dt20150514item510007) as dt20150514item510007free, max(a.dt20150514item520091) as dt20150514item520091free, max(a.dt20150514item525002) as dt20150514item525002free, max(a.dt20150514item581000) as dt20150514item581000free, max(a.dt20150514item581001) as dt20150514item581001free, max(a.dt20150514item583001) as dt20150514item583001free, max(a.dt20150514item583002) as dt20150514item583002free, max(a.dt20150514item583003) as dt20150514item583003free, max(a.dt20150514item584003) as dt20150514item584003free, max(a.dt20150514item590603) as dt20150514item590603free, max(a.dt20150515item500000) as dt20150515item500000free, max(a.dt20150515item500001) as dt20150515item500001free, max(a.dt20150515item500002) as dt20150515item500002free, max(a.dt20150515item510000) as dt20150515item510000free, max(a.dt20150515item510001) as dt20150515item510001free, max(a.dt20150515item510002) as dt20150515item510002free, max(a.dt20150515item510003) as dt20150515item510003free, max(a.dt20150515item510007) as dt20150515item510007free, max(a.dt20150515item520091) as dt20150515item520091free, max(a.dt20150515item525002) as dt20150515item525002free, max(a.dt20150515item581000) as dt20150515item581000free, max(a.dt20150515item581001) as dt20150515item581001free, max(a.dt20150515item583001) as dt20150515item583001free, max(a.dt20150515item583002) as dt20150515item583002free, max(a.dt20150515item583003) as dt20150515item583003free, max(a.dt20150515item584003) as dt20150515item584003free, max(a.dt20150515item590603) as dt20150515item590603free, max(a.dt20150516item500000) as dt20150516item500000free, max(a.dt20150516item500001) as dt20150516item500001free, max(a.dt20150516item500002) as dt20150516item500002free, max(a.dt20150516item510000) as dt20150516item510000free, max(a.dt20150516item510001) as dt20150516item510001free, max(a.dt20150516item510002) as dt20150516item510002free, max(a.dt20150516item510003) as dt20150516item510003free, max(a.dt20150516item510007) as dt20150516item510007free, max(a.dt20150516item520091) as dt20150516item520091free, max(a.dt20150516item525002) as dt20150516item525002free, max(a.dt20150516item581000) as dt20150516item581000free, max(a.dt20150516item581001) as dt20150516item581001free, max(a.dt20150516item583001) as dt20150516item583001free, max(a.dt20150516item583002) as dt20150516item583002free, max(a.dt20150516item583003) as dt20150516item583003free, max(a.dt20150516item584003) as dt20150516item584003free, max(a.dt20150516item590603) as dt20150516item590603free, max(a.dt20150517item500000) as dt20150517item500000free, max(a.dt20150517item500001) as dt20150517item500001free, max(a.dt20150517item500002) as dt20150517item500002free, max(a.dt20150517item510000) as dt20150517item510000free, max(a.dt20150517item510001) as dt20150517item510001free, max(a.dt20150517item510002) as dt20150517item510002free, max(a.dt20150517item510003) as dt20150517item510003free, max(a.dt20150517item510007) as dt20150517item510007free, max(a.dt20150517item520091) as dt20150517item520091free, max(a.dt20150517item525002) as dt20150517item525002free, max(a.dt20150517item581000) as dt20150517item581000free, max(a.dt20150517item581001) as dt20150517item581001free, max(a.dt20150517item583001) as dt20150517item583001free, max(a.dt20150517item583002) as dt20150517item583002free, max(a.dt20150517item583003) as dt20150517item583003free, max(a.dt20150517item584003) as dt20150517item584003free, max(a.dt20150517item590603) as dt20150517item590603free, max(a.dt20150518item500000) as dt20150518item500000free, max(a.dt20150518item500001) as dt20150518item500001free, max(a.dt20150518item500002) as dt20150518item500002free, max(a.dt20150518item510000) as dt20150518item510000free, max(a.dt20150518item510001) as dt20150518item510001free, max(a.dt20150518item510002) as dt20150518item510002free, max(a.dt20150518item510003) as dt20150518item510003free, max(a.dt20150518item510007) as dt20150518item510007free, max(a.dt20150518item520091) as dt20150518item520091free, max(a.dt20150518item525002) as dt20150518item525002free, max(a.dt20150518item581000) as dt20150518item581000free, max(a.dt20150518item581001) as dt20150518item581001free, max(a.dt20150518item583001) as dt20150518item583001free, max(a.dt20150518item583002) as dt20150518item583002free, max(a.dt20150518item583003) as dt20150518item583003free, max(a.dt20150518item584003) as dt20150518item584003free, max(a.dt20150518item590603) as dt20150518item590603free, max(a.dt20150519item500000) as dt20150519item500000free, max(a.dt20150519item500001) as dt20150519item500001free, max(a.dt20150519item500002) as dt20150519item500002free, max(a.dt20150519item510000) as dt20150519item510000free, max(a.dt20150519item510001) as dt20150519item510001free, max(a.dt20150519item510002) as dt20150519item510002free, max(a.dt20150519item510003) as dt20150519item510003free, max(a.dt20150519item510007) as dt20150519item510007free, max(a.dt20150519item520091) as dt20150519item520091free, max(a.dt20150519item525002) as dt20150519item525002free, max(a.dt20150519item581000) as dt20150519item581000free, max(a.dt20150519item581001) as dt20150519item581001free, max(a.dt20150519item583001) as dt20150519item583001free, max(a.dt20150519item583002) as dt20150519item583002free, max(a.dt20150519item583003) as dt20150519item583003free, max(a.dt20150519item584003) as dt20150519item584003free, max(a.dt20150519item590603) as dt20150519item590603free, max(a.dt20150520item500000) as dt20150520item500000free, max(a.dt20150520item500001) as dt20150520item500001free, max(a.dt20150520item500002) as dt20150520item500002free, max(a.dt20150520item510000) as dt20150520item510000free, max(a.dt20150520item510001) as dt20150520item510001free, max(a.dt20150520item510002) as dt20150520item510002free, max(a.dt20150520item510003) as dt20150520item510003free, max(a.dt20150520item510007) as dt20150520item510007free, max(a.dt20150520item520091) as dt20150520item520091free, max(a.dt20150520item525002) as dt20150520item525002free, max(a.dt20150520item581000) as dt20150520item581000free, max(a.dt20150520item581001) as dt20150520item581001free, max(a.dt20150520item583001) as dt20150520item583001free, max(a.dt20150520item583002) as dt20150520item583002free, max(a.dt20150520item583003) as dt20150520item583003free, max(a.dt20150520item584003) as dt20150520item584003free, max(a.dt20150520item590603) as dt20150520item590603free
from (
select role_id,
case dt when '20150514' then
    case item_id when '500000' then sum(free_yuanbao) end
    end as dt20150514item500000,
case dt when '20150514' then
    case item_id when '500001' then sum(free_yuanbao) end
    end as dt20150514item500001,
case dt when '20150514' then
    case item_id when '500002' then sum(free_yuanbao) end
    end as dt20150514item500002,
case dt when '20150514' then
    case item_id when '510000' then sum(free_yuanbao) end
    end as dt20150514item510000,
case dt when '20150514' then
    case item_id when '510001' then sum(free_yuanbao) end
    end as dt20150514item510001,
case dt when '20150514' then
    case item_id when '510002' then sum(free_yuanbao) end
    end as dt20150514item510002,
case dt when '20150514' then
    case item_id when '510003' then sum(free_yuanbao) end
    end as dt20150514item510003,
case dt when '20150514' then
    case item_id when '510007' then sum(free_yuanbao) end
    end as dt20150514item510007,
case dt when '20150514' then
    case item_id when '520091' then sum(free_yuanbao) end
    end as dt20150514item520091,
case dt when '20150514' then
    case item_id when '525002' then sum(free_yuanbao) end
    end as dt20150514item525002,
case dt when '20150514' then
    case item_id when '581000' then sum(free_yuanbao) end
    end as dt20150514item581000,
case dt when '20150514' then
    case item_id when '581001' then sum(free_yuanbao) end
    end as dt20150514item581001,
case dt when '20150514' then
    case item_id when '583001' then sum(free_yuanbao) end
    end as dt20150514item583001,
case dt when '20150514' then
    case item_id when '583002' then sum(free_yuanbao) end
    end as dt20150514item583002,
case dt when '20150514' then
    case item_id when '583003' then sum(free_yuanbao) end
    end as dt20150514item583003,
case dt when '20150514' then
    case item_id when '584003' then sum(free_yuanbao) end
    end as dt20150514item584003,
case dt when '20150514' then
    case item_id when '590603' then sum(free_yuanbao) end
    end as dt20150514item590603,
case dt when '20150515' then
    case item_id when '500000' then sum(free_yuanbao) end
    end as dt20150515item500000,
case dt when '20150515' then
    case item_id when '500001' then sum(free_yuanbao) end
    end as dt20150515item500001,
case dt when '20150515' then
    case item_id when '500002' then sum(free_yuanbao) end
    end as dt20150515item500002,
case dt when '20150515' then
    case item_id when '510000' then sum(free_yuanbao) end
    end as dt20150515item510000,
case dt when '20150515' then
    case item_id when '510001' then sum(free_yuanbao) end
    end as dt20150515item510001,
case dt when '20150515' then
    case item_id when '510002' then sum(free_yuanbao) end
    end as dt20150515item510002,
case dt when '20150515' then
    case item_id when '510003' then sum(free_yuanbao) end
    end as dt20150515item510003,
case dt when '20150515' then
    case item_id when '510007' then sum(free_yuanbao) end
    end as dt20150515item510007,
case dt when '20150515' then
    case item_id when '520091' then sum(free_yuanbao) end
    end as dt20150515item520091,
case dt when '20150515' then
    case item_id when '525002' then sum(free_yuanbao) end
    end as dt20150515item525002,
case dt when '20150515' then
    case item_id when '581000' then sum(free_yuanbao) end
    end as dt20150515item581000,
case dt when '20150515' then
    case item_id when '581001' then sum(free_yuanbao) end
    end as dt20150515item581001,
case dt when '20150515' then
    case item_id when '583001' then sum(free_yuanbao) end
    end as dt20150515item583001,
case dt when '20150515' then
    case item_id when '583002' then sum(free_yuanbao) end
    end as dt20150515item583002,
case dt when '20150515' then
    case item_id when '583003' then sum(free_yuanbao) end
    end as dt20150515item583003,
case dt when '20150515' then
    case item_id when '584003' then sum(free_yuanbao) end
    end as dt20150515item584003,
case dt when '20150515' then
    case item_id when '590603' then sum(free_yuanbao) end
    end as dt20150515item590603,
case dt when '20150516' then
    case item_id when '500000' then sum(free_yuanbao) end
    end as dt20150516item500000,
case dt when '20150516' then
    case item_id when '500001' then sum(free_yuanbao) end
    end as dt20150516item500001,
case dt when '20150516' then
    case item_id when '500002' then sum(free_yuanbao) end
    end as dt20150516item500002,
case dt when '20150516' then
    case item_id when '510000' then sum(free_yuanbao) end
    end as dt20150516item510000,
case dt when '20150516' then
    case item_id when '510001' then sum(free_yuanbao) end
    end as dt20150516item510001,
case dt when '20150516' then
    case item_id when '510002' then sum(free_yuanbao) end
    end as dt20150516item510002,
case dt when '20150516' then
    case item_id when '510003' then sum(free_yuanbao) end
    end as dt20150516item510003,
case dt when '20150516' then
    case item_id when '510007' then sum(free_yuanbao) end
    end as dt20150516item510007,
case dt when '20150516' then
    case item_id when '520091' then sum(free_yuanbao) end
    end as dt20150516item520091,
case dt when '20150516' then
    case item_id when '525002' then sum(free_yuanbao) end
    end as dt20150516item525002,
case dt when '20150516' then
    case item_id when '581000' then sum(free_yuanbao) end
    end as dt20150516item581000,
case dt when '20150516' then
    case item_id when '581001' then sum(free_yuanbao) end
    end as dt20150516item581001,
case dt when '20150516' then
    case item_id when '583001' then sum(free_yuanbao) end
    end as dt20150516item583001,
case dt when '20150516' then
    case item_id when '583002' then sum(free_yuanbao) end
    end as dt20150516item583002,
case dt when '20150516' then
    case item_id when '583003' then sum(free_yuanbao) end
    end as dt20150516item583003,
case dt when '20150516' then
    case item_id when '584003' then sum(free_yuanbao) end
    end as dt20150516item584003,
case dt when '20150516' then
    case item_id when '590603' then sum(free_yuanbao) end
    end as dt20150516item590603,
case dt when '20150517' then
    case item_id when '500000' then sum(free_yuanbao) end
    end as dt20150517item500000,
case dt when '20150517' then
    case item_id when '500001' then sum(free_yuanbao) end
    end as dt20150517item500001,
case dt when '20150517' then
    case item_id when '500002' then sum(free_yuanbao) end
    end as dt20150517item500002,
case dt when '20150517' then
    case item_id when '510000' then sum(free_yuanbao) end
    end as dt20150517item510000,
case dt when '20150517' then
    case item_id when '510001' then sum(free_yuanbao) end
    end as dt20150517item510001,
case dt when '20150517' then
    case item_id when '510002' then sum(free_yuanbao) end
    end as dt20150517item510002,
case dt when '20150517' then
    case item_id when '510003' then sum(free_yuanbao) end
    end as dt20150517item510003,
case dt when '20150517' then
    case item_id when '510007' then sum(free_yuanbao) end
    end as dt20150517item510007,
case dt when '20150517' then
    case item_id when '520091' then sum(free_yuanbao) end
    end as dt20150517item520091,
case dt when '20150517' then
    case item_id when '525002' then sum(free_yuanbao) end
    end as dt20150517item525002,
case dt when '20150517' then
    case item_id when '581000' then sum(free_yuanbao) end
    end as dt20150517item581000,
case dt when '20150517' then
    case item_id when '581001' then sum(free_yuanbao) end
    end as dt20150517item581001,
case dt when '20150517' then
    case item_id when '583001' then sum(free_yuanbao) end
    end as dt20150517item583001,
case dt when '20150517' then
    case item_id when '583002' then sum(free_yuanbao) end
    end as dt20150517item583002,
case dt when '20150517' then
    case item_id when '583003' then sum(free_yuanbao) end
    end as dt20150517item583003,
case dt when '20150517' then
    case item_id when '584003' then sum(free_yuanbao) end
    end as dt20150517item584003,
case dt when '20150517' then
    case item_id when '590603' then sum(free_yuanbao) end
    end as dt20150517item590603,
case dt when '20150518' then
    case item_id when '500000' then sum(free_yuanbao) end
    end as dt20150518item500000,
case dt when '20150518' then
    case item_id when '500001' then sum(free_yuanbao) end
    end as dt20150518item500001,
case dt when '20150518' then
    case item_id when '500002' then sum(free_yuanbao) end
    end as dt20150518item500002,
case dt when '20150518' then
    case item_id when '510000' then sum(free_yuanbao) end
    end as dt20150518item510000,
case dt when '20150518' then
    case item_id when '510001' then sum(free_yuanbao) end
    end as dt20150518item510001,
case dt when '20150518' then
    case item_id when '510002' then sum(free_yuanbao) end
    end as dt20150518item510002,
case dt when '20150518' then
    case item_id when '510003' then sum(free_yuanbao) end
    end as dt20150518item510003,
case dt when '20150518' then
    case item_id when '510007' then sum(free_yuanbao) end
    end as dt20150518item510007,
case dt when '20150518' then
    case item_id when '520091' then sum(free_yuanbao) end
    end as dt20150518item520091,
case dt when '20150518' then
    case item_id when '525002' then sum(free_yuanbao) end
    end as dt20150518item525002,
case dt when '20150518' then
    case item_id when '581000' then sum(free_yuanbao) end
    end as dt20150518item581000,
case dt when '20150518' then
    case item_id when '581001' then sum(free_yuanbao) end
    end as dt20150518item581001,
case dt when '20150518' then
    case item_id when '583001' then sum(free_yuanbao) end
    end as dt20150518item583001,
case dt when '20150518' then
    case item_id when '583002' then sum(free_yuanbao) end
    end as dt20150518item583002,
case dt when '20150518' then
    case item_id when '583003' then sum(free_yuanbao) end
    end as dt20150518item583003,
case dt when '20150518' then
    case item_id when '584003' then sum(free_yuanbao) end
    end as dt20150518item584003,
case dt when '20150518' then
    case item_id when '590603' then sum(free_yuanbao) end
    end as dt20150518item590603,
case dt when '20150519' then
    case item_id when '500000' then sum(free_yuanbao) end
    end as dt20150519item500000,
case dt when '20150519' then
    case item_id when '500001' then sum(free_yuanbao) end
    end as dt20150519item500001,
case dt when '20150519' then
    case item_id when '500002' then sum(free_yuanbao) end
    end as dt20150519item500002,
case dt when '20150519' then
    case item_id when '510000' then sum(free_yuanbao) end
    end as dt20150519item510000,
case dt when '20150519' then
    case item_id when '510001' then sum(free_yuanbao) end
    end as dt20150519item510001,
case dt when '20150519' then
    case item_id when '510002' then sum(free_yuanbao) end
    end as dt20150519item510002,
case dt when '20150519' then
    case item_id when '510003' then sum(free_yuanbao) end
    end as dt20150519item510003,
case dt when '20150519' then
    case item_id when '510007' then sum(free_yuanbao) end
    end as dt20150519item510007,
case dt when '20150519' then
    case item_id when '520091' then sum(free_yuanbao) end
    end as dt20150519item520091,
case dt when '20150519' then
    case item_id when '525002' then sum(free_yuanbao) end
    end as dt20150519item525002,
case dt when '20150519' then
    case item_id when '581000' then sum(free_yuanbao) end
    end as dt20150519item581000,
case dt when '20150519' then
    case item_id when '581001' then sum(free_yuanbao) end
    end as dt20150519item581001,
case dt when '20150519' then
    case item_id when '583001' then sum(free_yuanbao) end
    end as dt20150519item583001,
case dt when '20150519' then
    case item_id when '583002' then sum(free_yuanbao) end
    end as dt20150519item583002,
case dt when '20150519' then
    case item_id when '583003' then sum(free_yuanbao) end
    end as dt20150519item583003,
case dt when '20150519' then
    case item_id when '584003' then sum(free_yuanbao) end
    end as dt20150519item584003,
case dt when '20150519' then
    case item_id when '590603' then sum(free_yuanbao) end
    end as dt20150519item590603,
case dt when '20150520' then
    case item_id when '500000' then sum(free_yuanbao) end
    end as dt20150520item500000,
case dt when '20150520' then
    case item_id when '500001' then sum(free_yuanbao) end
    end as dt20150520item500001,
case dt when '20150520' then
    case item_id when '500002' then sum(free_yuanbao) end
    end as dt20150520item500002,
case dt when '20150520' then
    case item_id when '510000' then sum(free_yuanbao) end
    end as dt20150520item510000,
case dt when '20150520' then
    case item_id when '510001' then sum(free_yuanbao) end
    end as dt20150520item510001,
case dt when '20150520' then
    case item_id when '510002' then sum(free_yuanbao) end
    end as dt20150520item510002,
case dt when '20150520' then
    case item_id when '510003' then sum(free_yuanbao) end
    end as dt20150520item510003,
case dt when '20150520' then
    case item_id when '510007' then sum(free_yuanbao) end
    end as dt20150520item510007,
case dt when '20150520' then
    case item_id when '520091' then sum(free_yuanbao) end
    end as dt20150520item520091,
case dt when '20150520' then
    case item_id when '525002' then sum(free_yuanbao) end
    end as dt20150520item525002,
case dt when '20150520' then
    case item_id when '581000' then sum(free_yuanbao) end
    end as dt20150520item581000,
case dt when '20150520' then
    case item_id when '581001' then sum(free_yuanbao) end
    end as dt20150520item581001,
case dt when '20150520' then
    case item_id when '583001' then sum(free_yuanbao) end
    end as dt20150520item583001,
case dt when '20150520' then
    case item_id when '583002' then sum(free_yuanbao) end
    end as dt20150520item583002,
case dt when '20150520' then
    case item_id when '583003' then sum(free_yuanbao) end
    end as dt20150520item583003,
case dt when '20150520' then
    case item_id when '584003' then sum(free_yuanbao) end
    end as dt20150520item584003,
case dt when '20150520' then
    case item_id when '590603' then sum(free_yuanbao) end
    end as dt20150520item590603
from src_Itembuy_day
group by role_id, dt, item_id
)a
group by role_id;

--统计免费元宝的消费情况（role_id,dt+item_id）第二周
create table items_buy_day_free_2 as
select a.role_id as role_id, 
max(a.dt20150521item500000) as dt20150521item500000free, max(a.dt20150521item500001) as dt20150521item500001free, max(a.dt20150521item500002) as dt20150521item500002free, max(a.dt20150521item510000) as dt20150521item510000free, max(a.dt20150521item510001) as dt20150521item510001free, max(a.dt20150521item510002) as dt20150521item510002free, max(a.dt20150521item510003) as dt20150521item510003free, max(a.dt20150521item510007) as dt20150521item510007free, max(a.dt20150521item520091) as dt20150521item520091free, max(a.dt20150521item525002) as dt20150521item525002free, max(a.dt20150521item581000) as dt20150521item581000free, max(a.dt20150521item581001) as dt20150521item581001free, max(a.dt20150521item583001) as dt20150521item583001free, max(a.dt20150521item583002) as dt20150521item583002free, max(a.dt20150521item583003) as dt20150521item583003free, max(a.dt20150521item584003) as dt20150521item584003free, max(a.dt20150521item590603) as dt20150521item590603free, max(a.dt20150522item500000) as dt20150522item500000free, max(a.dt20150522item500001) as dt20150522item500001free, max(a.dt20150522item500002) as dt20150522item500002free, max(a.dt20150522item510000) as dt20150522item510000free, max(a.dt20150522item510001) as dt20150522item510001free, max(a.dt20150522item510002) as dt20150522item510002free, max(a.dt20150522item510003) as dt20150522item510003free, max(a.dt20150522item510007) as dt20150522item510007free, max(a.dt20150522item520091) as dt20150522item520091free, max(a.dt20150522item525002) as dt20150522item525002free, max(a.dt20150522item581000) as dt20150522item581000free, max(a.dt20150522item581001) as dt20150522item581001free, max(a.dt20150522item583001) as dt20150522item583001free, max(a.dt20150522item583002) as dt20150522item583002free, max(a.dt20150522item583003) as dt20150522item583003free, max(a.dt20150522item584003) as dt20150522item584003free, max(a.dt20150522item590603) as dt20150522item590603free, max(a.dt20150523item500000) as dt20150523item500000free, max(a.dt20150523item500001) as dt20150523item500001free, max(a.dt20150523item500002) as dt20150523item500002free, max(a.dt20150523item510000) as dt20150523item510000free, max(a.dt20150523item510001) as dt20150523item510001free, max(a.dt20150523item510002) as dt20150523item510002free, max(a.dt20150523item510003) as dt20150523item510003free, max(a.dt20150523item510007) as dt20150523item510007free, max(a.dt20150523item520091) as dt20150523item520091free, max(a.dt20150523item525002) as dt20150523item525002free, max(a.dt20150523item581000) as dt20150523item581000free, max(a.dt20150523item581001) as dt20150523item581001free, max(a.dt20150523item583001) as dt20150523item583001free, max(a.dt20150523item583002) as dt20150523item583002free, max(a.dt20150523item583003) as dt20150523item583003free, max(a.dt20150523item584003) as dt20150523item584003free, max(a.dt20150523item590603) as dt20150523item590603free, max(a.dt20150524item500000) as dt20150524item500000free, max(a.dt20150524item500001) as dt20150524item500001free, max(a.dt20150524item500002) as dt20150524item500002free, max(a.dt20150524item510000) as dt20150524item510000free, max(a.dt20150524item510001) as dt20150524item510001free, max(a.dt20150524item510002) as dt20150524item510002free, max(a.dt20150524item510003) as dt20150524item510003free, max(a.dt20150524item510007) as dt20150524item510007free, max(a.dt20150524item520091) as dt20150524item520091free, max(a.dt20150524item525002) as dt20150524item525002free, max(a.dt20150524item581000) as dt20150524item581000free, max(a.dt20150524item581001) as dt20150524item581001free, max(a.dt20150524item583001) as dt20150524item583001free, max(a.dt20150524item583002) as dt20150524item583002free, max(a.dt20150524item583003) as dt20150524item583003free, max(a.dt20150524item584003) as dt20150524item584003free, max(a.dt20150524item590603) as dt20150524item590603free, max(a.dt20150525item500000) as dt20150525item500000free, max(a.dt20150525item500001) as dt20150525item500001free, max(a.dt20150525item500002) as dt20150525item500002free, max(a.dt20150525item510000) as dt20150525item510000free, max(a.dt20150525item510001) as dt20150525item510001free, max(a.dt20150525item510002) as dt20150525item510002free, max(a.dt20150525item510003) as dt20150525item510003free, max(a.dt20150525item510007) as dt20150525item510007free, max(a.dt20150525item520091) as dt20150525item520091free, max(a.dt20150525item525002) as dt20150525item525002free, max(a.dt20150525item581000) as dt20150525item581000free, max(a.dt20150525item581001) as dt20150525item581001free, max(a.dt20150525item583001) as dt20150525item583001free, max(a.dt20150525item583002) as dt20150525item583002free, max(a.dt20150525item583003) as dt20150525item583003free, max(a.dt20150525item584003) as dt20150525item584003free, max(a.dt20150525item590603) as dt20150525item590603free, max(a.dt20150526item500000) as dt20150526item500000free, max(a.dt20150526item500001) as dt20150526item500001free, max(a.dt20150526item500002) as dt20150526item500002free, max(a.dt20150526item510000) as dt20150526item510000free, max(a.dt20150526item510001) as dt20150526item510001free, max(a.dt20150526item510002) as dt20150526item510002free, max(a.dt20150526item510003) as dt20150526item510003free, max(a.dt20150526item510007) as dt20150526item510007free, max(a.dt20150526item520091) as dt20150526item520091free, max(a.dt20150526item525002) as dt20150526item525002free, max(a.dt20150526item581000) as dt20150526item581000free, max(a.dt20150526item581001) as dt20150526item581001free, max(a.dt20150526item583001) as dt20150526item583001free, max(a.dt20150526item583002) as dt20150526item583002free, max(a.dt20150526item583003) as dt20150526item583003free, max(a.dt20150526item584003) as dt20150526item584003free, max(a.dt20150526item590603) as dt20150526item590603free, max(a.dt20150527item500000) as dt20150527item500000free, max(a.dt20150527item500001) as dt20150527item500001free, max(a.dt20150527item500002) as dt20150527item500002free, max(a.dt20150527item510000) as dt20150527item510000free, max(a.dt20150527item510001) as dt20150527item510001free, max(a.dt20150527item510002) as dt20150527item510002free, max(a.dt20150527item510003) as dt20150527item510003free, max(a.dt20150527item510007) as dt20150527item510007free, max(a.dt20150527item520091) as dt20150527item520091free, max(a.dt20150527item525002) as dt20150527item525002free, max(a.dt20150527item581000) as dt20150527item581000free, max(a.dt20150527item581001) as dt20150527item581001free, max(a.dt20150527item583001) as dt20150527item583001free, max(a.dt20150527item583002) as dt20150527item583002free, max(a.dt20150527item583003) as dt20150527item583003free, max(a.dt20150527item584003) as dt20150527item584003free, max(a.dt20150527item590603) as dt20150527item590603free
from (
select role_id,
case dt when '20150521' then
    case item_id when '500000' then sum(free_yuanbao) end
    end as dt20150521item500000,
case dt when '20150521' then
    case item_id when '500001' then sum(free_yuanbao) end
    end as dt20150521item500001,
case dt when '20150521' then
    case item_id when '500002' then sum(free_yuanbao) end
    end as dt20150521item500002,
case dt when '20150521' then
    case item_id when '510000' then sum(free_yuanbao) end
    end as dt20150521item510000,
case dt when '20150521' then
    case item_id when '510001' then sum(free_yuanbao) end
    end as dt20150521item510001,
case dt when '20150521' then
    case item_id when '510002' then sum(free_yuanbao) end
    end as dt20150521item510002,
case dt when '20150521' then
    case item_id when '510003' then sum(free_yuanbao) end
    end as dt20150521item510003,
case dt when '20150521' then
    case item_id when '510007' then sum(free_yuanbao) end
    end as dt20150521item510007,
case dt when '20150521' then
    case item_id when '520091' then sum(free_yuanbao) end
    end as dt20150521item520091,
case dt when '20150521' then
    case item_id when '525002' then sum(free_yuanbao) end
    end as dt20150521item525002,
case dt when '20150521' then
    case item_id when '581000' then sum(free_yuanbao) end
    end as dt20150521item581000,
case dt when '20150521' then
    case item_id when '581001' then sum(free_yuanbao) end
    end as dt20150521item581001,
case dt when '20150521' then
    case item_id when '583001' then sum(free_yuanbao) end
    end as dt20150521item583001,
case dt when '20150521' then
    case item_id when '583002' then sum(free_yuanbao) end
    end as dt20150521item583002,
case dt when '20150521' then
    case item_id when '583003' then sum(free_yuanbao) end
    end as dt20150521item583003,
case dt when '20150521' then
    case item_id when '584003' then sum(free_yuanbao) end
    end as dt20150521item584003,
case dt when '20150521' then
    case item_id when '590603' then sum(free_yuanbao) end
    end as dt20150521item590603,
case dt when '20150522' then
    case item_id when '500000' then sum(free_yuanbao) end
    end as dt20150522item500000,
case dt when '20150522' then
    case item_id when '500001' then sum(free_yuanbao) end
    end as dt20150522item500001,
case dt when '20150522' then
    case item_id when '500002' then sum(free_yuanbao) end
    end as dt20150522item500002,
case dt when '20150522' then
    case item_id when '510000' then sum(free_yuanbao) end
    end as dt20150522item510000,
case dt when '20150522' then
    case item_id when '510001' then sum(free_yuanbao) end
    end as dt20150522item510001,
case dt when '20150522' then
    case item_id when '510002' then sum(free_yuanbao) end
    end as dt20150522item510002,
case dt when '20150522' then
    case item_id when '510003' then sum(free_yuanbao) end
    end as dt20150522item510003,
case dt when '20150522' then
    case item_id when '510007' then sum(free_yuanbao) end
    end as dt20150522item510007,
case dt when '20150522' then
    case item_id when '520091' then sum(free_yuanbao) end
    end as dt20150522item520091,
case dt when '20150522' then
    case item_id when '525002' then sum(free_yuanbao) end
    end as dt20150522item525002,
case dt when '20150522' then
    case item_id when '581000' then sum(free_yuanbao) end
    end as dt20150522item581000,
case dt when '20150522' then
    case item_id when '581001' then sum(free_yuanbao) end
    end as dt20150522item581001,
case dt when '20150522' then
    case item_id when '583001' then sum(free_yuanbao) end
    end as dt20150522item583001,
case dt when '20150522' then
    case item_id when '583002' then sum(free_yuanbao) end
    end as dt20150522item583002,
case dt when '20150522' then
    case item_id when '583003' then sum(free_yuanbao) end
    end as dt20150522item583003,
case dt when '20150522' then
    case item_id when '584003' then sum(free_yuanbao) end
    end as dt20150522item584003,
case dt when '20150522' then
    case item_id when '590603' then sum(free_yuanbao) end
    end as dt20150522item590603,
case dt when '20150523' then
    case item_id when '500000' then sum(free_yuanbao) end
    end as dt20150523item500000,
case dt when '20150523' then
    case item_id when '500001' then sum(free_yuanbao) end
    end as dt20150523item500001,
case dt when '20150523' then
    case item_id when '500002' then sum(free_yuanbao) end
    end as dt20150523item500002,
case dt when '20150523' then
    case item_id when '510000' then sum(free_yuanbao) end
    end as dt20150523item510000,
case dt when '20150523' then
    case item_id when '510001' then sum(free_yuanbao) end
    end as dt20150523item510001,
case dt when '20150523' then
    case item_id when '510002' then sum(free_yuanbao) end
    end as dt20150523item510002,
case dt when '20150523' then
    case item_id when '510003' then sum(free_yuanbao) end
    end as dt20150523item510003,
case dt when '20150523' then
    case item_id when '510007' then sum(free_yuanbao) end
    end as dt20150523item510007,
case dt when '20150523' then
    case item_id when '520091' then sum(free_yuanbao) end
    end as dt20150523item520091,
case dt when '20150523' then
    case item_id when '525002' then sum(free_yuanbao) end
    end as dt20150523item525002,
case dt when '20150523' then
    case item_id when '581000' then sum(free_yuanbao) end
    end as dt20150523item581000,
case dt when '20150523' then
    case item_id when '581001' then sum(free_yuanbao) end
    end as dt20150523item581001,
case dt when '20150523' then
    case item_id when '583001' then sum(free_yuanbao) end
    end as dt20150523item583001,
case dt when '20150523' then
    case item_id when '583002' then sum(free_yuanbao) end
    end as dt20150523item583002,
case dt when '20150523' then
    case item_id when '583003' then sum(free_yuanbao) end
    end as dt20150523item583003,
case dt when '20150523' then
    case item_id when '584003' then sum(free_yuanbao) end
    end as dt20150523item584003,
case dt when '20150523' then
    case item_id when '590603' then sum(free_yuanbao) end
    end as dt20150523item590603,
case dt when '20150524' then
    case item_id when '500000' then sum(free_yuanbao) end
    end as dt20150524item500000,
case dt when '20150524' then
    case item_id when '500001' then sum(free_yuanbao) end
    end as dt20150524item500001,
case dt when '20150524' then
    case item_id when '500002' then sum(free_yuanbao) end
    end as dt20150524item500002,
case dt when '20150524' then
    case item_id when '510000' then sum(free_yuanbao) end
    end as dt20150524item510000,
case dt when '20150524' then
    case item_id when '510001' then sum(free_yuanbao) end
    end as dt20150524item510001,
case dt when '20150524' then
    case item_id when '510002' then sum(free_yuanbao) end
    end as dt20150524item510002,
case dt when '20150524' then
    case item_id when '510003' then sum(free_yuanbao) end
    end as dt20150524item510003,
case dt when '20150524' then
    case item_id when '510007' then sum(free_yuanbao) end
    end as dt20150524item510007,
case dt when '20150524' then
    case item_id when '520091' then sum(free_yuanbao) end
    end as dt20150524item520091,
case dt when '20150524' then
    case item_id when '525002' then sum(free_yuanbao) end
    end as dt20150524item525002,
case dt when '20150524' then
    case item_id when '581000' then sum(free_yuanbao) end
    end as dt20150524item581000,
case dt when '20150524' then
    case item_id when '581001' then sum(free_yuanbao) end
    end as dt20150524item581001,
case dt when '20150524' then
    case item_id when '583001' then sum(free_yuanbao) end
    end as dt20150524item583001,
case dt when '20150524' then
    case item_id when '583002' then sum(free_yuanbao) end
    end as dt20150524item583002,
case dt when '20150524' then
    case item_id when '583003' then sum(free_yuanbao) end
    end as dt20150524item583003,
case dt when '20150524' then
    case item_id when '584003' then sum(free_yuanbao) end
    end as dt20150524item584003,
case dt when '20150524' then
    case item_id when '590603' then sum(free_yuanbao) end
    end as dt20150524item590603,
case dt when '20150525' then
    case item_id when '500000' then sum(free_yuanbao) end
    end as dt20150525item500000,
case dt when '20150525' then
    case item_id when '500001' then sum(free_yuanbao) end
    end as dt20150525item500001,
case dt when '20150525' then
    case item_id when '500002' then sum(free_yuanbao) end
    end as dt20150525item500002,
case dt when '20150525' then
    case item_id when '510000' then sum(free_yuanbao) end
    end as dt20150525item510000,
case dt when '20150525' then
    case item_id when '510001' then sum(free_yuanbao) end
    end as dt20150525item510001,
case dt when '20150525' then
    case item_id when '510002' then sum(free_yuanbao) end
    end as dt20150525item510002,
case dt when '20150525' then
    case item_id when '510003' then sum(free_yuanbao) end
    end as dt20150525item510003,
case dt when '20150525' then
    case item_id when '510007' then sum(free_yuanbao) end
    end as dt20150525item510007,
case dt when '20150525' then
    case item_id when '520091' then sum(free_yuanbao) end
    end as dt20150525item520091,
case dt when '20150525' then
    case item_id when '525002' then sum(free_yuanbao) end
    end as dt20150525item525002,
case dt when '20150525' then
    case item_id when '581000' then sum(free_yuanbao) end
    end as dt20150525item581000,
case dt when '20150525' then
    case item_id when '581001' then sum(free_yuanbao) end
    end as dt20150525item581001,
case dt when '20150525' then
    case item_id when '583001' then sum(free_yuanbao) end
    end as dt20150525item583001,
case dt when '20150525' then
    case item_id when '583002' then sum(free_yuanbao) end
    end as dt20150525item583002,
case dt when '20150525' then
    case item_id when '583003' then sum(free_yuanbao) end
    end as dt20150525item583003,
case dt when '20150525' then
    case item_id when '584003' then sum(free_yuanbao) end
    end as dt20150525item584003,
case dt when '20150525' then
    case item_id when '590603' then sum(free_yuanbao) end
    end as dt20150525item590603,
case dt when '20150526' then
    case item_id when '500000' then sum(free_yuanbao) end
    end as dt20150526item500000,
case dt when '20150526' then
    case item_id when '500001' then sum(free_yuanbao) end
    end as dt20150526item500001,
case dt when '20150526' then
    case item_id when '500002' then sum(free_yuanbao) end
    end as dt20150526item500002,
case dt when '20150526' then
    case item_id when '510000' then sum(free_yuanbao) end
    end as dt20150526item510000,
case dt when '20150526' then
    case item_id when '510001' then sum(free_yuanbao) end
    end as dt20150526item510001,
case dt when '20150526' then
    case item_id when '510002' then sum(free_yuanbao) end
    end as dt20150526item510002,
case dt when '20150526' then
    case item_id when '510003' then sum(free_yuanbao) end
    end as dt20150526item510003,
case dt when '20150526' then
    case item_id when '510007' then sum(free_yuanbao) end
    end as dt20150526item510007,
case dt when '20150526' then
    case item_id when '520091' then sum(free_yuanbao) end
    end as dt20150526item520091,
case dt when '20150526' then
    case item_id when '525002' then sum(free_yuanbao) end
    end as dt20150526item525002,
case dt when '20150526' then
    case item_id when '581000' then sum(free_yuanbao) end
    end as dt20150526item581000,
case dt when '20150526' then
    case item_id when '581001' then sum(free_yuanbao) end
    end as dt20150526item581001,
case dt when '20150526' then
    case item_id when '583001' then sum(free_yuanbao) end
    end as dt20150526item583001,
case dt when '20150526' then
    case item_id when '583002' then sum(free_yuanbao) end
    end as dt20150526item583002,
case dt when '20150526' then
    case item_id when '583003' then sum(free_yuanbao) end
    end as dt20150526item583003,
case dt when '20150526' then
    case item_id when '584003' then sum(free_yuanbao) end
    end as dt20150526item584003,
case dt when '20150526' then
    case item_id when '590603' then sum(free_yuanbao) end
    end as dt20150526item590603,
case dt when '20150527' then
    case item_id when '500000' then sum(free_yuanbao) end
    end as dt20150527item500000,
case dt when '20150527' then
    case item_id when '500001' then sum(free_yuanbao) end
    end as dt20150527item500001,
case dt when '20150527' then
    case item_id when '500002' then sum(free_yuanbao) end
    end as dt20150527item500002,
case dt when '20150527' then
    case item_id when '510000' then sum(free_yuanbao) end
    end as dt20150527item510000,
case dt when '20150527' then
    case item_id when '510001' then sum(free_yuanbao) end
    end as dt20150527item510001,
case dt when '20150527' then
    case item_id when '510002' then sum(free_yuanbao) end
    end as dt20150527item510002,
case dt when '20150527' then
    case item_id when '510003' then sum(free_yuanbao) end
    end as dt20150527item510003,
case dt when '20150527' then
    case item_id when '510007' then sum(free_yuanbao) end
    end as dt20150527item510007,
case dt when '20150527' then
    case item_id when '520091' then sum(free_yuanbao) end
    end as dt20150527item520091,
case dt when '20150527' then
    case item_id when '525002' then sum(free_yuanbao) end
    end as dt20150527item525002,
case dt when '20150527' then
    case item_id when '581000' then sum(free_yuanbao) end
    end as dt20150527item581000,
case dt when '20150527' then
    case item_id when '581001' then sum(free_yuanbao) end
    end as dt20150527item581001,
case dt when '20150527' then
    case item_id when '583001' then sum(free_yuanbao) end
    end as dt20150527item583001,
case dt when '20150527' then
    case item_id when '583002' then sum(free_yuanbao) end
    end as dt20150527item583002,
case dt when '20150527' then
    case item_id when '583003' then sum(free_yuanbao) end
    end as dt20150527item583003,
case dt when '20150527' then
    case item_id when '584003' then sum(free_yuanbao) end
    end as dt20150527item584003,
case dt when '20150527' then
    case item_id when '590603' then sum(free_yuanbao) end
    end as dt20150527item590603
from src_Itembuy_day
group by role_id, dt, item_id
)a
group by role_id;

剩余元宝，每日结算--数据不如直接用用户信息？第一周(重新处理后再使用)
create table left_yuanbaoall_1 as
select c.role_id as role_id,
max(c.dt20150514_left_yuanbao) as dt20150514_left_yuanbao,
max(c.dt20150515_left_yuanbao) as dt20150515_left_yuanbao,
max(c.dt20150516_left_yuanbao) as dt20150516_left_yuanbao,
max(c.dt20150517_left_yuanbao) as dt20150517_left_yuanbao,
max(c.dt20150518_left_yuanbao) as dt20150518_left_yuanbao,
max(c.dt20150519_left_yuanbao) as dt20150519_left_yuanbao,
max(c.dt20150520_left_yuanbao) as dt20150520_left_yuanbao
from(
select b.role_id as role_id,
case b.dt when '20150514' then b.left_yuanbao end as dt20150514_left_yuanbao,
case b.dt when '20150514' then b.left_free_yuanbao end as dt20150514_left_free_yuanbao,
case b.dt when '20150515' then b.left_yuanbao end as dt20150515_left_yuanbao,
case b.dt when '20150515' then b.left_free_yuanbao end as dt20150515_left_free_yuanbao,
case b.dt when '20150516' then b.left_yuanbao end as dt20150516_left_yuanbao,
case b.dt when '20150516' then b.left_free_yuanbao end as dt20150516_left_free_yuanbao,
case b.dt when '20150517' then b.left_yuanbao end as dt20150517_left_yuanbao,
case b.dt when '20150517' then b.left_free_yuanbao end as dt20150517_left_free_yuanbao,
case b.dt when '20150518' then b.left_yuanbao end as dt20150518_left_yuanbao,
case b.dt when '20150518' then b.left_free_yuanbao end as dt20150518_left_free_yuanbao,
case b.dt when '20150519' then b.left_yuanbao end as dt20150519_left_yuanbao,
case b.dt when '20150519' then b.left_free_yuanbao end as dt20150519_left_free_yuanbao,
case b.dt when '20150520' then b.left_yuanbao end as dt20150520_left_yuanbao,
case b.dt when '20150520' then b.left_free_yuanbao end as dt20150520_left_free_yuanbao
from(
SELECT a.role_id as role_id, a.dt as dt, a.left_yuanbao as left_yuanbao, a.left_free_yuanbao as left_free_yuanbao
FROM(
    SELECT ROW_NUMBER() OVER (PARTITION BY role_id, dt ORDER BY buy_time DESC)RN, *
    FROM src_Itembuy_day
)a
WHERE RN=1)b)c
group by role_id;
先转化空值形式
alter table left_yuanbaoall_1 SET SERDEPROPERTIES('serialization.null.format' = 'NULL');

insert overwrite local directory "/home/jx/Documents/left_yuanbaoall_1"  
row format delimited fields terminated by "\t"   
select * from left_yuanbaoall_1;
无效果
insert overwrite local directory "/home/jx/Documents/left_yuanbaoall_1"
ROW FORMAT SERDE 'org.apache.hadoop.hive.serde2.lazy.LazySimpleSerDe'
WITH SERDEPROPERTIES (
'field.delim'='\t',
'serialization.format'= '',
'serialization.null.format'=''  
) STORED AS TEXTFILE
select * from left_yuanbaoall_1;
可用,需要后面在pandas把''替换成np.nan

create table left_yuanbaofree_1 as
select c.role_id as role_id,
max(c.dt20150514_left_free_yuanbao) as dt20150514_left_free_yuanbao,
max(c.dt20150515_left_free_yuanbao) as dt20150515_left_free_yuanbao,
max(c.dt20150516_left_free_yuanbao) as dt20150516_left_free_yuanbao,
max(c.dt20150517_left_free_yuanbao) as dt20150517_left_free_yuanbao,
max(c.dt20150518_left_free_yuanbao) as dt20150518_left_free_yuanbao,
max(c.dt20150519_left_free_yuanbao) as dt20150519_left_free_yuanbao,
max(c.dt20150520_left_free_yuanbao) as dt20150520_left_free_yuanbao
from(
select b.role_id as role_id,
case b.dt when '20150514' then b.left_yuanbao end as dt20150514_left_yuanbao,
case b.dt when '20150514' then b.left_free_yuanbao end as dt20150514_left_free_yuanbao,
case b.dt when '20150515' then b.left_yuanbao end as dt20150515_left_yuanbao,
case b.dt when '20150515' then b.left_free_yuanbao end as dt20150515_left_free_yuanbao,
case b.dt when '20150516' then b.left_yuanbao end as dt20150516_left_yuanbao,
case b.dt when '20150516' then b.left_free_yuanbao end as dt20150516_left_free_yuanbao,
case b.dt when '20150517' then b.left_yuanbao end as dt20150517_left_yuanbao,
case b.dt when '20150517' then b.left_free_yuanbao end as dt20150517_left_free_yuanbao,
case b.dt when '20150518' then b.left_yuanbao end as dt20150518_left_yuanbao,
case b.dt when '20150518' then b.left_free_yuanbao end as dt20150518_left_free_yuanbao,
case b.dt when '20150519' then b.left_yuanbao end as dt20150519_left_yuanbao,
case b.dt when '20150519' then b.left_free_yuanbao end as dt20150519_left_free_yuanbao,
case b.dt when '20150520' then b.left_yuanbao end as dt20150520_left_yuanbao,
case b.dt when '20150520' then b.left_free_yuanbao end as dt20150520_left_free_yuanbao
from(
SELECT a.role_id as role_id, a.dt as dt, a.left_yuanbao as left_yuanbao, a.left_free_yuanbao as left_free_yuanbao
FROM(
    SELECT ROW_NUMBER() OVER (PARTITION BY role_id, dt ORDER BY buy_time DESC)RN, *
    FROM src_Itembuy_day
)a
WHERE RN=1)b)c
group by role_id;

insert overwrite local directory "/home/jx/Documents/left_yuanbaofree_1"
ROW FORMAT SERDE 'org.apache.hadoop.hive.serde2.lazy.LazySimpleSerDe'
WITH SERDEPROPERTIES (
'field.delim'='\t',
'serialization.format'= '',
'serialization.null.format'=''  
) STORED AS TEXTFILE
select * from left_yuanbaofree_1;

剩余元宝，每日结算--数据不如直接用用户信息？第二周
create table left_yuanbaoall_2 as
select c.role_id as role_id,
max(c.dt20150521_left_yuanbao) as dt20150521_left_yuanbao,
max(c.dt20150522_left_yuanbao) as dt20150522_left_yuanbao,
max(c.dt20150523_left_yuanbao) as dt20150523_left_yuanbao,
max(c.dt20150524_left_yuanbao) as dt20150524_left_yuanbao,
max(c.dt20150525_left_yuanbao) as dt20150525_left_yuanbao,
max(c.dt20150526_left_yuanbao) as dt20150526_left_yuanbao,
max(c.dt20150527_left_yuanbao) as dt20150527_left_yuanbao
from(
select b.role_id as role_id,
case b.dt when '20150521' then b.left_yuanbao end as dt20150521_left_yuanbao,
case b.dt when '20150521' then b.left_free_yuanbao end as dt20150521_left_free_yuanbao,
case b.dt when '20150522' then b.left_yuanbao end as dt20150522_left_yuanbao,
case b.dt when '20150522' then b.left_free_yuanbao end as dt20150522_left_free_yuanbao,
case b.dt when '20150523' then b.left_yuanbao end as dt20150523_left_yuanbao,
case b.dt when '20150523' then b.left_free_yuanbao end as dt20150523_left_free_yuanbao,
case b.dt when '20150524' then b.left_yuanbao end as dt20150524_left_yuanbao,
case b.dt when '20150524' then b.left_free_yuanbao end as dt20150524_left_free_yuanbao,
case b.dt when '20150525' then b.left_yuanbao end as dt20150525_left_yuanbao,
case b.dt when '20150525' then b.left_free_yuanbao end as dt20150525_left_free_yuanbao,
case b.dt when '20150526' then b.left_yuanbao end as dt20150526_left_yuanbao,
case b.dt when '20150526' then b.left_free_yuanbao end as dt20150526_left_free_yuanbao,
case b.dt when '20150527' then b.left_yuanbao end as dt20150527_left_yuanbao,
case b.dt when '20150527' then b.left_free_yuanbao end as dt20150527_left_free_yuanbao
from(
SELECT a.role_id as role_id, a.dt as dt, a.left_yuanbao as left_yuanbao, a.left_free_yuanbao as left_free_yuanbao
FROM(
    SELECT ROW_NUMBER() OVER (PARTITION BY role_id, dt ORDER BY buy_time DESC)RN, *
    FROM src_Itembuy_day
)a
WHERE RN=1)b)c
group by role_id;

insert overwrite local directory "/home/jx/Documents/left_yuanbaoall_2"
ROW FORMAT SERDE 'org.apache.hadoop.hive.serde2.lazy.LazySimpleSerDe'
WITH SERDEPROPERTIES (
'field.delim'='\t',
'serialization.format'= '',
'serialization.null.format'=''  
) STORED AS TEXTFILE
select * from left_yuanbaoall_2;


create table left_yuanbaofree_2 as
select c.role_id as role_id,
max(c.dt20150521_left_free_yuanbao) as dt20150521_left_free_yuanbao,
max(c.dt20150522_left_free_yuanbao) as dt20150522_left_free_yuanbao,
max(c.dt20150523_left_free_yuanbao) as dt20150523_left_free_yuanbao,
max(c.dt20150524_left_free_yuanbao) as dt20150524_left_free_yuanbao,
max(c.dt20150525_left_free_yuanbao) as dt20150525_left_free_yuanbao,
max(c.dt20150526_left_free_yuanbao) as dt20150526_left_free_yuanbao,
max(c.dt20150527_left_free_yuanbao) as dt20150527_left_free_yuanbao
from(
select b.role_id as role_id,
case b.dt when '20150521' then b.left_yuanbao end as dt20150521_left_yuanbao,
case b.dt when '20150521' then b.left_free_yuanbao end as dt20150521_left_free_yuanbao,
case b.dt when '20150522' then b.left_yuanbao end as dt20150522_left_yuanbao,
case b.dt when '20150522' then b.left_free_yuanbao end as dt20150522_left_free_yuanbao,
case b.dt when '20150523' then b.left_yuanbao end as dt20150523_left_yuanbao,
case b.dt when '20150523' then b.left_free_yuanbao end as dt20150523_left_free_yuanbao,
case b.dt when '20150524' then b.left_yuanbao end as dt20150524_left_yuanbao,
case b.dt when '20150524' then b.left_free_yuanbao end as dt20150524_left_free_yuanbao,
case b.dt when '20150525' then b.left_yuanbao end as dt20150525_left_yuanbao,
case b.dt when '20150525' then b.left_free_yuanbao end as dt20150525_left_free_yuanbao,
case b.dt when '20150526' then b.left_yuanbao end as dt20150526_left_yuanbao,
case b.dt when '20150526' then b.left_free_yuanbao end as dt20150526_left_free_yuanbao,
case b.dt when '20150527' then b.left_yuanbao end as dt20150527_left_yuanbao,
case b.dt when '20150527' then b.left_free_yuanbao end as dt20150527_left_free_yuanbao
from(
SELECT a.role_id as role_id, a.dt as dt, a.left_yuanbao as left_yuanbao, a.left_free_yuanbao as left_free_yuanbao
FROM(
    SELECT ROW_NUMBER() OVER (PARTITION BY role_id, dt ORDER BY buy_time DESC)RN, *
    FROM src_Itembuy_day
)a
WHERE RN=1)b)c
group by role_id;

insert overwrite local directory "/home/jx/Documents/left_yuanbaofree_2"
ROW FORMAT SERDE 'org.apache.hadoop.hive.serde2.lazy.LazySimpleSerDe'
WITH SERDEPROPERTIES (
'field.delim'='\t',
'serialization.format'= '',
'serialization.null.format'=''  
) STORED AS TEXTFILE
select * from left_yuanbaofree_2;

--用户信息
--取每日最大等级？可以 第一周
create table role_level_day_1 as
select a.role_id as role_id, 
max(a.dt20150514role_level) as dt20150514role_level,
max(a.dt20150515role_level) as dt20150515role_level,
max(a.dt20150516role_level) as dt20150516role_level,
max(a.dt20150517role_level) as dt20150517role_level,
max(a.dt20150518role_level) as dt20150518role_level,
max(a.dt20150519role_level) as dt20150519role_level,
max(a.dt20150520role_level) as dt20150520role_level
from(
select role_id, 
case dt when '20150514' then max(role_level) 
end as dt20150514role_level,
case dt when '20150515' then max(role_level) 
end as dt20150515role_level,
case dt when '20150516' then max(role_level) 
end as dt20150516role_level,
case dt when '20150517' then max(role_level) 
end as dt20150517role_level,
case dt when '20150518' then max(role_level) 
end as dt20150518role_level,
case dt when '20150519' then max(role_level) 
end as dt20150519role_level,
case dt when '20150520' then max(role_level) 
end as dt20150520role_level
from src_Userinfo_day
group by role_id, dt)a
group by role_id;

insert overwrite local directory "/home/jx/Documents/role_level_day_1"
ROW FORMAT SERDE 'org.apache.hadoop.hive.serde2.lazy.LazySimpleSerDe'
WITH SERDEPROPERTIES (
'field.delim'='\t',
'serialization.format'= '',
'serialization.null.format'=''  
) STORED AS TEXTFILE
select * from role_level_day_1;

--取每日最大等级？可以 第二周
create table role_level_day_2 as
select a.role_id as role_id, 
max(a.dt20150521role_level) as dt20150521role_level,
max(a.dt20150522role_level) as dt20150522role_level,
max(a.dt20150523role_level) as dt20150523role_level,
max(a.dt20150524role_level) as dt20150524role_level,
max(a.dt20150525role_level) as dt20150525role_level,
max(a.dt20150526role_level) as dt20150526role_level,
max(a.dt20150527role_level) as dt20150527role_level
from(
select role_id, 
case dt when '20150521' then max(role_level) 
end as dt20150521role_level,
case dt when '20150522' then max(role_level) 
end as dt20150522role_level,
case dt when '20150523' then max(role_level) 
end as dt20150523role_level,
case dt when '20150524' then max(role_level) 
end as dt20150524role_level,
case dt when '20150525' then max(role_level) 
end as dt20150525role_level,
case dt when '20150526' then max(role_level) 
end as dt20150526role_level,
case dt when '20150527' then max(role_level) 
end as dt20150527role_level
from src_Userinfo_day
group by role_id, dt)a
group by role_id;

insert overwrite local directory "/home/jx/Documents/role_level_day_2"
ROW FORMAT SERDE 'org.apache.hadoop.hive.serde2.lazy.LazySimpleSerDe'
WITH SERDEPROPERTIES (
'field.delim'='\t',
'serialization.format'= '',
'serialization.null.format'=''  
) STORED AS TEXTFILE
select * from role_level_day_2;

--取每日最大战力 第一周
create table role_force_day_1 as
select a.role_id as role_id, 
max(a.dt20150514force) as dt20150514force,
max(a.dt20150515force) as dt20150515force,
max(a.dt20150516force) as dt20150516force,
max(a.dt20150517force) as dt20150517force,
max(a.dt20150518force) as dt20150518force,
max(a.dt20150519force) as dt20150519force,
max(a.dt20150520force) as dt20150520force
from(
select role_id, 
case dt when '20150514' then max(force) 
end as dt20150514force,
case dt when '20150515' then max(force) 
end as dt20150515force,
case dt when '20150516' then max(force) 
end as dt20150516force,
case dt when '20150517' then max(force) 
end as dt20150517force,
case dt when '20150518' then max(force) 
end as dt20150518force,
case dt when '20150519' then max(force) 
end as dt20150519force,
case dt when '20150520' then max(force) 
end as dt20150520force
from src_Userinfo_day
group by role_id, dt)a
group by role_id;

insert overwrite local directory "/home/jx/Documents/role_force_day_1"
ROW FORMAT SERDE 'org.apache.hadoop.hive.serde2.lazy.LazySimpleSerDe'
WITH SERDEPROPERTIES (
'field.delim'='\t',
'serialization.format'= '',
'serialization.null.format'=''  
) STORED AS TEXTFILE
select * from role_force_day_1;

--取每日最大战力 第二周
create table role_force_day_2 as
select a.role_id as role_id, 
max(a.dt20150521force) as dt20150521force,
max(a.dt20150522force) as dt20150522force,
max(a.dt20150523force) as dt20150523force,
max(a.dt20150524force) as dt20150524force,
max(a.dt20150525force) as dt20150525force,
max(a.dt20150526force) as dt20150526force,
max(a.dt20150527force) as dt20150527force
from(
select role_id, 
case dt when '20150521' then max(force) 
end as dt20150521force,
case dt when '20150522' then max(force) 
end as dt20150522force,
case dt when '20150523' then max(force) 
end as dt20150523force,
case dt when '20150524' then max(force) 
end as dt20150524force,
case dt when '20150525' then max(force) 
end as dt20150525force,
case dt when '20150526' then max(force) 
end as dt20150526force,
case dt when '20150527' then max(force) 
end as dt20150527force
from src_Userinfo_day
group by role_id, dt)a
group by role_id;

insert overwrite local directory "/home/jx/Documents/role_force_day_2"
ROW FORMAT SERDE 'org.apache.hadoop.hive.serde2.lazy.LazySimpleSerDe'
WITH SERDEPROPERTIES (
'field.delim'='\t',
'serialization.format'= '',
'serialization.null.format'=''  
) STORED AS TEXTFILE
select * from role_force_day_2;

--记录初始好友数量以及结束好友数量
create table role_friends_day_1 as
select a.role_id as role_id, 
max(a.dt20150514friends) as dt20150514friends,
max(a.dt20150515friends) as dt20150515friends,
max(a.dt20150516friends) as dt20150516friends,
max(a.dt20150517friends) as dt20150517friends,
max(a.dt20150518friends) as dt20150518friends,
max(a.dt20150519friends) as dt20150519friends,
max(a.dt20150520friends) as dt20150520friends
from(
select role_id, 
case dt when '20150514' then max(friends) 
end as dt20150514friends,
case dt when '20150515' then max(friends) 
end as dt20150515friends,
case dt when '20150516' then max(friends) 
end as dt20150516friends,
case dt when '20150517' then max(friends) 
end as dt20150517friends,
case dt when '20150518' then max(friends) 
end as dt20150518friends,
case dt when '20150519' then max(friends) 
end as dt20150519friends,
case dt when '20150520' then max(friends) 
end as dt20150520friends
from src_Userinfo_day
group by role_id, dt)a
group by role_id;

insert overwrite local directory "/home/jx/Documents/role_friends_day_1"
ROW FORMAT SERDE 'org.apache.hadoop.hive.serde2.lazy.LazySimpleSerDe'
WITH SERDEPROPERTIES (
'field.delim'='\t',
'serialization.format'= '',
'serialization.null.format'=''  
) STORED AS TEXTFILE
select * from role_friends_day_1;

create table role_friends_day_2 as
select a.role_id as role_id, 
max(a.dt20150521friends) as dt20150521friends,
max(a.dt20150522friends) as dt20150522friends,
max(a.dt20150523friends) as dt20150523friends,
max(a.dt20150524friends) as dt20150524friends,
max(a.dt20150525friends) as dt20150525friends,
max(a.dt20150526friends) as dt20150526friends,
max(a.dt20150527friends) as dt20150527friends
from(
select role_id, 
case dt when '20150521' then max(friends) 
end as dt20150521friends,
case dt when '20150522' then max(friends) 
end as dt20150522friends,
case dt when '20150523' then max(friends) 
end as dt20150523friends,
case dt when '20150524' then max(friends) 
end as dt20150524friends,
case dt when '20150525' then max(friends) 
end as dt20150525friends,
case dt when '20150526' then max(friends) 
end as dt20150526friends,
case dt when '20150527' then max(friends) 
end as dt20150527friends
from src_Userinfo_day
group by role_id, dt)a
group by role_id;

insert overwrite local directory "/home/jx/Documents/role_friends_day_2"
ROW FORMAT SERDE 'org.apache.hadoop.hive.serde2.lazy.LazySimpleSerDe'
WITH SERDEPROPERTIES (
'field.delim'='\t',
'serialization.format'= '',
'serialization.null.format'=''  
) STORED AS TEXTFILE
select * from role_friends_day_2;

--记录初始羽翼状态以及结束羽翼状态 第一周
create table role_friend_wing_1 as
select a.role_id as role_id, 
max(a.max_friends1) as max_friends1,
max(a.max_friends2) as max_friends2,
max(a.max_wing1) as max_wing1,
max(a.max_wing2) as max_wing2
from(
select role_id,
case dt when '20150514' then max(friends) end as max_friends1,
case dt when '20150520' then max(friends) end as max_friends2,
case dt when '20150514' then max(wing) end as max_wing1,
case dt when '20150520' then max(wing) end as max_wing2
from src_Userinfo_day
group by role_id,dt)a
group by role_id;


--记录初始好友数量以及结束好友数量
--记录初始羽翼状态以及结束羽翼状态 第二周
create table role_friend_wing_2 as
select a.role_id as role_id, 
max(a.max_friends2) as max_friends2,
max(a.max_friends3) as max_friends3,
max(a.max_wing2) as max_wing2,
max(a.max_wing3) as max_wing3
from(
select role_id,
case dt when '20150520' then max(friends) end as max_friends2,
case dt when '20150527' then max(friends) end as max_friends3,
case dt when '20150520' then max(wing) end as max_wing2,
case dt when '20150527' then max(wing) end as max_wing3
from src_Userinfo_day
group by role_id,dt)a
group by role_id;

create table role_wing_day_1 as
select a.role_id as role_id, 
max(a.dt20150514wing) as dt20150514wing,
max(a.dt20150515wing) as dt20150515wing,
max(a.dt20150516wing) as dt20150516wing,
max(a.dt20150517wing) as dt20150517wing,
max(a.dt20150518wing) as dt20150518wing,
max(a.dt20150519wing) as dt20150519wing,
max(a.dt20150520wing) as dt20150520wing
from(
select role_id, 
case dt when '20150514' then max(wing) 
end as dt20150514wing,
case dt when '20150515' then max(wing) 
end as dt20150515wing,
case dt when '20150516' then max(wing) 
end as dt20150516wing,
case dt when '20150517' then max(wing) 
end as dt20150517wing,
case dt when '20150518' then max(wing) 
end as dt20150518wing,
case dt when '20150519' then max(wing) 
end as dt20150519wing,
case dt when '20150520' then max(wing) 
end as dt20150520wing
from src_Userinfo_day
group by role_id, dt)a
group by role_id;


insert overwrite local directory "/home/jx/Documents/role_wing_day_1"
ROW FORMAT SERDE 'org.apache.hadoop.hive.serde2.lazy.LazySimpleSerDe'
WITH SERDEPROPERTIES (
'field.delim'='\t',
'serialization.format'= '',
'serialization.null.format'=''  
) STORED AS TEXTFILE
select * from role_wing_day_1;


create table role_wing_day_2 as
select a.role_id as role_id, 
max(a.dt20150521wing) as dt20150521wing,
max(a.dt20150522wing) as dt20150522wing,
max(a.dt20150523wing) as dt20150523wing,
max(a.dt20150524wing) as dt20150524wing,
max(a.dt20150525wing) as dt20150525wing,
max(a.dt20150526wing) as dt20150526wing,
max(a.dt20150527wing) as dt20150527wing
from(
select role_id, 
case dt when '20150521' then max(wing) 
end as dt20150521wing,
case dt when '20150522' then max(wing) 
end as dt20150522wing,
case dt when '20150523' then max(wing) 
end as dt20150523wing,
case dt when '20150524' then max(wing) 
end as dt20150524wing,
case dt when '20150525' then max(wing) 
end as dt20150525wing,
case dt when '20150526' then max(wing) 
end as dt20150526wing,
case dt when '20150527' then max(wing) 
end as dt20150527wing
from src_Userinfo_day
group by role_id, dt)a
group by role_id;


insert overwrite local directory "/home/jx/Documents/role_wing_day_2"
ROW FORMAT SERDE 'org.apache.hadoop.hive.serde2.lazy.LazySimpleSerDe'
WITH SERDEPROPERTIES (
'field.delim'='\t',
'serialization.format'= '',
'serialization.null.format'=''  
) STORED AS TEXTFILE
select * from role_wing_day_2;

--充值日志 第一周
create table role_cash_1 as
select a.role_id as role_id, 
sum(a.dt20150514cash) as dt20150514cash,
sum(a.dt20150515cash) as dt20150515cash,
sum(a.dt20150516cash) as dt20150516cash,
sum(a.dt20150517cash) as dt20150517cash,
sum(a.dt20150518cash) as dt20150518cash,
sum(a.dt20150519cash) as dt20150519cash,
sum(a.dt20150520cash) as dt20150520cash
from(
select role_id, 
case dt when '20150514' then sum(cash) 
end as dt20150514cash,
case dt when '20150515' then sum(cash) 
end as dt20150515cash,
case dt when '20150516' then sum(cash) 
end as dt20150516cash,
case dt when '20150517' then sum(cash) 
end as dt20150517cash,
case dt when '20150518' then sum(cash) 
end as dt20150518cash,
case dt when '20150519' then sum(cash) 
end as dt20150519cash,
case dt when '20150520' then sum(cash) 
end as dt20150520cash
from src_Prepaid_day
group by role_id, dt)a
group by role_id;

--充值日志 第二周
create table role_cash_2 as
select a.role_id as role_id, 
sum(a.dt20150521cash) as dt20150521cash,
sum(a.dt20150522cash) as dt20150522cash,
sum(a.dt20150523cash) as dt20150523cash,
sum(a.dt20150524cash) as dt20150524cash,
sum(a.dt20150525cash) as dt20150525cash,
sum(a.dt20150526cash) as dt20150526cash,
sum(a.dt20150527cash) as dt20150527cash
from(
select role_id, 
case dt when '20150521' then sum(cash) 
end as dt20150521cash,
case dt when '20150522' then sum(cash) 
end as dt20150522cash,
case dt when '20150523' then sum(cash) 
end as dt20150523cash,
case dt when '20150524' then sum(cash) 
end as dt20150524cash,
case dt when '20150525' then sum(cash) 
end as dt20150525cash,
case dt when '20150526' then sum(cash) 
end as dt20150526cash,
case dt when '20150527' then sum(cash) 
end as dt20150527cash
from src_Prepaid_day
group by role_id, dt)a
group by role_id;

--铁匠铺
--统计每天加护次数变化情况 第一周
create table weapons_kaikong_day_1 as
select a.role_id as role_id, 
sum(a.dt20150514opJIAHU) as dt20150514opJIAHU,
sum(a.dt20150514opKAIKONG) as dt20150514opKAIKONG,
sum(a.dt20150514opXIANGQIAN) as dt20150514opXIANGQIAN,
sum(a.dt20150514opDUANZAO) as dt20150514opDUANZAO,
sum(a.dt20150515opJIAHU) as dt20150515opJIAHU,
sum(a.dt20150515opKAIKONG) as dt20150515opKAIKONG,
sum(a.dt20150515opXIANGQIAN) as dt20150515opXIANGQIAN,
sum(a.dt20150515opDUANZAO) as dt20150515opDUANZAO,
sum(a.dt20150516opJIAHU) as dt20150516opJIAHU,
sum(a.dt20150516opKAIKONG) as dt20150516opKAIKONG,
sum(a.dt20150516opXIANGQIAN) as dt20150516opXIANGQIAN,
sum(a.dt20150516opDUANZAO) as dt20150516opDUANZAO,
sum(a.dt20150517opJIAHU) as dt20150517opJIAHU,
sum(a.dt20150517opKAIKONG) as dt20150517opKAIKONG,
sum(a.dt20150517opXIANGQIAN) as dt20150517opXIANGQIAN,
sum(a.dt20150517opDUANZAO) as dt20150517opDUANZAO,
sum(a.dt20150518opJIAHU) as dt20150518opJIAHU,
sum(a.dt20150518opKAIKONG) as dt20150518opKAIKONG,
sum(a.dt20150518opXIANGQIAN) as dt20150518opXIANGQIAN,
sum(a.dt20150518opDUANZAO) as dt20150518opDUANZAO,
sum(a.dt20150519opJIAHU) as dt20150519opJIAHU,
sum(a.dt20150519opKAIKONG) as dt20150519opKAIKONG,
sum(a.dt20150519opXIANGQIAN) as dt20150519opXIANGQIAN,
sum(a.dt20150519opDUANZAO) as dt20150519opDUANZAO,
sum(a.dt20150520opJIAHU) as dt20150520opJIAHU,
sum(a.dt20150520opKAIKONG) as dt20150520opKAIKONG,
sum(a.dt20150520opXIANGQIAN) as dt20150520opXIANGQIAN,
sum(a.dt20150520opDUANZAO) as dt20150520opDUANZAO
from (
select role_id,
case dt when '20150514' then
    case operation when 'JIAHU' then count(*) end
    end as dt20150514opJIAHU,
case dt when '20150514' then
    case operation when 'KAIKONG' then count(*) end
    end as dt20150514opKAIKONG,
case dt when '20150514' then
    case operation when 'XIANGQIAN' then count(*) end
    end as dt20150514opXIANGQIAN,
case dt when '20150514' then
    case operation when 'DUANZAO' then count(*) end
    end as dt20150514opDUANZAO,
case dt when '20150515' then
    case operation when 'JIAHU' then count(*) end
    end as dt20150515opJIAHU,
case dt when '20150515' then
    case operation when 'KAIKONG' then count(*) end
    end as dt20150515opKAIKONG,
case dt when '20150515' then
    case operation when 'XIANGQIAN' then count(*) end
    end as dt20150515opXIANGQIAN,
case dt when '20150515' then
    case operation when 'DUANZAO' then count(*) end
    end as dt20150515opDUANZAO,
case dt when '20150516' then
    case operation when 'JIAHU' then count(*) end
    end as dt20150516opJIAHU,
case dt when '20150516' then
    case operation when 'KAIKONG' then count(*) end
    end as dt20150516opKAIKONG,
case dt when '20150516' then
    case operation when 'XIANGQIAN' then count(*) end
    end as dt20150516opXIANGQIAN,
case dt when '20150516' then
    case operation when 'DUANZAO' then count(*) end
    end as dt20150516opDUANZAO,
case dt when '20150517' then
    case operation when 'JIAHU' then count(*) end
    end as dt20150517opJIAHU,
case dt when '20150517' then
    case operation when 'KAIKONG' then count(*) end
    end as dt20150517opKAIKONG,
case dt when '20150517' then
    case operation when 'XIANGQIAN' then count(*) end
    end as dt20150517opXIANGQIAN,
case dt when '20150517' then
    case operation when 'DUANZAO' then count(*) end
    end as dt20150517opDUANZAO,
case dt when '20150518' then
    case operation when 'JIAHU' then count(*) end
    end as dt20150518opJIAHU,
case dt when '20150518' then
    case operation when 'KAIKONG' then count(*) end
    end as dt20150518opKAIKONG,
case dt when '20150518' then
    case operation when 'XIANGQIAN' then count(*) end
    end as dt20150518opXIANGQIAN,
case dt when '20150518' then
    case operation when 'DUANZAO' then count(*) end
    end as dt20150518opDUANZAO,
case dt when '20150519' then
    case operation when 'JIAHU' then count(*) end
    end as dt20150519opJIAHU,
case dt when '20150519' then
    case operation when 'KAIKONG' then count(*) end
    end as dt20150519opKAIKONG,
case dt when '20150519' then
    case operation when 'XIANGQIAN' then count(*) end
    end as dt20150519opXIANGQIAN,
case dt when '20150519' then
    case operation when 'DUANZAO' then count(*) end
    end as dt20150519opDUANZAO,
case dt when '20150520' then
    case operation when 'JIAHU' then count(*) end
    end as dt20150520opJIAHU,
case dt when '20150520' then
    case operation when 'KAIKONG' then count(*) end
    end as dt20150520opKAIKONG,
case dt when '20150520' then
    case operation when 'XIANGQIAN' then count(*) end
    end as dt20150520opXIANGQIAN,
case dt when '20150520' then
    case operation when 'DUANZAO' then count(*) end
    end as dt20150520opDUANZAO
from src_Smithy_day
group by role_id, dt, operation
)a
group by role_id;

--统计每天加护次数变化情况 第二周
create table weapons_kaikong_day_2 as
select a.role_id as role_id, 
sum(a.dt20150521opJIAHU) as dt20150521opJIAHU,
sum(a.dt20150521opKAIKONG) as dt20150521opKAIKONG,
sum(a.dt20150521opXIANGQIAN) as dt20150521opXIANGQIAN,
sum(a.dt20150521opDUANZAO) as dt20150521opDUANZAO,
sum(a.dt20150522opJIAHU) as dt20150522opJIAHU,
sum(a.dt20150522opKAIKONG) as dt20150522opKAIKONG,
sum(a.dt20150522opXIANGQIAN) as dt20150522opXIANGQIAN,
sum(a.dt20150522opDUANZAO) as dt20150522opDUANZAO,
sum(a.dt20150523opJIAHU) as dt20150523opJIAHU,
sum(a.dt20150523opKAIKONG) as dt20150523opKAIKONG,
sum(a.dt20150523opXIANGQIAN) as dt20150523opXIANGQIAN,
sum(a.dt20150523opDUANZAO) as dt20150523opDUANZAO,
sum(a.dt20150524opJIAHU) as dt20150524opJIAHU,
sum(a.dt20150524opKAIKONG) as dt20150524opKAIKONG,
sum(a.dt20150524opXIANGQIAN) as dt20150524opXIANGQIAN,
sum(a.dt20150524opDUANZAO) as dt20150524opDUANZAO,
sum(a.dt20150525opJIAHU) as dt20150525opJIAHU,
sum(a.dt20150525opKAIKONG) as dt20150525opKAIKONG,
sum(a.dt20150525opXIANGQIAN) as dt20150525opXIANGQIAN,
sum(a.dt20150525opDUANZAO) as dt20150525opDUANZAO,
sum(a.dt20150526opJIAHU) as dt20150526opJIAHU,
sum(a.dt20150526opKAIKONG) as dt20150526opKAIKONG,
sum(a.dt20150526opXIANGQIAN) as dt20150526opXIANGQIAN,
sum(a.dt20150526opDUANZAO) as dt20150526opDUANZAO,
sum(a.dt20150527opJIAHU) as dt20150527opJIAHU,
sum(a.dt20150527opKAIKONG) as dt20150527opKAIKONG,
sum(a.dt20150527opXIANGQIAN) as dt20150527opXIANGQIAN,
sum(a.dt20150527opDUANZAO) as dt20150527opDUANZAO
from (
select role_id,
case dt when '20150521' then
    case operation when 'JIAHU' then count(*) end
    end as dt20150521opJIAHU,
case dt when '20150521' then
    case operation when 'KAIKONG' then count(*) end
    end as dt20150521opKAIKONG,
case dt when '20150521' then
    case operation when 'XIANGQIAN' then count(*) end
    end as dt20150521opXIANGQIAN,
case dt when '20150521' then
    case operation when 'DUANZAO' then count(*) end
    end as dt20150521opDUANZAO,
case dt when '20150522' then
    case operation when 'JIAHU' then count(*) end
    end as dt20150522opJIAHU,
case dt when '20150522' then
    case operation when 'KAIKONG' then count(*) end
    end as dt20150522opKAIKONG,
case dt when '20150522' then
    case operation when 'XIANGQIAN' then count(*) end
    end as dt20150522opXIANGQIAN,
case dt when '20150522' then
    case operation when 'DUANZAO' then count(*) end
    end as dt20150522opDUANZAO,
case dt when '20150523' then
    case operation when 'JIAHU' then count(*) end
    end as dt20150523opJIAHU,
case dt when '20150523' then
    case operation when 'KAIKONG' then count(*) end
    end as dt20150523opKAIKONG,
case dt when '20150523' then
    case operation when 'XIANGQIAN' then count(*) end
    end as dt20150523opXIANGQIAN,
case dt when '20150523' then
    case operation when 'DUANZAO' then count(*) end
    end as dt20150523opDUANZAO,
case dt when '20150524' then
    case operation when 'JIAHU' then count(*) end
    end as dt20150524opJIAHU,
case dt when '20150524' then
    case operation when 'KAIKONG' then count(*) end
    end as dt20150524opKAIKONG,
case dt when '20150524' then
    case operation when 'XIANGQIAN' then count(*) end
    end as dt20150524opXIANGQIAN,
case dt when '20150524' then
    case operation when 'DUANZAO' then count(*) end
    end as dt20150524opDUANZAO,
case dt when '20150525' then
    case operation when 'JIAHU' then count(*) end
    end as dt20150525opJIAHU,
case dt when '20150525' then
    case operation when 'KAIKONG' then count(*) end
    end as dt20150525opKAIKONG,
case dt when '20150525' then
    case operation when 'XIANGQIAN' then count(*) end
    end as dt20150525opXIANGQIAN,
case dt when '20150525' then
    case operation when 'DUANZAO' then count(*) end
    end as dt20150525opDUANZAO,
case dt when '20150526' then
    case operation when 'JIAHU' then count(*) end
    end as dt20150526opJIAHU,
case dt when '20150526' then
    case operation when 'KAIKONG' then count(*) end
    end as dt20150526opKAIKONG,
case dt when '20150526' then
    case operation when 'XIANGQIAN' then count(*) end
    end as dt20150526opXIANGQIAN,
case dt when '20150526' then
    case operation when 'DUANZAO' then count(*) end
    end as dt20150526opDUANZAO,
case dt when '20150527' then
    case operation when 'JIAHU' then count(*) end
    end as dt20150527opJIAHU,
case dt when '20150527' then
    case operation when 'KAIKONG' then count(*) end
    end as dt20150527opKAIKONG,
case dt when '20150527' then
    case operation when 'XIANGQIAN' then count(*) end
    end as dt20150527opXIANGQIAN,
case dt when '20150527' then
    case operation when 'DUANZAO' then count(*) end
    end as dt20150527opDUANZAO
from src_Smithy_day
group by role_id, dt, operation
)a
group by role_id;

--统计镶嵌用物品 第一周
create table weapons_xiangqian_day_list_1 as
select b.role_id as role_id,
max(b.dt20150514itXIANGQIAN) as dt20150514itXIANGQIAN,
max(b.dt20150515itXIANGQIAN) as dt20150515itXIANGQIAN,
max(b.dt20150516itXIANGQIAN) as dt20150516itXIANGQIAN,
max(b.dt20150517itXIANGQIAN) as dt20150517itXIANGQIAN,
max(b.dt20150518itXIANGQIAN) as dt20150518itXIANGQIAN,
max(b.dt20150519itXIANGQIAN) as dt20150519itXIANGQIAN,
max(b.dt20150520itXIANGQIAN) as dt20150520itXIANGQIAN
from
(
select
    a.role_id as role_id, 
case dt when '20150514' then
    case operation when 'XIANGQIAN' then concat_ws(',', collect_list(a.item_s)) end
    end as dt20150514itXIANGQIAN,
case dt when '20150515' then
    case operation when 'XIANGQIAN' then concat_ws(',', collect_list(a.item_s)) end
    end as dt20150515itXIANGQIAN,
case dt when '20150516' then
    case operation when 'XIANGQIAN' then concat_ws(',', collect_list(a.item_s)) end
    end as dt20150516itXIANGQIAN,
case dt when '20150517' then
    case operation when 'XIANGQIAN' then concat_ws(',', collect_list(a.item_s)) end
    end as dt20150517itXIANGQIAN,
case dt when '20150518' then
    case operation when 'XIANGQIAN' then concat_ws(',', collect_list(a.item_s)) end
    end as dt20150518itXIANGQIAN,
case dt when '20150519' then
    case operation when 'XIANGQIAN' then concat_ws(',', collect_list(a.item_s)) end
    end as dt20150519itXIANGQIAN,
case dt when '20150520' then
    case operation when 'XIANGQIAN' then concat_ws(',', collect_list(a.item_s)) end
    end as dt20150520itXIANGQIAN
from 
(select *
FROM (
       SELECT src_Smithy_day.*, ROW_NUMBER() OVER(PARTITION BY role_id, dt, operation, `time` order by 1) RN
       FROM src_Smithy_day
)a
 WHERE a.RN=1)a
group by a.role_id, a.dt, a.operation)b
group by role_id;

--统计镶嵌用物品 第二周
create table weapons_xiangqian_day_list_2 as
select b.role_id as role_id,
max(b.dt20150521itXIANGQIAN) as dt20150521itXIANGQIAN,
max(b.dt20150522itXIANGQIAN) as dt20150522itXIANGQIAN,
max(b.dt20150523itXIANGQIAN) as dt20150523itXIANGQIAN,
max(b.dt20150524itXIANGQIAN) as dt20150524itXIANGQIAN,
max(b.dt20150525itXIANGQIAN) as dt20150525itXIANGQIAN,
max(b.dt20150526itXIANGQIAN) as dt20150526itXIANGQIAN,
max(b.dt20150527itXIANGQIAN) as dt20150527itXIANGQIAN
from
(
select
    a.role_id as role_id, 
case dt when '20150521' then
    case operation when 'XIANGQIAN' then concat_ws(',', collect_list(a.item_s)) end
    end as dt20150521itXIANGQIAN,
case dt when '20150522' then
    case operation when 'XIANGQIAN' then concat_ws(',', collect_list(a.item_s)) end
    end as dt20150522itXIANGQIAN,
case dt when '20150523' then
    case operation when 'XIANGQIAN' then concat_ws(',', collect_list(a.item_s)) end
    end as dt20150523itXIANGQIAN,
case dt when '20150524' then
    case operation when 'XIANGQIAN' then concat_ws(',', collect_list(a.item_s)) end
    end as dt20150524itXIANGQIAN,
case dt when '20150525' then
    case operation when 'XIANGQIAN' then concat_ws(',', collect_list(a.item_s)) end
    end as dt20150525itXIANGQIAN,
case dt when '20150526' then
    case operation when 'XIANGQIAN' then concat_ws(',', collect_list(a.item_s)) end
    end as dt20150526itXIANGQIAN,
case dt when '20150527' then
    case operation when 'XIANGQIAN' then concat_ws(',', collect_list(a.item_s)) end
    end as dt20150527itXIANGQIAN
from 
(select *
FROM (
       SELECT src_Smithy_day.*, ROW_NUMBER() OVER(PARTITION BY role_id, dt, operation, `time` order by 1) RN
       FROM src_Smithy_day
)a
 WHERE a.RN=1)a
group by a.role_id, a.dt, a.operation)b
group by role_id;

--鸿蒙熔炼 记录每天操作次数 第一周
create table ronglian_times_day_1 as
select a.role_id as role_id, 
sum(a.dt20150514ronglian) as dt20150514ronglian,
sum(a.dt20150515ronglian) as dt20150515ronglian,
sum(a.dt20150516ronglian) as dt20150516ronglian,
sum(a.dt20150517ronglian) as dt20150517ronglian,
sum(a.dt20150518ronglian) as dt20150518ronglian,
sum(a.dt20150519ronglian) as dt20150519ronglian,
sum(a.dt20150520ronglian) as dt20150520ronglian
from(
select role_id, 
case dt when '20150514' then count(*) 
end as dt20150514ronglian,
case dt when '20150515' then count(*)  
end as dt20150515ronglian,
case dt when '20150516' then count(*)  
end as dt20150516ronglian,
case dt when '20150517' then count(*)  
end as dt20150517ronglian,
case dt when '20150518' then count(*)  
end as dt20150518ronglian,
case dt when '20150519' then count(*)  
end as dt20150519ronglian,
case dt when '20150520' then count(*)  
end as dt20150520ronglian
from src_Ronglian_day
group by role_id, dt)a
group by role_id;

--鸿蒙熔炼 记录每天操作次数 第二周
create table ronglian_times_day_2 as
select a.role_id as role_id, 
sum(a.dt20150521ronglian) as dt20150521ronglian,
sum(a.dt20150522ronglian) as dt20150522ronglian,
sum(a.dt20150523ronglian) as dt20150523ronglian,
sum(a.dt20150524ronglian) as dt20150524ronglian,
sum(a.dt20150525ronglian) as dt20150525ronglian,
sum(a.dt20150526ronglian) as dt20150526ronglian,
sum(a.dt20150527ronglian) as dt20150527ronglian
from(
select role_id, 
case dt when '20150521' then count(*)  
end as dt20150521ronglian,
case dt when '20150522' then count(*)  
end as dt20150522ronglian,
case dt when '20150523' then count(*)  
end as dt20150523ronglian,
case dt when '20150524' then count(*)  
end as dt20150524ronglian,
case dt when '20150525' then count(*)  
end as dt20150525ronglian,
case dt when '20150526' then count(*)  
end as dt20150526ronglian,
case dt when '20150527' then count(*)  
end as dt20150527ronglian
from src_Ronglian_day
group by role_id, dt)a
group by role_id;

--记录宝石相关操作次数 第一周
create table ronglianbaoshi_times_day_1 as
select a.role_id as role_id, 
sum(a.dt20150514ronglianbaoshi) as dt20150514ronglianbaoshi,
sum(a.dt20150515ronglianbaoshi) as dt20150515ronglianbaoshi,
sum(a.dt20150516ronglianbaoshi) as dt20150516ronglianbaoshi,
sum(a.dt20150517ronglianbaoshi) as dt20150517ronglianbaoshi,
sum(a.dt20150518ronglianbaoshi) as dt20150518ronglianbaoshi,
sum(a.dt20150519ronglianbaoshi) as dt20150519ronglianbaoshi,
sum(a.dt20150520ronglianbaoshi) as dt20150520ronglianbaoshi
from(
select role_id, 
case dt when '20150514' then count(*) 
end as dt20150514ronglianbaoshi,
case dt when '20150515' then count(*)  
end as dt20150515ronglianbaoshi,
case dt when '20150516' then count(*)  
end as dt20150516ronglianbaoshi,
case dt when '20150517' then count(*)  
end as dt20150517ronglianbaoshi,
case dt when '20150518' then count(*)  
end as dt20150518ronglianbaoshi,
case dt when '20150519' then count(*)  
end as dt20150519ronglianbaoshi,
case dt when '20150520' then count(*)  
end as dt20150520ronglianbaoshi
from src_Ronglian_day
where prod_items like concat('{','_', 830,'%')
group by role_id, dt)a
group by role_id;

--记录宝石相关操作次数 第二周
create table ronglianbaoshi_times_day_2 as
select a.role_id as role_id, 
sum(a.dt20150521ronglianbaoshi) as dt20150521ronglianbaoshi,
sum(a.dt20150522ronglianbaoshi) as dt20150522ronglianbaoshi,
sum(a.dt20150523ronglianbaoshi) as dt20150523ronglianbaoshi,
sum(a.dt20150524ronglianbaoshi) as dt20150524ronglianbaoshi,
sum(a.dt20150525ronglianbaoshi) as dt20150525ronglianbaoshi,
sum(a.dt20150526ronglianbaoshi) as dt20150526ronglianbaoshi,
sum(a.dt20150527ronglianbaoshi) as dt20150527ronglianbaoshi
from(
select role_id, 
case dt when '20150521' then count(*)  
end as dt20150521ronglianbaoshi,
case dt when '20150522' then count(*)  
end as dt20150522ronglianbaoshi,
case dt when '20150523' then count(*)  
end as dt20150523ronglianbaoshi,
case dt when '20150524' then count(*)  
end as dt20150524ronglianbaoshi,
case dt when '20150525' then count(*)  
end as dt20150525ronglianbaoshi,
case dt when '20150526' then count(*)  
end as dt20150526ronglianbaoshi,
case dt when '20150527' then count(*)  
end as dt20150527ronglianbaoshi
from src_Ronglian_day
where prod_items like concat('{','_', 830,'%')
group by role_id, dt)a
group by role_id;

--任务 记录每天领取、完成、放弃任务次数（并没有领取和放弃的数据）第一周
create table task_times_day_1 as
select a.role_id as role_id, 
sum(a.dt20150514task) as dt20150514task,
sum(a.dt20150515task) as dt20150515task,
sum(a.dt20150516task) as dt20150516task,
sum(a.dt20150517task) as dt20150517task,
sum(a.dt20150518task) as dt20150518task,
sum(a.dt20150519task) as dt20150519task,
sum(a.dt20150520task) as dt20150520task
from(
select role_id, 
case dt when '20150514' then count(*) 
end as dt20150514task,
case dt when '20150515' then count(*)  
end as dt20150515task,
case dt when '20150516' then count(*)  
end as dt20150516task,
case dt when '20150517' then count(*)  
end as dt20150517task,
case dt when '20150518' then count(*)  
end as dt20150518task,
case dt when '20150519' then count(*)  
end as dt20150519task,
case dt when '20150520' then count(*)  
end as dt20150520task
from src_Task_day
group by role_id, dt)a
group by role_id;

--任务 记录每天领取、完成、放弃任务次数（并没有领取和放弃的数据）第二周
create table task_times_day_2 as
select a.role_id as role_id, 
sum(a.dt20150521task) as dt20150521task,
sum(a.dt20150522task) as dt20150522task,
sum(a.dt20150523task) as dt20150523task,
sum(a.dt20150524task) as dt20150524task,
sum(a.dt20150525task) as dt20150525task,
sum(a.dt20150526task) as dt20150526task,
sum(a.dt20150527task) as dt20150527task
from(
select role_id, 
case dt when '20150521' then count(*)  
end as dt20150521task,
case dt when '20150522' then count(*)  
end as dt20150522task,
case dt when '20150523' then count(*)  
end as dt20150523task,
case dt when '20150524' then count(*)  
end as dt20150524task,
case dt when '20150525' then count(*)  
end as dt20150525task,
case dt when '20150526' then count(*)  
end as dt20150526task,
case dt when '20150527' then count(*)  
end as dt20150527task
from src_Task_day
group by role_id, dt)a
group by role_id;

--武道场 记录每天胜利和失败次数 第一周
create table battlewin_times_day_1 as
select a.role_id as role_id, 
sum(a.dt20150514battle) as dt20150514battle,
sum(a.dt20150515battle) as dt20150515battle,
sum(a.dt20150516battle) as dt20150516battle,
sum(a.dt20150517battle) as dt20150517battle,
sum(a.dt20150518battle) as dt20150518battle,
sum(a.dt20150519battle) as dt20150519battle,
sum(a.dt20150520battle) as dt20150520battle
from(
select role_id, 
case dt when '20150514' then count(*) 
end as dt20150514battle,
case dt when '20150515' then count(*)  
end as dt20150515battle,
case dt when '20150516' then count(*)  
end as dt20150516battle,
case dt when '20150517' then count(*)  
end as dt20150517battle,
case dt when '20150518' then count(*)  
end as dt20150518battle,
case dt when '20150519' then count(*)  
end as dt20150519battle,
case dt when '20150520' then count(*)  
end as dt20150520battle
from src_Battle_day
where success='true'
group by role_id, dt)a
group by role_id;

create table battlelose_times_day_1 as
select a.role_id as role_id, 
sum(a.dt20150514battle) as dt20150514battle,
sum(a.dt20150515battle) as dt20150515battle,
sum(a.dt20150516battle) as dt20150516battle,
sum(a.dt20150517battle) as dt20150517battle,
sum(a.dt20150518battle) as dt20150518battle,
sum(a.dt20150519battle) as dt20150519battle,
sum(a.dt20150520battle) as dt20150520battle
from(
select role_id, 
case dt when '20150514' then count(*) 
end as dt20150514battle,
case dt when '20150515' then count(*)  
end as dt20150515battle,
case dt when '20150516' then count(*)  
end as dt20150516battle,
case dt when '20150517' then count(*)  
end as dt20150517battle,
case dt when '20150518' then count(*)  
end as dt20150518battle,
case dt when '20150519' then count(*)  
end as dt20150519battle,
case dt when '20150520' then count(*)  
end as dt20150520battle
from src_Battle_day
where success='false'
group by role_id, dt)a
group by role_id;
--武道场 记录每天胜利和失败次数 第二周
create table battlewin_times_day_2 as
select a.role_id as role_id, 
sum(a.dt20150521battle) as dt20150521battle,
sum(a.dt20150522battle) as dt20150522battle,
sum(a.dt20150523battle) as dt20150523battle,
sum(a.dt20150524battle) as dt20150524battle,
sum(a.dt20150525battle) as dt20150525battle,
sum(a.dt20150526battle) as dt20150526battle,
sum(a.dt20150527battle) as dt20150527battle
from(
select role_id, 
case dt when '20150521' then count(*)  
end as dt20150521battle,
case dt when '20150522' then count(*)  
end as dt20150522battle,
case dt when '20150523' then count(*)  
end as dt20150523battle,
case dt when '20150524' then count(*)  
end as dt20150524battle,
case dt when '20150525' then count(*)  
end as dt20150525battle,
case dt when '20150526' then count(*)  
end as dt20150526battle,
case dt when '20150527' then count(*)  
end as dt20150527battle
from src_Battle_day
where success='true'
group by role_id, dt)a
group by role_id;

create table battlelose_times_day_2 as
select a.role_id as role_id, 
sum(a.dt20150521battle) as dt20150521battle,
sum(a.dt20150522battle) as dt20150522battle,
sum(a.dt20150523battle) as dt20150523battle,
sum(a.dt20150524battle) as dt20150524battle,
sum(a.dt20150525battle) as dt20150525battle,
sum(a.dt20150526battle) as dt20150526battle,
sum(a.dt20150527battle) as dt20150527battle
from(
select role_id, 
case dt when '20150521' then count(*)  
end as dt20150521battle,
case dt when '20150522' then count(*)  
end as dt20150522battle,
case dt when '20150523' then count(*)  
end as dt20150523battle,
case dt when '20150524' then count(*)  
end as dt20150524battle,
case dt when '20150525' then count(*)  
end as dt20150525battle,
case dt when '20150526' then count(*)  
end as dt20150526battle,
case dt when '20150527' then count(*)  
end as dt20150527battle
from src_Battle_day
where success='false'
group by role_id, dt)a
group by role_id;

--竞技场 记录每天胜利失败次数 第一周
create table combatwin_times_day_1 as
select a.role_id as role_id, 
sum(a.dt20150514combat) as dt20150514combat,
sum(a.dt20150515combat) as dt20150515combat,
sum(a.dt20150516combat) as dt20150516combat,
sum(a.dt20150517combat) as dt20150517combat,
sum(a.dt20150518combat) as dt20150518combat,
sum(a.dt20150519combat) as dt20150519combat,
sum(a.dt20150520combat) as dt20150520combat
from(
select role_id, 
case dt when '20150514' then count(*) 
end as dt20150514combat,
case dt when '20150515' then count(*)  
end as dt20150515combat,
case dt when '20150516' then count(*)  
end as dt20150516combat,
case dt when '20150517' then count(*)  
end as dt20150517combat,
case dt when '20150518' then count(*)  
end as dt20150518combat,
case dt when '20150519' then count(*)  
end as dt20150519combat,
case dt when '20150520' then count(*)  
end as dt20150520combat
from src_Combat_day
where success='true'
group by role_id, dt)a
group by role_id;

create table combatlose_times_day_1 as
select a.role_id as role_id, 
sum(a.dt20150514combat) as dt20150514combat,
sum(a.dt20150515combat) as dt20150515combat,
sum(a.dt20150516combat) as dt20150516combat,
sum(a.dt20150517combat) as dt20150517combat,
sum(a.dt20150518combat) as dt20150518combat,
sum(a.dt20150519combat) as dt20150519combat,
sum(a.dt20150520combat) as dt20150520combat
from(
select role_id, 
case dt when '20150514' then count(*) 
end as dt20150514combat,
case dt when '20150515' then count(*)  
end as dt20150515combat,
case dt when '20150516' then count(*)  
end as dt20150516combat,
case dt when '20150517' then count(*)  
end as dt20150517combat,
case dt when '20150518' then count(*)  
end as dt20150518combat,
case dt when '20150519' then count(*)  
end as dt20150519combat,
case dt when '20150520' then count(*)  
end as dt20150520combat
from src_Combat_day
where success='false'
group by role_id, dt)a
group by role_id;


--竞技场 记录每天胜利失败次数 第二周
create table combatwin_times_day_2 as
select a.role_id as role_id, 
sum(a.dt20150521combat) as dt20150521combat,
sum(a.dt20150522combat) as dt20150522combat,
sum(a.dt20150523combat) as dt20150523combat,
sum(a.dt20150524combat) as dt20150524combat,
sum(a.dt20150525combat) as dt20150525combat,
sum(a.dt20150526combat) as dt20150526combat,
sum(a.dt20150527combat) as dt20150527combat
from(
select role_id, 
case dt when '20150521' then count(*)  
end as dt20150521combat,
case dt when '20150522' then count(*)  
end as dt20150522combat,
case dt when '20150523' then count(*)  
end as dt20150523combat,
case dt when '20150524' then count(*)  
end as dt20150524combat,
case dt when '20150525' then count(*)  
end as dt20150525combat,
case dt when '20150526' then count(*)  
end as dt20150526combat,
case dt when '20150527' then count(*)  
end as dt20150527combat
from src_Combat_day
where success='true'
group by role_id, dt)a
group by role_id;

create table combatlose_times_day_2 as
select a.role_id as role_id, 
sum(a.dt20150521combat) as dt20150521combat,
sum(a.dt20150522combat) as dt20150522combat,
sum(a.dt20150523combat) as dt20150523combat,
sum(a.dt20150524combat) as dt20150524combat,
sum(a.dt20150525combat) as dt20150525combat,
sum(a.dt20150526combat) as dt20150526combat,
sum(a.dt20150527combat) as dt20150527combat
from(
select role_id, 
case dt when '20150521' then count(*)  
end as dt20150521combat,
case dt when '20150522' then count(*)  
end as dt20150522combat,
case dt when '20150523' then count(*)  
end as dt20150523combat,
case dt when '20150524' then count(*)  
end as dt20150524combat,
case dt when '20150525' then count(*)  
end as dt20150525combat,
case dt when '20150526' then count(*)  
end as dt20150526combat,
case dt when '20150527' then count(*)  
end as dt20150527combat
from src_Combat_day
where success='false'
group by role_id, dt)a
group by role_id;

--副本 记录每天完成副本次数和情况 第一周
create table gameplay_day_1 as
select a.role_id as role_id,
sum(a.dt20150514end_state_1) as dt20150514end_state_1,
sum(a.dt20150514end_state1) as dt20150514end_state1,
sum(a.dt20150514end_state2) as dt20150514end_state2,
sum(a.dt20150514end_state3) as dt20150514end_state3,
sum(a.dt20150514end_state4) as dt20150514end_state4,
sum(a.dt20150514end_state5) as dt20150514end_state5,
sum(a.dt20150514end_state6) as dt20150514end_state6,
sum(a.dt20150514end_state7) as dt20150514end_state7,
sum(a.dt20150515end_state_1) as dt20150515end_state_1,
sum(a.dt20150515end_state1) as dt20150515end_state1,
sum(a.dt20150515end_state2) as dt20150515end_state2,
sum(a.dt20150515end_state3) as dt20150515end_state3,
sum(a.dt20150515end_state4) as dt20150515end_state4,
sum(a.dt20150515end_state5) as dt20150515end_state5,
sum(a.dt20150515end_state6) as dt20150515end_state6,
sum(a.dt20150515end_state7) as dt20150515end_state7,
sum(a.dt20150516end_state_1) as dt20150516end_state_1,
sum(a.dt20150516end_state1) as dt20150516end_state1,
sum(a.dt20150516end_state2) as dt20150516end_state2,
sum(a.dt20150516end_state3) as dt20150516end_state3,
sum(a.dt20150516end_state4) as dt20150516end_state4,
sum(a.dt20150516end_state5) as dt20150516end_state5,
sum(a.dt20150516end_state6) as dt20150516end_state6,
sum(a.dt20150516end_state7) as dt20150516end_state7,
sum(a.dt20150517end_state_1) as dt20150517end_state_1,
sum(a.dt20150517end_state1) as dt20150517end_state1,
sum(a.dt20150517end_state2) as dt20150517end_state2,
sum(a.dt20150517end_state3) as dt20150517end_state3,
sum(a.dt20150517end_state4) as dt20150517end_state4,
sum(a.dt20150517end_state5) as dt20150517end_state5,
sum(a.dt20150517end_state6) as dt20150517end_state6,
sum(a.dt20150517end_state7) as dt20150517end_state7,
sum(a.dt20150518end_state_1) as dt20150518end_state_1,
sum(a.dt20150518end_state1) as dt20150518end_state1,
sum(a.dt20150518end_state2) as dt20150518end_state2,
sum(a.dt20150518end_state3) as dt20150518end_state3,
sum(a.dt20150518end_state4) as dt20150518end_state4,
sum(a.dt20150518end_state5) as dt20150518end_state5,
sum(a.dt20150518end_state6) as dt20150518end_state6,
sum(a.dt20150518end_state7) as dt20150518end_state7,
sum(a.dt20150519end_state_1) as dt20150519end_state_1,
sum(a.dt20150519end_state1) as dt20150519end_state1,
sum(a.dt20150519end_state2) as dt20150519end_state2,
sum(a.dt20150519end_state3) as dt20150519end_state3,
sum(a.dt20150519end_state4) as dt20150519end_state4,
sum(a.dt20150519end_state5) as dt20150519end_state5,
sum(a.dt20150519end_state6) as dt20150519end_state6,
sum(a.dt20150519end_state7) as dt20150519end_state7,
sum(a.dt20150520end_state_1) as dt20150520end_state_1,
sum(a.dt20150520end_state1) as dt20150520end_state1,
sum(a.dt20150520end_state2) as dt20150520end_state2,
sum(a.dt20150520end_state3) as dt20150520end_state3,
sum(a.dt20150520end_state4) as dt20150520end_state4,
sum(a.dt20150520end_state5) as dt20150520end_state5,
sum(a.dt20150520end_state6) as dt20150520end_state6,
sum(a.dt20150520end_state7) as dt20150520end_state7
from(
select role_id,
case dt when '20150514' then
    case end_state when -1 then count(*)  end
    end as dt20150514end_state_1,
case dt when '20150514' then
    case end_state when 1 then count(*)  end
    end as dt20150514end_state1,
case dt when '20150514' then
    case end_state when 2 then count(*)  end
    end as dt20150514end_state2,
case dt when '20150514' then
    case end_state when 3 then count(*)  end
    end as dt20150514end_state3,
case dt when '20150514' then
    case end_state when 4 then count(*)  end
    end as dt20150514end_state4,
case dt when '20150514' then
    case end_state when 5 then count(*)  end
    end as dt20150514end_state5,
case dt when '20150514' then
    case end_state when 6 then count(*)  end
    end as dt20150514end_state6,
case dt when '20150514' then
    case end_state when 7 then count(*)  end
    end as dt20150514end_state7,
case dt when '20150515' then
    case end_state when -1 then count(*)  end
    end as dt20150515end_state_1,
case dt when '20150515' then
    case end_state when 1 then count(*)  end
    end as dt20150515end_state1,
case dt when '20150515' then
    case end_state when 2 then count(*)  end
    end as dt20150515end_state2,
case dt when '20150515' then
    case end_state when 3 then count(*)  end
    end as dt20150515end_state3,
case dt when '20150515' then
    case end_state when 4 then count(*)  end
    end as dt20150515end_state4,
case dt when '20150515' then
    case end_state when 5 then count(*)  end
    end as dt20150515end_state5,
case dt when '20150515' then
    case end_state when 6 then count(*)  end
    end as dt20150515end_state6,
case dt when '20150515' then
    case end_state when 7 then count(*)  end
    end as dt20150515end_state7,
case dt when '20150516' then
    case end_state when -1 then count(*)  end
    end as dt20150516end_state_1,
case dt when '20150516' then
    case end_state when 1 then count(*)  end
    end as dt20150516end_state1,
case dt when '20150516' then
    case end_state when 2 then count(*)  end
    end as dt20150516end_state2,
case dt when '20150516' then
    case end_state when 3 then count(*)  end
    end as dt20150516end_state3,
case dt when '20150516' then
    case end_state when 4 then count(*)  end
    end as dt20150516end_state4,
case dt when '20150516' then
    case end_state when 5 then count(*)  end
    end as dt20150516end_state5,
case dt when '20150516' then
    case end_state when 6 then count(*)  end
    end as dt20150516end_state6,
case dt when '20150516' then
    case end_state when 7 then count(*)  end
    end as dt20150516end_state7,
case dt when '20150517' then
    case end_state when -1 then count(*)  end
    end as dt20150517end_state_1,
case dt when '20150517' then
    case end_state when 1 then count(*)  end
    end as dt20150517end_state1,
case dt when '20150517' then
    case end_state when 2 then count(*)  end
    end as dt20150517end_state2,
case dt when '20150517' then
    case end_state when 3 then count(*)  end
    end as dt20150517end_state3,
case dt when '20150517' then
    case end_state when 4 then count(*)  end
    end as dt20150517end_state4,
case dt when '20150517' then
    case end_state when 5 then count(*)  end
    end as dt20150517end_state5,
case dt when '20150517' then
    case end_state when 6 then count(*)  end
    end as dt20150517end_state6,
case dt when '20150517' then
    case end_state when 7 then count(*)  end
    end as dt20150517end_state7,
case dt when '20150518' then
    case end_state when -1 then count(*)  end
    end as dt20150518end_state_1,
case dt when '20150518' then
    case end_state when 1 then count(*)  end
    end as dt20150518end_state1,
case dt when '20150518' then
    case end_state when 2 then count(*)  end
    end as dt20150518end_state2,
case dt when '20150518' then
    case end_state when 3 then count(*)  end
    end as dt20150518end_state3,
case dt when '20150518' then
    case end_state when 4 then count(*)  end
    end as dt20150518end_state4,
case dt when '20150518' then
    case end_state when 5 then count(*)  end
    end as dt20150518end_state5,
case dt when '20150518' then
    case end_state when 6 then count(*)  end
    end as dt20150518end_state6,
case dt when '20150518' then
    case end_state when 7 then count(*)  end
    end as dt20150518end_state7,
case dt when '20150519' then
    case end_state when -1 then count(*)  end
    end as dt20150519end_state_1,
case dt when '20150519' then
    case end_state when 1 then count(*)  end
    end as dt20150519end_state1,
case dt when '20150519' then
    case end_state when 2 then count(*)  end
    end as dt20150519end_state2,
case dt when '20150519' then
    case end_state when 3 then count(*)  end
    end as dt20150519end_state3,
case dt when '20150519' then
    case end_state when 4 then count(*)  end
    end as dt20150519end_state4,
case dt when '20150519' then
    case end_state when 5 then count(*)  end
    end as dt20150519end_state5,
case dt when '20150519' then
    case end_state when 6 then count(*)  end
    end as dt20150519end_state6,
case dt when '20150519' then
    case end_state when 7 then count(*)  end
    end as dt20150519end_state7,
case dt when '20150520' then
    case end_state when -1 then count(*)  end
    end as dt20150520end_state_1,
case dt when '20150520' then
    case end_state when 1 then count(*)  end
    end as dt20150520end_state1,
case dt when '20150520' then
    case end_state when 2 then count(*)  end
    end as dt20150520end_state2,
case dt when '20150520' then
    case end_state when 3 then count(*)  end
    end as dt20150520end_state3,
case dt when '20150520' then
    case end_state when 4 then count(*)  end
    end as dt20150520end_state4,
case dt when '20150520' then
    case end_state when 5 then count(*)  end
    end as dt20150520end_state5,
case dt when '20150520' then
    case end_state when 6 then count(*)  end
    end as dt20150520end_state6,
case dt when '20150520' then
    case end_state when 7 then count(*)  end
    end as dt20150520end_state7
from src_Gameplay_day
group by role_id, dt, end_state)a
group by role_id;

--副本 记录每天完成副本次数和情况 第二周
create table gameplay_day_2 as
select a.role_id as role_id,
sum(a.dt20150521end_state_1) as dt20150521end_state_1,
sum(a.dt20150521end_state1) as dt20150521end_state1,
sum(a.dt20150521end_state2) as dt20150521end_state2,
sum(a.dt20150521end_state3) as dt20150521end_state3,
sum(a.dt20150521end_state4) as dt20150521end_state4,
sum(a.dt20150521end_state5) as dt20150521end_state5,
sum(a.dt20150521end_state6) as dt20150521end_state6,
sum(a.dt20150521end_state7) as dt20150521end_state7,
sum(a.dt20150522end_state_1) as dt20150522end_state_1,
sum(a.dt20150522end_state1) as dt20150522end_state1,
sum(a.dt20150522end_state2) as dt20150522end_state2,
sum(a.dt20150522end_state3) as dt20150522end_state3,
sum(a.dt20150522end_state4) as dt20150522end_state4,
sum(a.dt20150522end_state5) as dt20150522end_state5,
sum(a.dt20150522end_state6) as dt20150522end_state6,
sum(a.dt20150522end_state7) as dt20150522end_state7,
sum(a.dt20150523end_state_1) as dt20150523end_state_1,
sum(a.dt20150523end_state1) as dt20150523end_state1,
sum(a.dt20150523end_state2) as dt20150523end_state2,
sum(a.dt20150523end_state3) as dt20150523end_state3,
sum(a.dt20150523end_state4) as dt20150523end_state4,
sum(a.dt20150523end_state5) as dt20150523end_state5,
sum(a.dt20150523end_state6) as dt20150523end_state6,
sum(a.dt20150523end_state7) as dt20150523end_state7,
sum(a.dt20150524end_state_1) as dt20150524end_state_1,
sum(a.dt20150524end_state1) as dt20150524end_state1,
sum(a.dt20150524end_state2) as dt20150524end_state2,
sum(a.dt20150524end_state3) as dt20150524end_state3,
sum(a.dt20150524end_state4) as dt20150524end_state4,
sum(a.dt20150524end_state5) as dt20150524end_state5,
sum(a.dt20150524end_state6) as dt20150524end_state6,
sum(a.dt20150524end_state7) as dt20150524end_state7,
sum(a.dt20150525end_state_1) as dt20150525end_state_1,
sum(a.dt20150525end_state1) as dt20150525end_state1,
sum(a.dt20150525end_state2) as dt20150525end_state2,
sum(a.dt20150525end_state3) as dt20150525end_state3,
sum(a.dt20150525end_state4) as dt20150525end_state4,
sum(a.dt20150525end_state5) as dt20150525end_state5,
sum(a.dt20150525end_state6) as dt20150525end_state6,
sum(a.dt20150525end_state7) as dt20150525end_state7,
sum(a.dt20150526end_state_1) as dt20150526end_state_1,
sum(a.dt20150526end_state1) as dt20150526end_state1,
sum(a.dt20150526end_state2) as dt20150526end_state2,
sum(a.dt20150526end_state3) as dt20150526end_state3,
sum(a.dt20150526end_state4) as dt20150526end_state4,
sum(a.dt20150526end_state5) as dt20150526end_state5,
sum(a.dt20150526end_state6) as dt20150526end_state6,
sum(a.dt20150526end_state7) as dt20150526end_state7,
sum(a.dt20150527end_state_1) as dt20150527end_state_1,
sum(a.dt20150527end_state1) as dt20150527end_state1,
sum(a.dt20150527end_state2) as dt20150527end_state2,
sum(a.dt20150527end_state3) as dt20150527end_state3,
sum(a.dt20150527end_state4) as dt20150527end_state4,
sum(a.dt20150527end_state5) as dt20150527end_state5,
sum(a.dt20150527end_state6) as dt20150527end_state6,
sum(a.dt20150527end_state7) as dt20150527end_state7
from(
select role_id,
case dt when '20150521' then
    case end_state when -1 then count(*)  end
    end as dt20150521end_state_1,
case dt when '20150521' then
    case end_state when 1 then count(*)  end
    end as dt20150521end_state1,
case dt when '20150521' then
    case end_state when 2 then count(*)  end
    end as dt20150521end_state2,
case dt when '20150521' then
    case end_state when 3 then count(*)  end
    end as dt20150521end_state3,
case dt when '20150521' then
    case end_state when 4 then count(*)  end
    end as dt20150521end_state4,
case dt when '20150521' then
    case end_state when 5 then count(*)  end
    end as dt20150521end_state5,
case dt when '20150521' then
    case end_state when 6 then count(*)  end
    end as dt20150521end_state6,
case dt when '20150521' then
    case end_state when 7 then count(*)  end
    end as dt20150521end_state7,
case dt when '20150522' then
    case end_state when -1 then count(*)  end
    end as dt20150522end_state_1,
case dt when '20150522' then
    case end_state when 1 then count(*)  end
    end as dt20150522end_state1,
case dt when '20150522' then
    case end_state when 2 then count(*)  end
    end as dt20150522end_state2,
case dt when '20150522' then
    case end_state when 3 then count(*)  end
    end as dt20150522end_state3,
case dt when '20150522' then
    case end_state when 4 then count(*)  end
    end as dt20150522end_state4,
case dt when '20150522' then
    case end_state when 5 then count(*)  end
    end as dt20150522end_state5,
case dt when '20150522' then
    case end_state when 6 then count(*)  end
    end as dt20150522end_state6,
case dt when '20150522' then
    case end_state when 7 then count(*)  end
    end as dt20150522end_state7,
case dt when '20150523' then
    case end_state when -1 then count(*)  end
    end as dt20150523end_state_1,
case dt when '20150523' then
    case end_state when 1 then count(*)  end
    end as dt20150523end_state1,
case dt when '20150523' then
    case end_state when 2 then count(*)  end
    end as dt20150523end_state2,
case dt when '20150523' then
    case end_state when 3 then count(*)  end
    end as dt20150523end_state3,
case dt when '20150523' then
    case end_state when 4 then count(*)  end
    end as dt20150523end_state4,
case dt when '20150523' then
    case end_state when 5 then count(*)  end
    end as dt20150523end_state5,
case dt when '20150523' then
    case end_state when 6 then count(*)  end
    end as dt20150523end_state6,
case dt when '20150523' then
    case end_state when 7 then count(*)  end
    end as dt20150523end_state7,
case dt when '20150524' then
    case end_state when -1 then count(*)  end
    end as dt20150524end_state_1,
case dt when '20150524' then
    case end_state when 1 then count(*)  end
    end as dt20150524end_state1,
case dt when '20150524' then
    case end_state when 2 then count(*)  end
    end as dt20150524end_state2,
case dt when '20150524' then
    case end_state when 3 then count(*)  end
    end as dt20150524end_state3,
case dt when '20150524' then
    case end_state when 4 then count(*)  end
    end as dt20150524end_state4,
case dt when '20150524' then
    case end_state when 5 then count(*)  end
    end as dt20150524end_state5,
case dt when '20150524' then
    case end_state when 6 then count(*)  end
    end as dt20150524end_state6,
case dt when '20150524' then
    case end_state when 7 then count(*)  end
    end as dt20150524end_state7,
case dt when '20150525' then
    case end_state when -1 then count(*)  end
    end as dt20150525end_state_1,
case dt when '20150525' then
    case end_state when 1 then count(*)  end
    end as dt20150525end_state1,
case dt when '20150525' then
    case end_state when 2 then count(*)  end
    end as dt20150525end_state2,
case dt when '20150525' then
    case end_state when 3 then count(*)  end
    end as dt20150525end_state3,
case dt when '20150525' then
    case end_state when 4 then count(*)  end
    end as dt20150525end_state4,
case dt when '20150525' then
    case end_state when 5 then count(*)  end
    end as dt20150525end_state5,
case dt when '20150525' then
    case end_state when 6 then count(*)  end
    end as dt20150525end_state6,
case dt when '20150525' then
    case end_state when 7 then count(*)  end
    end as dt20150525end_state7,
case dt when '20150526' then
    case end_state when -1 then count(*)  end
    end as dt20150526end_state_1,
case dt when '20150526' then
    case end_state when 1 then count(*)  end
    end as dt20150526end_state1,
case dt when '20150526' then
    case end_state when 2 then count(*)  end
    end as dt20150526end_state2,
case dt when '20150526' then
    case end_state when 3 then count(*)  end
    end as dt20150526end_state3,
case dt when '20150526' then
    case end_state when 4 then count(*)  end
    end as dt20150526end_state4,
case dt when '20150526' then
    case end_state when 5 then count(*)  end
    end as dt20150526end_state5,
case dt when '20150526' then
    case end_state when 6 then count(*)  end
    end as dt20150526end_state6,
case dt when '20150526' then
    case end_state when 7 then count(*)  end
    end as dt20150526end_state7,
case dt when '20150527' then
    case end_state when -1 then count(*)  end
    end as dt20150527end_state_1,
case dt when '20150527' then
    case end_state when 1 then count(*)  end
    end as dt20150527end_state1,
case dt when '20150527' then
    case end_state when 2 then count(*)  end
    end as dt20150527end_state2,
case dt when '20150527' then
    case end_state when 3 then count(*)  end
    end as dt20150527end_state3,
case dt when '20150527' then
    case end_state when 4 then count(*)  end
    end as dt20150527end_state4,
case dt when '20150527' then
    case end_state when 5 then count(*)  end
    end as dt20150527end_state5,
case dt when '20150527' then
    case end_state when 6 then count(*)  end
    end as dt20150527end_state6,
case dt when '20150527' then
    case end_state when 7 then count(*)  end
    end as dt20150527end_state7
from src_Gameplay_day
group by role_id, dt, end_state)a
group by role_id;


create table career as
select
distinct role_id as role_id,
career as career
from src_userinfo_day;


--汇总第一周的训练数据集
create table train_data_
    as
select
    raw_data.role_id as role_id,
    login_day_1.device_model as device_model,
    login_day_1.os_name as os_name,
    login_day_1.os_ver as os_ver,
    login_day_1.app_channel as app_channel,
    login_day_1.app_ver as app_ver,
    login_day_1.server as server,
    login_day_1.login_times_week as login_times_week,
    login_day_1.time_after_create as time_after_create,
    items_buy_day_1.dt20150514item500000 as day1item500000,
    items_buy_day_1.dt20150514item500001 as day1item500001,
    items_buy_day_1.dt20150514item500002 as day1item500002,
    items_buy_day_1.dt20150514item510000 as day1item510000,
    items_buy_day_1.dt20150514item510001 as day1item510001,
    items_buy_day_1.dt20150514item510002 as day1item510002,
    items_buy_day_1.dt20150514item510003 as day1item510003,
    items_buy_day_1.dt20150514item510007 as day1item510007,
    items_buy_day_1.dt20150514item520091 as day1item520091,
    items_buy_day_1.dt20150514item525002 as day1item525002,
    items_buy_day_1.dt20150514item581000 as day1item581000,
    items_buy_day_1.dt20150514item581001 as day1item581001,
    items_buy_day_1.dt20150514item583001 as day1item583001,
    items_buy_day_1.dt20150514item583002 as day1item583002,
    items_buy_day_1.dt20150514item583003 as day1item583003,
    items_buy_day_1.dt20150514item584003 as day1item584003,
    items_buy_day_1.dt20150514item590603 as day1item590603,
    items_buy_day_1.dt20150515item500000 as day2item500000,
    items_buy_day_1.dt20150515item500001 as day2item500001,
    items_buy_day_1.dt20150515item500002 as day2item500002,
    items_buy_day_1.dt20150515item510000 as day2item510000,
    items_buy_day_1.dt20150515item510001 as day2item510001,
    items_buy_day_1.dt20150515item510002 as day2item510002,
    items_buy_day_1.dt20150515item510003 as day2item510003,
    items_buy_day_1.dt20150515item510007 as day2item510007,
    items_buy_day_1.dt20150515item520091 as day2item520091,
    items_buy_day_1.dt20150515item525002 as day2item525002,
    items_buy_day_1.dt20150515item581000 as day2item581000,
    items_buy_day_1.dt20150515item581001 as day2item581001,
    items_buy_day_1.dt20150515item583001 as day2item583001,
    items_buy_day_1.dt20150515item583002 as day2item583002,
    items_buy_day_1.dt20150515item583003 as day2item583003,
    items_buy_day_1.dt20150515item584003 as day2item584003,
    items_buy_day_1.dt20150515item590603 as day2item590603,
    items_buy_day_1.dt20150516item500000 as day3item500000,
    items_buy_day_1.dt20150516item500001 as day3item500001,
    items_buy_day_1.dt20150516item500002 as day3item500002,
    items_buy_day_1.dt20150516item510000 as day3item510000,
    items_buy_day_1.dt20150516item510001 as day3item510001,
    items_buy_day_1.dt20150516item510002 as day3item510002,
    items_buy_day_1.dt20150516item510003 as day3item510003,
    items_buy_day_1.dt20150516item510007 as day3item510007,
    items_buy_day_1.dt20150516item520091 as day3item520091,
    items_buy_day_1.dt20150516item525002 as day3item525002,
    items_buy_day_1.dt20150516item581000 as day3item581000,
    items_buy_day_1.dt20150516item581001 as day3item581001,
    items_buy_day_1.dt20150516item583001 as day3item583001,
    items_buy_day_1.dt20150516item583002 as day3item583002,
    items_buy_day_1.dt20150516item583003 as day3item583003,
    items_buy_day_1.dt20150516item584003 as day3item584003,
    items_buy_day_1.dt20150516item590603 as day3item590603,
    items_buy_day_1.dt20150517item500000 as day4item500000,
    items_buy_day_1.dt20150517item500001 as day4item500001,
    items_buy_day_1.dt20150517item500002 as day4item500002,
    items_buy_day_1.dt20150517item510000 as day4item510000,
    items_buy_day_1.dt20150517item510001 as day4item510001,
    items_buy_day_1.dt20150517item510002 as day4item510002,
    items_buy_day_1.dt20150517item510003 as day4item510003,
    items_buy_day_1.dt20150517item510007 as day4item510007,
    items_buy_day_1.dt20150517item520091 as day4item520091,
    items_buy_day_1.dt20150517item525002 as day4item525002,
    items_buy_day_1.dt20150517item581000 as day4item581000,
    items_buy_day_1.dt20150517item581001 as day4item581001,
    items_buy_day_1.dt20150517item583001 as day4item583001,
    items_buy_day_1.dt20150517item583002 as day4item583002,
    items_buy_day_1.dt20150517item583003 as day4item583003,
    items_buy_day_1.dt20150517item584003 as day4item584003,
    items_buy_day_1.dt20150517item590603 as day4item590603,
    items_buy_day_1.dt20150518item500000 as day5item500000,
    items_buy_day_1.dt20150518item500001 as day5item500001,
    items_buy_day_1.dt20150518item500002 as day5item500002,
    items_buy_day_1.dt20150518item510000 as day5item510000,
    items_buy_day_1.dt20150518item510001 as day5item510001,
    items_buy_day_1.dt20150518item510002 as day5item510002,
    items_buy_day_1.dt20150518item510003 as day5item510003,
    items_buy_day_1.dt20150518item510007 as day5item510007,
    items_buy_day_1.dt20150518item520091 as day5item520091,
    items_buy_day_1.dt20150518item525002 as day5item525002,
    items_buy_day_1.dt20150518item581000 as day5item581000,
    items_buy_day_1.dt20150518item581001 as day5item581001,
    items_buy_day_1.dt20150518item583001 as day5item583001,
    items_buy_day_1.dt20150518item583002 as day5item583002,
    items_buy_day_1.dt20150518item583003 as day5item583003,
    items_buy_day_1.dt20150518item584003 as day5item584003,
    items_buy_day_1.dt20150518item590603 as day5item590603,
    items_buy_day_1.dt20150519item500000 as day6item500000,
    items_buy_day_1.dt20150519item500001 as day6item500001,
    items_buy_day_1.dt20150519item500002 as day6item500002,
    items_buy_day_1.dt20150519item510000 as day6item510000,
    items_buy_day_1.dt20150519item510001 as day6item510001,
    items_buy_day_1.dt20150519item510002 as day6item510002,
    items_buy_day_1.dt20150519item510003 as day6item510003,
    items_buy_day_1.dt20150519item510007 as day6item510007,
    items_buy_day_1.dt20150519item520091 as day6item520091,
    items_buy_day_1.dt20150519item525002 as day6item525002,
    items_buy_day_1.dt20150519item581000 as day6item581000,
    items_buy_day_1.dt20150519item581001 as day6item581001,
    items_buy_day_1.dt20150519item583001 as day6item583001,
    items_buy_day_1.dt20150519item583002 as day6item583002,
    items_buy_day_1.dt20150519item583003 as day6item583003,
    items_buy_day_1.dt20150519item584003 as day6item584003,
    items_buy_day_1.dt20150519item590603 as day6item590603,
    items_buy_day_1.dt20150520item500000 as day7item500000,
    items_buy_day_1.dt20150520item500001 as day7item500001,
    items_buy_day_1.dt20150520item500002 as day7item500002,
    items_buy_day_1.dt20150520item510000 as day7item510000,
    items_buy_day_1.dt20150520item510001 as day7item510001,
    items_buy_day_1.dt20150520item510002 as day7item510002,
    items_buy_day_1.dt20150520item510003 as day7item510003,
    items_buy_day_1.dt20150520item510007 as day7item510007,
    items_buy_day_1.dt20150520item520091 as day7item520091,
    items_buy_day_1.dt20150520item525002 as day7item525002,
    items_buy_day_1.dt20150520item581000 as day7item581000,
    items_buy_day_1.dt20150520item581001 as day7item581001,
    items_buy_day_1.dt20150520item583001 as day7item583001,
    items_buy_day_1.dt20150520item583002 as day7item583002,
    items_buy_day_1.dt20150520item583003 as day7item583003,
    items_buy_day_1.dt20150520item584003 as day7item584003,
    items_buy_day_1.dt20150520item590603 as day7item590603,
    items_buy_day_free_1.dt20150514item500000free as day1item500000free,
    items_buy_day_free_1.dt20150514item500001free as day1item500001free,
    items_buy_day_free_1.dt20150514item500002free as day1item500002free,
    items_buy_day_free_1.dt20150514item510000free as day1item510000free,
    items_buy_day_free_1.dt20150514item510001free as day1item510001free,
    items_buy_day_free_1.dt20150514item510002free as day1item510002free,
    items_buy_day_free_1.dt20150514item510003free as day1item510003free,
    items_buy_day_free_1.dt20150514item510007free as day1item510007free,
    items_buy_day_free_1.dt20150514item520091free as day1item520091free,
    items_buy_day_free_1.dt20150514item525002free as day1item525002free,
    items_buy_day_free_1.dt20150514item581000free as day1item581000free,
    items_buy_day_free_1.dt20150514item581001free as day1item581001free,
    items_buy_day_free_1.dt20150514item583001free as day1item583001free,
    items_buy_day_free_1.dt20150514item583002free as day1item583002free,
    items_buy_day_free_1.dt20150514item583003free as day1item583003free,
    items_buy_day_free_1.dt20150514item584003free as day1item584003free,
    items_buy_day_free_1.dt20150514item590603free as day1item590603free,
    items_buy_day_free_1.dt20150515item500000free as day2item500000free,
    items_buy_day_free_1.dt20150515item500001free as day2item500001free,
    items_buy_day_free_1.dt20150515item500002free as day2item500002free,
    items_buy_day_free_1.dt20150515item510000free as day2item510000free,
    items_buy_day_free_1.dt20150515item510001free as day2item510001free,
    items_buy_day_free_1.dt20150515item510002free as day2item510002free,
    items_buy_day_free_1.dt20150515item510003free as day2item510003free,
    items_buy_day_free_1.dt20150515item510007free as day2item510007free,
    items_buy_day_free_1.dt20150515item520091free as day2item520091free,
    items_buy_day_free_1.dt20150515item525002free as day2item525002free,
    items_buy_day_free_1.dt20150515item581000free as day2item581000free,
    items_buy_day_free_1.dt20150515item581001free as day2item581001free,
    items_buy_day_free_1.dt20150515item583001free as day2item583001free,
    items_buy_day_free_1.dt20150515item583002free as day2item583002free,
    items_buy_day_free_1.dt20150515item583003free as day2item583003free,
    items_buy_day_free_1.dt20150515item584003free as day2item584003free,
    items_buy_day_free_1.dt20150515item590603free as day2item590603free,
    items_buy_day_free_1.dt20150516item500000free as day3item500000free,
    items_buy_day_free_1.dt20150516item500001free as day3item500001free,
    items_buy_day_free_1.dt20150516item500002free as day3item500002free,
    items_buy_day_free_1.dt20150516item510000free as day3item510000free,
    items_buy_day_free_1.dt20150516item510001free as day3item510001free,
    items_buy_day_free_1.dt20150516item510002free as day3item510002free,
    items_buy_day_free_1.dt20150516item510003free as day3item510003free,
    items_buy_day_free_1.dt20150516item510007free as day3item510007free,
    items_buy_day_free_1.dt20150516item520091free as day3item520091free,
    items_buy_day_free_1.dt20150516item525002free as day3item525002free,
    items_buy_day_free_1.dt20150516item581000free as day3item581000free,
    items_buy_day_free_1.dt20150516item581001free as day3item581001free,
    items_buy_day_free_1.dt20150516item583001free as day3item583001free,
    items_buy_day_free_1.dt20150516item583002free as day3item583002free,
    items_buy_day_free_1.dt20150516item583003free as day3item583003free,
    items_buy_day_free_1.dt20150516item584003free as day3item584003free,
    items_buy_day_free_1.dt20150516item590603free as day3item590603free,
    items_buy_day_free_1.dt20150517item500000free as day4item500000free,
    items_buy_day_free_1.dt20150517item500001free as day4item500001free,
    items_buy_day_free_1.dt20150517item500002free as day4item500002free,
    items_buy_day_free_1.dt20150517item510000free as day4item510000free,
    items_buy_day_free_1.dt20150517item510001free as day4item510001free,
    items_buy_day_free_1.dt20150517item510002free as day4item510002free,
    items_buy_day_free_1.dt20150517item510003free as day4item510003free,
    items_buy_day_free_1.dt20150517item510007free as day4item510007free,
    items_buy_day_free_1.dt20150517item520091free as day4item520091free,
    items_buy_day_free_1.dt20150517item525002free as day4item525002free,
    items_buy_day_free_1.dt20150517item581000free as day4item581000free,
    items_buy_day_free_1.dt20150517item581001free as day4item581001free,
    items_buy_day_free_1.dt20150517item583001free as day4item583001free,
    items_buy_day_free_1.dt20150517item583002free as day4item583002free,
    items_buy_day_free_1.dt20150517item583003free as day4item583003free,
    items_buy_day_free_1.dt20150517item584003free as day4item584003free,
    items_buy_day_free_1.dt20150517item590603free as day4item590603free,
    items_buy_day_free_1.dt20150518item500000free as day5item500000free,
    items_buy_day_free_1.dt20150518item500001free as day5item500001free,
    items_buy_day_free_1.dt20150518item500002free as day5item500002free,
    items_buy_day_free_1.dt20150518item510000free as day5item510000free,
    items_buy_day_free_1.dt20150518item510001free as day5item510001free,
    items_buy_day_free_1.dt20150518item510002free as day5item510002free,
    items_buy_day_free_1.dt20150518item510003free as day5item510003free,
    items_buy_day_free_1.dt20150518item510007free as day5item510007free,
    items_buy_day_free_1.dt20150518item520091free as day5item520091free,
    items_buy_day_free_1.dt20150518item525002free as day5item525002free,
    items_buy_day_free_1.dt20150518item581000free as day5item581000free,
    items_buy_day_free_1.dt20150518item581001free as day5item581001free,
    items_buy_day_free_1.dt20150518item583001free as day5item583001free,
    items_buy_day_free_1.dt20150518item583002free as day5item583002free,
    items_buy_day_free_1.dt20150518item583003free as day5item583003free,
    items_buy_day_free_1.dt20150518item584003free as day5item584003free,
    items_buy_day_free_1.dt20150518item590603free as day5item590603free,
    items_buy_day_free_1.dt20150519item500000free as day6item500000free,
    items_buy_day_free_1.dt20150519item500001free as day6item500001free,
    items_buy_day_free_1.dt20150519item500002free as day6item500002free,
    items_buy_day_free_1.dt20150519item510000free as day6item510000free,
    items_buy_day_free_1.dt20150519item510001free as day6item510001free,
    items_buy_day_free_1.dt20150519item510002free as day6item510002free,
    items_buy_day_free_1.dt20150519item510003free as day6item510003free,
    items_buy_day_free_1.dt20150519item510007free as day6item510007free,
    items_buy_day_free_1.dt20150519item520091free as day6item520091free,
    items_buy_day_free_1.dt20150519item525002free as day6item525002free,
    items_buy_day_free_1.dt20150519item581000free as day6item581000free,
    items_buy_day_free_1.dt20150519item581001free as day6item581001free,
    items_buy_day_free_1.dt20150519item583001free as day6item583001free,
    items_buy_day_free_1.dt20150519item583002free as day6item583002free,
    items_buy_day_free_1.dt20150519item583003free as day6item583003free,
    items_buy_day_free_1.dt20150519item584003free as day6item584003free,
    items_buy_day_free_1.dt20150519item590603free as day6item590603free,
    items_buy_day_free_1.dt20150520item500000free as day7item500000free,
    items_buy_day_free_1.dt20150520item500001free as day7item500001free,
    items_buy_day_free_1.dt20150520item500002free as day7item500002free,
    items_buy_day_free_1.dt20150520item510000free as day7item510000free,
    items_buy_day_free_1.dt20150520item510001free as day7item510001free,
    items_buy_day_free_1.dt20150520item510002free as day7item510002free,
    items_buy_day_free_1.dt20150520item510003free as day7item510003free,
    items_buy_day_free_1.dt20150520item510007free as day7item510007free,
    items_buy_day_free_1.dt20150520item520091free as day7item520091free,
    items_buy_day_free_1.dt20150520item525002free as day7item525002free,
    items_buy_day_free_1.dt20150520item581000free as day7item581000free,
    items_buy_day_free_1.dt20150520item581001free as day7item581001free,
    items_buy_day_free_1.dt20150520item583001free as day7item583001free,
    items_buy_day_free_1.dt20150520item583002free as day7item583002free,
    items_buy_day_free_1.dt20150520item583003free as day7item583003free,
    items_buy_day_free_1.dt20150520item584003free as day7item584003free,
    items_buy_day_free_1.dt20150520item590603free as day7item590603free,
    role_cash_1.dt20150514cash as day1cash,
    role_cash_1.dt20150515cash as day2cash,
    role_cash_1.dt20150516cash as day3cash,
    role_cash_1.dt20150517cash as day4cash,
    role_cash_1.dt20150518cash as day5cash,
    role_cash_1.dt20150519cash as day6cash,
    role_cash_1.dt20150520cash as day7cash,
    weapons_kaikong_day_1.dt20150514opJIAHU as day1opJIAHU,
    weapons_kaikong_day_1.dt20150514opKAIKONG as day1opKAIKONG,
    weapons_kaikong_day_1.dt20150514opXIANGQIAN as day1opXIANGQIAN,
    weapons_kaikong_day_1.dt20150514opDUANZAO as day1opDUANZAO,
    weapons_kaikong_day_1.dt20150515opJIAHU as day2opJIAHU,
    weapons_kaikong_day_1.dt20150515opKAIKONG as day2opKAIKONG,
    weapons_kaikong_day_1.dt20150515opXIANGQIAN as day2opXIANGQIAN,
    weapons_kaikong_day_1.dt20150515opDUANZAO as day2opDUANZAO,
    weapons_kaikong_day_1.dt20150516opJIAHU as day3opJIAHU,
    weapons_kaikong_day_1.dt20150516opKAIKONG as day3opKAIKONG,
    weapons_kaikong_day_1.dt20150516opXIANGQIAN as day3opXIANGQIAN,
    weapons_kaikong_day_1.dt20150516opDUANZAO as day3opDUANZAO,
    weapons_kaikong_day_1.dt20150517opJIAHU as day4opJIAHU,
    weapons_kaikong_day_1.dt20150517opKAIKONG as day4opKAIKONG,
    weapons_kaikong_day_1.dt20150517opXIANGQIAN as day4opXIANGQIAN,
    weapons_kaikong_day_1.dt20150517opDUANZAO as day4opDUANZAO,
    weapons_kaikong_day_1.dt20150518opJIAHU as day5opJIAHU,
    weapons_kaikong_day_1.dt20150518opKAIKONG as day5opKAIKONG,
    weapons_kaikong_day_1.dt20150518opXIANGQIAN as day5opXIANGQIAN,
    weapons_kaikong_day_1.dt20150518opDUANZAO as day5opDUANZAO,
    weapons_kaikong_day_1.dt20150519opJIAHU as day6opJIAHU,
    weapons_kaikong_day_1.dt20150519opKAIKONG as day6opKAIKONG,
    weapons_kaikong_day_1.dt20150519opXIANGQIAN as day6opXIANGQIAN,
    weapons_kaikong_day_1.dt20150519opDUANZAO as day6opDUANZAO,
    weapons_kaikong_day_1.dt20150520opJIAHU as day7opJIAHU,
    weapons_kaikong_day_1.dt20150520opKAIKONG as day7opKAIKONG,
    weapons_kaikong_day_1.dt20150520opXIANGQIAN as day7opXIANGQIAN,
    weapons_kaikong_day_1.dt20150520opDUANZAO as day7opDUANZAO,
    weapons_xiangqian_day_list_1.dt20150514itXIANGQIAN as day1itXIANGQIAN,
    weapons_xiangqian_day_list_1.dt20150515itXIANGQIAN as day2itXIANGQIAN,
    weapons_xiangqian_day_list_1.dt20150516itXIANGQIAN as day3itXIANGQIAN,
    weapons_xiangqian_day_list_1.dt20150517itXIANGQIAN as day4itXIANGQIAN,
    weapons_xiangqian_day_list_1.dt20150518itXIANGQIAN as day5itXIANGQIAN,
    weapons_xiangqian_day_list_1.dt20150519itXIANGQIAN as day6itXIANGQIAN,
    weapons_xiangqian_day_list_1.dt20150520itXIANGQIAN as day7itXIANGQIAN,
    ronglian_times_day_1.dt20150514ronglian as day1ronglian,
    ronglian_times_day_1.dt20150515ronglian as day2ronglian,
    ronglian_times_day_1.dt20150516ronglian as day3ronglian,
    ronglian_times_day_1.dt20150517ronglian as day4ronglian,
    ronglian_times_day_1.dt20150518ronglian as day5ronglian,
    ronglian_times_day_1.dt20150519ronglian as day6ronglian,
    ronglian_times_day_1.dt20150520ronglian as day7ronglian,
    ronglianbaoshi_times_day_1.dt20150514ronglianbaoshi as day1ronglianbaoshi,
    ronglianbaoshi_times_day_1.dt20150515ronglianbaoshi as day2ronglianbaoshi,
    ronglianbaoshi_times_day_1.dt20150516ronglianbaoshi as day3ronglianbaoshi,
    ronglianbaoshi_times_day_1.dt20150517ronglianbaoshi as day4ronglianbaoshi,
    ronglianbaoshi_times_day_1.dt20150518ronglianbaoshi as day5ronglianbaoshi,
    ronglianbaoshi_times_day_1.dt20150519ronglianbaoshi as day6ronglianbaoshi,
    ronglianbaoshi_times_day_1.dt20150520ronglianbaoshi as day7ronglianbaoshi,
    task_times_day_1.dt20150514task as day1task,
    task_times_day_1.dt20150515task as day2task,
    task_times_day_1.dt20150516task as day3task,
    task_times_day_1.dt20150517task as day4task,
    task_times_day_1.dt20150518task as day5task,
    task_times_day_1.dt20150519task as day6task,
    task_times_day_1.dt20150520task as day7task,
    battlewin_times_day_1.dt20150514battle as day1battlewin,
    battlewin_times_day_1.dt20150515battle as day2battlewin,
    battlewin_times_day_1.dt20150516battle as day3battlewin,
    battlewin_times_day_1.dt20150517battle as day4battlewin,
    battlewin_times_day_1.dt20150518battle as day5battlewin,
    battlewin_times_day_1.dt20150519battle as day6battlewin,
    battlewin_times_day_1.dt20150520battle as day7battlewin,
    battlelose_times_day_1.dt20150514battle as day1battlelose,
    battlelose_times_day_1.dt20150515battle as day2battlelose,
    battlelose_times_day_1.dt20150516battle as day3battlelose,
    battlelose_times_day_1.dt20150517battle as day4battlelose,
    battlelose_times_day_1.dt20150518battle as day5battlelose,
    battlelose_times_day_1.dt20150519battle as day6battlelose,
    battlelose_times_day_1.dt20150520battle as day7battlelose,
    combatwin_times_day_1.dt20150514combat as day1combatwin,
    combatwin_times_day_1.dt20150515combat as day2combatwin,
    combatwin_times_day_1.dt20150516combat as day3combatwin,
    combatwin_times_day_1.dt20150517combat as day4combatwin,
    combatwin_times_day_1.dt20150518combat as day5combatwin,
    combatwin_times_day_1.dt20150519combat as day6combatwin,
    combatwin_times_day_1.dt20150520combat as day7combatwin,
    combatlose_times_day_1.dt20150514combat as day1combatlose,
    combatlose_times_day_1.dt20150515combat as day2combatlose,
    combatlose_times_day_1.dt20150516combat as day3combatlose,
    combatlose_times_day_1.dt20150517combat as day4combatlose,
    combatlose_times_day_1.dt20150518combat as day5combatlose,
    combatlose_times_day_1.dt20150519combat as day6combatlose,
    combatlose_times_day_1.dt20150520combat as day7combatlose,
    gameplay_day_1.dt20150514end_state_1 as day1end_state_1,
    gameplay_day_1.dt20150514end_state1 as day1end_state1,
    gameplay_day_1.dt20150514end_state2 as day1end_state2,
    gameplay_day_1.dt20150514end_state3 as day1end_state3,
    gameplay_day_1.dt20150514end_state4 as day1end_state4,
    gameplay_day_1.dt20150514end_state5 as day1end_state5,
    gameplay_day_1.dt20150514end_state6 as day1end_state6,
    gameplay_day_1.dt20150514end_state7 as day1end_state7,
    gameplay_day_1.dt20150515end_state_1 as day2end_state_1,
    gameplay_day_1.dt20150515end_state1 as day2end_state1,
    gameplay_day_1.dt20150515end_state2 as day2end_state2,
    gameplay_day_1.dt20150515end_state3 as day2end_state3,
    gameplay_day_1.dt20150515end_state4 as day2end_state4,
    gameplay_day_1.dt20150515end_state5 as day2end_state5,
    gameplay_day_1.dt20150515end_state6 as day2end_state6,
    gameplay_day_1.dt20150515end_state7 as day2end_state7,
    gameplay_day_1.dt20150516end_state_1 as day3end_state_1,
    gameplay_day_1.dt20150516end_state1 as day3end_state1,
    gameplay_day_1.dt20150516end_state2 as day3end_state2,
    gameplay_day_1.dt20150516end_state3 as day3end_state3,
    gameplay_day_1.dt20150516end_state4 as day3end_state4,
    gameplay_day_1.dt20150516end_state5 as day3end_state5,
    gameplay_day_1.dt20150516end_state6 as day3end_state6,
    gameplay_day_1.dt20150516end_state7 as day3end_state7,
    gameplay_day_1.dt20150517end_state_1 as day4end_state_1,
    gameplay_day_1.dt20150517end_state1 as day4end_state1,
    gameplay_day_1.dt20150517end_state2 as day4end_state2,
    gameplay_day_1.dt20150517end_state3 as day4end_state3,
    gameplay_day_1.dt20150517end_state4 as day4end_state4,
    gameplay_day_1.dt20150517end_state5 as day4end_state5,
    gameplay_day_1.dt20150517end_state6 as day4end_state6,
    gameplay_day_1.dt20150517end_state7 as day4end_state7,
    gameplay_day_1.dt20150518end_state_1 as day5end_state_1,
    gameplay_day_1.dt20150518end_state1 as day5end_state1,
    gameplay_day_1.dt20150518end_state2 as day5end_state2,
    gameplay_day_1.dt20150518end_state3 as day5end_state3,
    gameplay_day_1.dt20150518end_state4 as day5end_state4,
    gameplay_day_1.dt20150518end_state5 as day5end_state5,
    gameplay_day_1.dt20150518end_state6 as day5end_state6,
    gameplay_day_1.dt20150518end_state7 as day5end_state7,
    gameplay_day_1.dt20150519end_state_1 as day6end_state_1,
    gameplay_day_1.dt20150519end_state1 as day6end_state1,
    gameplay_day_1.dt20150519end_state2 as day6end_state2,
    gameplay_day_1.dt20150519end_state3 as day6end_state3,
    gameplay_day_1.dt20150519end_state4 as day6end_state4,
    gameplay_day_1.dt20150519end_state5 as day6end_state5,
    gameplay_day_1.dt20150519end_state6 as day6end_state6,
    gameplay_day_1.dt20150519end_state7 as day6end_state7,
    gameplay_day_1.dt20150520end_state_1 as day7end_state_1,
    gameplay_day_1.dt20150520end_state1 as day7end_state1,
    gameplay_day_1.dt20150520end_state2 as day7end_state2,
    gameplay_day_1.dt20150520end_state3 as day7end_state3,
    gameplay_day_1.dt20150520end_state4 as day7end_state4,
    gameplay_day_1.dt20150520end_state5 as day7end_state5,
    gameplay_day_1.dt20150520end_state6 as day7end_state6,
    gameplay_day_1.dt20150520end_state7 as day7end_state7,
    career.career as career,
    raw_data.label as label
from
    raw_data
left join
    login_day_1
on
    raw_data.role_id = login_day_1.role_id
left join
    items_buy_day_1
on
    raw_data.role_id = items_buy_day_1.role_id
left join
    items_buy_day_free_1
on
    raw_data.role_id = items_buy_day_free_1.role_id
left join
    role_cash_1
on
    raw_data.role_id = role_cash_1.role_id
left join
    weapons_kaikong_day_1
on
    raw_data.role_id = weapons_kaikong_day_1.role_id
left join
    weapons_xiangqian_day_list_1
on
    raw_data.role_id = weapons_xiangqian_day_list_1.role_id
left join
    ronglian_times_day_1
on
    raw_data.role_id = ronglian_times_day_1.role_id
left join
    ronglianbaoshi_times_day_1
on
    raw_data.role_id = ronglianbaoshi_times_day_1.role_id
left join
    task_times_day_1
on
    raw_data.role_id = task_times_day_1.role_id
left join
    battlewin_times_day_1
on
    raw_data.role_id = battlewin_times_day_1.role_id
left join
    battlelose_times_day_1
on
    raw_data.role_id = battlelose_times_day_1.role_id
left join
    combatwin_times_day_1
on
    raw_data.role_id = combatwin_times_day_1.role_id
left join
    combatlose_times_day_1
on
    raw_data.role_id = combatlose_times_day_1.role_id
left join
    gameplay_day_1
on
    raw_data.role_id = gameplay_day_1.role_id
left join
    career
on
    raw_data.role_id = career.role_id
--汇总第二周测试数据集
create table test_data_
    as
select
    role_id_test.role_id as role_id,
    login_day_2.device_model as device_model,
    login_day_2.os_name as os_name,
    login_day_2.os_ver as os_ver,
    login_day_2.app_channel as app_channel,
    login_day_2.app_ver as app_ver,
    login_day_2.server as server,
    login_day_2.login_times_week as login_times_week,
    login_day_2.time_after_create as time_after_create,
    items_buy_day_2.dt20150521item500000 as day1item500000,
    items_buy_day_2.dt20150521item500001 as day1item500001,
    items_buy_day_2.dt20150521item500002 as day1item500002,
    items_buy_day_2.dt20150521item510000 as day1item510000,
    items_buy_day_2.dt20150521item510001 as day1item510001,
    items_buy_day_2.dt20150521item510002 as day1item510002,
    items_buy_day_2.dt20150521item510003 as day1item510003,
    items_buy_day_2.dt20150521item510007 as day1item510007,
    items_buy_day_2.dt20150521item520091 as day1item520091,
    items_buy_day_2.dt20150521item525002 as day1item525002,
    items_buy_day_2.dt20150521item581000 as day1item581000,
    items_buy_day_2.dt20150521item581001 as day1item581001,
    items_buy_day_2.dt20150521item583001 as day1item583001,
    items_buy_day_2.dt20150521item583002 as day1item583002,
    items_buy_day_2.dt20150521item583003 as day1item583003,
    items_buy_day_2.dt20150521item584003 as day1item584003,
    items_buy_day_2.dt20150521item590603 as day1item590603,
    items_buy_day_2.dt20150522item500000 as day2item500000,
    items_buy_day_2.dt20150522item500001 as day2item500001,
    items_buy_day_2.dt20150522item500002 as day2item500002,
    items_buy_day_2.dt20150522item510000 as day2item510000,
    items_buy_day_2.dt20150522item510001 as day2item510001,
    items_buy_day_2.dt20150522item510002 as day2item510002,
    items_buy_day_2.dt20150522item510003 as day2item510003,
    items_buy_day_2.dt20150522item510007 as day2item510007,
    items_buy_day_2.dt20150522item520091 as day2item520091,
    items_buy_day_2.dt20150522item525002 as day2item525002,
    items_buy_day_2.dt20150522item581000 as day2item581000,
    items_buy_day_2.dt20150522item581001 as day2item581001,
    items_buy_day_2.dt20150522item583001 as day2item583001,
    items_buy_day_2.dt20150522item583002 as day2item583002,
    items_buy_day_2.dt20150522item583003 as day2item583003,
    items_buy_day_2.dt20150522item584003 as day2item584003,
    items_buy_day_2.dt20150522item590603 as day2item590603,
    items_buy_day_2.dt20150523item500000 as day3item500000,
    items_buy_day_2.dt20150523item500001 as day3item500001,
    items_buy_day_2.dt20150523item500002 as day3item500002,
    items_buy_day_2.dt20150523item510000 as day3item510000,
    items_buy_day_2.dt20150523item510001 as day3item510001,
    items_buy_day_2.dt20150523item510002 as day3item510002,
    items_buy_day_2.dt20150523item510003 as day3item510003,
    items_buy_day_2.dt20150523item510007 as day3item510007,
    items_buy_day_2.dt20150523item520091 as day3item520091,
    items_buy_day_2.dt20150523item525002 as day3item525002,
    items_buy_day_2.dt20150523item581000 as day3item581000,
    items_buy_day_2.dt20150523item581001 as day3item581001,
    items_buy_day_2.dt20150523item583001 as day3item583001,
    items_buy_day_2.dt20150523item583002 as day3item583002,
    items_buy_day_2.dt20150523item583003 as day3item583003,
    items_buy_day_2.dt20150523item584003 as day3item584003,
    items_buy_day_2.dt20150523item590603 as day3item590603,
    items_buy_day_2.dt20150524item500000 as day4item500000,
    items_buy_day_2.dt20150524item500001 as day4item500001,
    items_buy_day_2.dt20150524item500002 as day4item500002,
    items_buy_day_2.dt20150524item510000 as day4item510000,
    items_buy_day_2.dt20150524item510001 as day4item510001,
    items_buy_day_2.dt20150524item510002 as day4item510002,
    items_buy_day_2.dt20150524item510003 as day4item510003,
    items_buy_day_2.dt20150524item510007 as day4item510007,
    items_buy_day_2.dt20150524item520091 as day4item520091,
    items_buy_day_2.dt20150524item525002 as day4item525002,
    items_buy_day_2.dt20150524item581000 as day4item581000,
    items_buy_day_2.dt20150524item581001 as day4item581001,
    items_buy_day_2.dt20150524item583001 as day4item583001,
    items_buy_day_2.dt20150524item583002 as day4item583002,
    items_buy_day_2.dt20150524item583003 as day4item583003,
    items_buy_day_2.dt20150524item584003 as day4item584003,
    items_buy_day_2.dt20150524item590603 as day4item590603,
    items_buy_day_2.dt20150525item500000 as day5item500000,
    items_buy_day_2.dt20150525item500001 as day5item500001,
    items_buy_day_2.dt20150525item500002 as day5item500002,
    items_buy_day_2.dt20150525item510000 as day5item510000,
    items_buy_day_2.dt20150525item510001 as day5item510001,
    items_buy_day_2.dt20150525item510002 as day5item510002,
    items_buy_day_2.dt20150525item510003 as day5item510003,
    items_buy_day_2.dt20150525item510007 as day5item510007,
    items_buy_day_2.dt20150525item520091 as day5item520091,
    items_buy_day_2.dt20150525item525002 as day5item525002,
    items_buy_day_2.dt20150525item581000 as day5item581000,
    items_buy_day_2.dt20150525item581001 as day5item581001,
    items_buy_day_2.dt20150525item583001 as day5item583001,
    items_buy_day_2.dt20150525item583002 as day5item583002,
    items_buy_day_2.dt20150525item583003 as day5item583003,
    items_buy_day_2.dt20150525item584003 as day5item584003,
    items_buy_day_2.dt20150525item590603 as day5item590603,
    items_buy_day_2.dt20150526item500000 as day6item500000,
    items_buy_day_2.dt20150526item500001 as day6item500001,
    items_buy_day_2.dt20150526item500002 as day6item500002,
    items_buy_day_2.dt20150526item510000 as day6item510000,
    items_buy_day_2.dt20150526item510001 as day6item510001,
    items_buy_day_2.dt20150526item510002 as day6item510002,
    items_buy_day_2.dt20150526item510003 as day6item510003,
    items_buy_day_2.dt20150526item510007 as day6item510007,
    items_buy_day_2.dt20150526item520091 as day6item520091,
    items_buy_day_2.dt20150526item525002 as day6item525002,
    items_buy_day_2.dt20150526item581000 as day6item581000,
    items_buy_day_2.dt20150526item581001 as day6item581001,
    items_buy_day_2.dt20150526item583001 as day6item583001,
    items_buy_day_2.dt20150526item583002 as day6item583002,
    items_buy_day_2.dt20150526item583003 as day6item583003,
    items_buy_day_2.dt20150526item584003 as day6item584003,
    items_buy_day_2.dt20150526item590603 as day6item590603,
    items_buy_day_2.dt20150527item500000 as day7item500000,
    items_buy_day_2.dt20150527item500001 as day7item500001,
    items_buy_day_2.dt20150527item500002 as day7item500002,
    items_buy_day_2.dt20150527item510000 as day7item510000,
    items_buy_day_2.dt20150527item510001 as day7item510001,
    items_buy_day_2.dt20150527item510002 as day7item510002,
    items_buy_day_2.dt20150527item510003 as day7item510003,
    items_buy_day_2.dt20150527item510007 as day7item510007,
    items_buy_day_2.dt20150527item520091 as day7item520091,
    items_buy_day_2.dt20150527item525002 as day7item525002,
    items_buy_day_2.dt20150527item581000 as day7item581000,
    items_buy_day_2.dt20150527item581001 as day7item581001,
    items_buy_day_2.dt20150527item583001 as day7item583001,
    items_buy_day_2.dt20150527item583002 as day7item583002,
    items_buy_day_2.dt20150527item583003 as day7item583003,
    items_buy_day_2.dt20150527item584003 as day7item584003,
    items_buy_day_2.dt20150527item590603 as day7item590603,
    items_buy_day_free_2.dt20150521item500000free as day1item500000free,
    items_buy_day_free_2.dt20150521item500001free as day1item500001free,
    items_buy_day_free_2.dt20150521item500002free as day1item500002free,
    items_buy_day_free_2.dt20150521item510000free as day1item510000free,
    items_buy_day_free_2.dt20150521item510001free as day1item510001free,
    items_buy_day_free_2.dt20150521item510002free as day1item510002free,
    items_buy_day_free_2.dt20150521item510003free as day1item510003free,
    items_buy_day_free_2.dt20150521item510007free as day1item510007free,
    items_buy_day_free_2.dt20150521item520091free as day1item520091free,
    items_buy_day_free_2.dt20150521item525002free as day1item525002free,
    items_buy_day_free_2.dt20150521item581000free as day1item581000free,
    items_buy_day_free_2.dt20150521item581001free as day1item581001free,
    items_buy_day_free_2.dt20150521item583001free as day1item583001free,
    items_buy_day_free_2.dt20150521item583002free as day1item583002free,
    items_buy_day_free_2.dt20150521item583003free as day1item583003free,
    items_buy_day_free_2.dt20150521item584003free as day1item584003free,
    items_buy_day_free_2.dt20150521item590603free as day1item590603free,
    items_buy_day_free_2.dt20150522item500000free as day2item500000free,
    items_buy_day_free_2.dt20150522item500001free as day2item500001free,
    items_buy_day_free_2.dt20150522item500002free as day2item500002free,
    items_buy_day_free_2.dt20150522item510000free as day2item510000free,
    items_buy_day_free_2.dt20150522item510001free as day2item510001free,
    items_buy_day_free_2.dt20150522item510002free as day2item510002free,
    items_buy_day_free_2.dt20150522item510003free as day2item510003free,
    items_buy_day_free_2.dt20150522item510007free as day2item510007free,
    items_buy_day_free_2.dt20150522item520091free as day2item520091free,
    items_buy_day_free_2.dt20150522item525002free as day2item525002free,
    items_buy_day_free_2.dt20150522item581000free as day2item581000free,
    items_buy_day_free_2.dt20150522item581001free as day2item581001free,
    items_buy_day_free_2.dt20150522item583001free as day2item583001free,
    items_buy_day_free_2.dt20150522item583002free as day2item583002free,
    items_buy_day_free_2.dt20150522item583003free as day2item583003free,
    items_buy_day_free_2.dt20150522item584003free as day2item584003free,
    items_buy_day_free_2.dt20150522item590603free as day2item590603free,
    items_buy_day_free_2.dt20150523item500000free as day3item500000free,
    items_buy_day_free_2.dt20150523item500001free as day3item500001free,
    items_buy_day_free_2.dt20150523item500002free as day3item500002free,
    items_buy_day_free_2.dt20150523item510000free as day3item510000free,
    items_buy_day_free_2.dt20150523item510001free as day3item510001free,
    items_buy_day_free_2.dt20150523item510002free as day3item510002free,
    items_buy_day_free_2.dt20150523item510003free as day3item510003free,
    items_buy_day_free_2.dt20150523item510007free as day3item510007free,
    items_buy_day_free_2.dt20150523item520091free as day3item520091free,
    items_buy_day_free_2.dt20150523item525002free as day3item525002free,
    items_buy_day_free_2.dt20150523item581000free as day3item581000free,
    items_buy_day_free_2.dt20150523item581001free as day3item581001free,
    items_buy_day_free_2.dt20150523item583001free as day3item583001free,
    items_buy_day_free_2.dt20150523item583002free as day3item583002free,
    items_buy_day_free_2.dt20150523item583003free as day3item583003free,
    items_buy_day_free_2.dt20150523item584003free as day3item584003free,
    items_buy_day_free_2.dt20150523item590603free as day3item590603free,
    items_buy_day_free_2.dt20150524item500000free as day4item500000free,
    items_buy_day_free_2.dt20150524item500001free as day4item500001free,
    items_buy_day_free_2.dt20150524item500002free as day4item500002free,
    items_buy_day_free_2.dt20150524item510000free as day4item510000free,
    items_buy_day_free_2.dt20150524item510001free as day4item510001free,
    items_buy_day_free_2.dt20150524item510002free as day4item510002free,
    items_buy_day_free_2.dt20150524item510003free as day4item510003free,
    items_buy_day_free_2.dt20150524item510007free as day4item510007free,
    items_buy_day_free_2.dt20150524item520091free as day4item520091free,
    items_buy_day_free_2.dt20150524item525002free as day4item525002free,
    items_buy_day_free_2.dt20150524item581000free as day4item581000free,
    items_buy_day_free_2.dt20150524item581001free as day4item581001free,
    items_buy_day_free_2.dt20150524item583001free as day4item583001free,
    items_buy_day_free_2.dt20150524item583002free as day4item583002free,
    items_buy_day_free_2.dt20150524item583003free as day4item583003free,
    items_buy_day_free_2.dt20150524item584003free as day4item584003free,
    items_buy_day_free_2.dt20150524item590603free as day4item590603free,
    items_buy_day_free_2.dt20150525item500000free as day5item500000free,
    items_buy_day_free_2.dt20150525item500001free as day5item500001free,
    items_buy_day_free_2.dt20150525item500002free as day5item500002free,
    items_buy_day_free_2.dt20150525item510000free as day5item510000free,
    items_buy_day_free_2.dt20150525item510001free as day5item510001free,
    items_buy_day_free_2.dt20150525item510002free as day5item510002free,
    items_buy_day_free_2.dt20150525item510003free as day5item510003free,
    items_buy_day_free_2.dt20150525item510007free as day5item510007free,
    items_buy_day_free_2.dt20150525item520091free as day5item520091free,
    items_buy_day_free_2.dt20150525item525002free as day5item525002free,
    items_buy_day_free_2.dt20150525item581000free as day5item581000free,
    items_buy_day_free_2.dt20150525item581001free as day5item581001free,
    items_buy_day_free_2.dt20150525item583001free as day5item583001free,
    items_buy_day_free_2.dt20150525item583002free as day5item583002free,
    items_buy_day_free_2.dt20150525item583003free as day5item583003free,
    items_buy_day_free_2.dt20150525item584003free as day5item584003free,
    items_buy_day_free_2.dt20150525item590603free as day5item590603free,
    items_buy_day_free_2.dt20150526item500000free as day6item500000free,
    items_buy_day_free_2.dt20150526item500001free as day6item500001free,
    items_buy_day_free_2.dt20150526item500002free as day6item500002free,
    items_buy_day_free_2.dt20150526item510000free as day6item510000free,
    items_buy_day_free_2.dt20150526item510001free as day6item510001free,
    items_buy_day_free_2.dt20150526item510002free as day6item510002free,
    items_buy_day_free_2.dt20150526item510003free as day6item510003free,
    items_buy_day_free_2.dt20150526item510007free as day6item510007free,
    items_buy_day_free_2.dt20150526item520091free as day6item520091free,
    items_buy_day_free_2.dt20150526item525002free as day6item525002free,
    items_buy_day_free_2.dt20150526item581000free as day6item581000free,
    items_buy_day_free_2.dt20150526item581001free as day6item581001free,
    items_buy_day_free_2.dt20150526item583001free as day6item583001free,
    items_buy_day_free_2.dt20150526item583002free as day6item583002free,
    items_buy_day_free_2.dt20150526item583003free as day6item583003free,
    items_buy_day_free_2.dt20150526item584003free as day6item584003free,
    items_buy_day_free_2.dt20150526item590603free as day6item590603free,
    items_buy_day_free_2.dt20150527item500000free as day7item500000free,
    items_buy_day_free_2.dt20150527item500001free as day7item500001free,
    items_buy_day_free_2.dt20150527item500002free as day7item500002free,
    items_buy_day_free_2.dt20150527item510000free as day7item510000free,
    items_buy_day_free_2.dt20150527item510001free as day7item510001free,
    items_buy_day_free_2.dt20150527item510002free as day7item510002free,
    items_buy_day_free_2.dt20150527item510003free as day7item510003free,
    items_buy_day_free_2.dt20150527item510007free as day7item510007free,
    items_buy_day_free_2.dt20150527item520091free as day7item520091free,
    items_buy_day_free_2.dt20150527item525002free as day7item525002free,
    items_buy_day_free_2.dt20150527item581000free as day7item581000free,
    items_buy_day_free_2.dt20150527item581001free as day7item581001free,
    items_buy_day_free_2.dt20150527item583001free as day7item583001free,
    items_buy_day_free_2.dt20150527item583002free as day7item583002free,
    items_buy_day_free_2.dt20150527item583003free as day7item583003free,
    items_buy_day_free_2.dt20150527item584003free as day7item584003free,
    items_buy_day_free_2.dt20150527item590603free as day7item590603free,
    role_cash_2.dt20150521cash as day1cash,
    role_cash_2.dt20150522cash as day2cash,
    role_cash_2.dt20150523cash as day3cash,
    role_cash_2.dt20150524cash as day4cash,
    role_cash_2.dt20150525cash as day5cash,
    role_cash_2.dt20150526cash as day6cash,
    role_cash_2.dt20150527cash as day7cash,
    weapons_kaikong_day_2.dt20150521opJIAHU as day1opJIAHU,
    weapons_kaikong_day_2.dt20150521opKAIKONG as day1opKAIKONG,
    weapons_kaikong_day_2.dt20150521opXIANGQIAN as day1opXIANGQIAN,
    weapons_kaikong_day_2.dt20150521opDUANZAO as day1opDUANZAO,
    weapons_kaikong_day_2.dt20150522opJIAHU as day2opJIAHU,
    weapons_kaikong_day_2.dt20150522opKAIKONG as day2opKAIKONG,
    weapons_kaikong_day_2.dt20150522opXIANGQIAN as day2opXIANGQIAN,
    weapons_kaikong_day_2.dt20150522opDUANZAO as day2opDUANZAO,
    weapons_kaikong_day_2.dt20150523opJIAHU as day3opJIAHU,
    weapons_kaikong_day_2.dt20150523opKAIKONG as day3opKAIKONG,
    weapons_kaikong_day_2.dt20150523opXIANGQIAN as day3opXIANGQIAN,
    weapons_kaikong_day_2.dt20150523opDUANZAO as day3opDUANZAO,
    weapons_kaikong_day_2.dt20150524opJIAHU as day4opJIAHU,
    weapons_kaikong_day_2.dt20150524opKAIKONG as day4opKAIKONG,
    weapons_kaikong_day_2.dt20150524opXIANGQIAN as day4opXIANGQIAN,
    weapons_kaikong_day_2.dt20150524opDUANZAO as day4opDUANZAO,
    weapons_kaikong_day_2.dt20150525opJIAHU as day5opJIAHU,
    weapons_kaikong_day_2.dt20150525opKAIKONG as day5opKAIKONG,
    weapons_kaikong_day_2.dt20150525opXIANGQIAN as day5opXIANGQIAN,
    weapons_kaikong_day_2.dt20150525opDUANZAO as day5opDUANZAO,
    weapons_kaikong_day_2.dt20150526opJIAHU as day6opJIAHU,
    weapons_kaikong_day_2.dt20150526opKAIKONG as day6opKAIKONG,
    weapons_kaikong_day_2.dt20150526opXIANGQIAN as day6opXIANGQIAN,
    weapons_kaikong_day_2.dt20150526opDUANZAO as day6opDUANZAO,
    weapons_kaikong_day_2.dt20150527opJIAHU as day7opJIAHU,
    weapons_kaikong_day_2.dt20150527opKAIKONG as day7opKAIKONG,
    weapons_kaikong_day_2.dt20150527opXIANGQIAN as day7opXIANGQIAN,
    weapons_kaikong_day_2.dt20150527opDUANZAO as day7opDUANZAO, 
    weapons_xiangqian_day_list_2.dt20150521itXIANGQIAN as day1itXIANGQIAN,
    weapons_xiangqian_day_list_2.dt20150522itXIANGQIAN as day2itXIANGQIAN,
    weapons_xiangqian_day_list_2.dt20150523itXIANGQIAN as day3itXIANGQIAN,
    weapons_xiangqian_day_list_2.dt20150524itXIANGQIAN as day4itXIANGQIAN,
    weapons_xiangqian_day_list_2.dt20150525itXIANGQIAN as day5itXIANGQIAN,
    weapons_xiangqian_day_list_2.dt20150526itXIANGQIAN as day6itXIANGQIAN,
    weapons_xiangqian_day_list_2.dt20150527itXIANGQIAN as day7itXIANGQIAN,
    ronglian_times_day_2.dt20150521ronglian as day1ronglian,
    ronglian_times_day_2.dt20150522ronglian as day2ronglian,
    ronglian_times_day_2.dt20150523ronglian as day3ronglian,
    ronglian_times_day_2.dt20150524ronglian as day4ronglian,
    ronglian_times_day_2.dt20150525ronglian as day5ronglian,
    ronglian_times_day_2.dt20150526ronglian as day6ronglian,
    ronglian_times_day_2.dt20150527ronglian as day7ronglian,
    ronglianbaoshi_times_day_2.dt20150521ronglianbaoshi as day1ronglianbaoshi,
    ronglianbaoshi_times_day_2.dt20150522ronglianbaoshi as day2ronglianbaoshi,
    ronglianbaoshi_times_day_2.dt20150523ronglianbaoshi as day3ronglianbaoshi,
    ronglianbaoshi_times_day_2.dt20150524ronglianbaoshi as day4ronglianbaoshi,
    ronglianbaoshi_times_day_2.dt20150525ronglianbaoshi as day5ronglianbaoshi,
    ronglianbaoshi_times_day_2.dt20150526ronglianbaoshi as day6ronglianbaoshi,
    ronglianbaoshi_times_day_2.dt20150527ronglianbaoshi as day7ronglianbaoshi,
    task_times_day_2.dt20150521task as day1task,
    task_times_day_2.dt20150522task as day2task,
    task_times_day_2.dt20150523task as day3task,
    task_times_day_2.dt20150524task as day4task,
    task_times_day_2.dt20150525task as day5task,
    task_times_day_2.dt20150526task as day6task,
    task_times_day_2.dt20150527task as day7task,
    battlewin_times_day_2.dt20150521battle as day1battlewin,
    battlewin_times_day_2.dt20150522battle as day2battlewin,
    battlewin_times_day_2.dt20150523battle as day3battlewin,
    battlewin_times_day_2.dt20150524battle as day4battlewin,
    battlewin_times_day_2.dt20150525battle as day5battlewin,
    battlewin_times_day_2.dt20150526battle as day6battlewin,
    battlewin_times_day_2.dt20150527battle as day7battlewin,
    battlelose_times_day_2.dt20150521battle as day1battlelose,
    battlelose_times_day_2.dt20150522battle as day2battlelose,
    battlelose_times_day_2.dt20150523battle as day3battlelose,
    battlelose_times_day_2.dt20150524battle as day4battlelose,
    battlelose_times_day_2.dt20150525battle as day5battlelose,
    battlelose_times_day_2.dt20150526battle as day6battlelose,
    battlelose_times_day_2.dt20150527battle as day7battlelose,
    combatwin_times_day_2.dt20150521combat as day1combatwin,
    combatwin_times_day_2.dt20150522combat as day2combatwin,
    combatwin_times_day_2.dt20150523combat as day3combatwin,
    combatwin_times_day_2.dt20150524combat as day4combatwin,
    combatwin_times_day_2.dt20150525combat as day5combatwin,
    combatwin_times_day_2.dt20150526combat as day6combatwin,
    combatwin_times_day_2.dt20150527combat as day7combatwin,
    combatlose_times_day_2.dt20150521combat as day1combatlose,
    combatlose_times_day_2.dt20150522combat as day2combatlose,
    combatlose_times_day_2.dt20150523combat as day3combatlose,
    combatlose_times_day_2.dt20150524combat as day4combatlose,
    combatlose_times_day_2.dt20150525combat as day5combatlose,
    combatlose_times_day_2.dt20150526combat as day6combatlose,
    combatlose_times_day_2.dt20150527combat as day7combatlose,
    gameplay_day_2.dt20150521end_state_1 as day1end_state_1,
    gameplay_day_2.dt20150521end_state1 as day1end_state1,
    gameplay_day_2.dt20150521end_state2 as day1end_state2,
    gameplay_day_2.dt20150521end_state3 as day1end_state3,
    gameplay_day_2.dt20150521end_state4 as day1end_state4,
    gameplay_day_2.dt20150521end_state5 as day1end_state5,
    gameplay_day_2.dt20150521end_state6 as day1end_state6,
    gameplay_day_2.dt20150521end_state7 as day1end_state7,
    gameplay_day_2.dt20150522end_state_1 as day2end_state_1,
    gameplay_day_2.dt20150522end_state1 as day2end_state1,
    gameplay_day_2.dt20150522end_state2 as day2end_state2,
    gameplay_day_2.dt20150522end_state3 as day2end_state3,
    gameplay_day_2.dt20150522end_state4 as day2end_state4,
    gameplay_day_2.dt20150522end_state5 as day2end_state5,
    gameplay_day_2.dt20150522end_state6 as day2end_state6,
    gameplay_day_2.dt20150522end_state7 as day2end_state7,
    gameplay_day_2.dt20150523end_state_1 as day3end_state_1,
    gameplay_day_2.dt20150523end_state1 as day3end_state1,
    gameplay_day_2.dt20150523end_state2 as day3end_state2,
    gameplay_day_2.dt20150523end_state3 as day3end_state3,
    gameplay_day_2.dt20150523end_state4 as day3end_state4,
    gameplay_day_2.dt20150523end_state5 as day3end_state5,
    gameplay_day_2.dt20150523end_state6 as day3end_state6,
    gameplay_day_2.dt20150523end_state7 as day3end_state7,
    gameplay_day_2.dt20150524end_state_1 as day4end_state_1,
    gameplay_day_2.dt20150524end_state1 as day4end_state1,
    gameplay_day_2.dt20150524end_state2 as day4end_state2,
    gameplay_day_2.dt20150524end_state3 as day4end_state3,
    gameplay_day_2.dt20150524end_state4 as day4end_state4,
    gameplay_day_2.dt20150524end_state5 as day4end_state5,
    gameplay_day_2.dt20150524end_state6 as day4end_state6,
    gameplay_day_2.dt20150524end_state7 as day4end_state7,
    gameplay_day_2.dt20150525end_state_1 as day5end_state_1,
    gameplay_day_2.dt20150525end_state1 as day5end_state1,
    gameplay_day_2.dt20150525end_state2 as day5end_state2,
    gameplay_day_2.dt20150525end_state3 as day5end_state3,
    gameplay_day_2.dt20150525end_state4 as day5end_state4,
    gameplay_day_2.dt20150525end_state5 as day5end_state5,
    gameplay_day_2.dt20150525end_state6 as day5end_state6,
    gameplay_day_2.dt20150525end_state7 as day5end_state7,
    gameplay_day_2.dt20150526end_state_1 as day6end_state_1,
    gameplay_day_2.dt20150526end_state1 as day6end_state1,
    gameplay_day_2.dt20150526end_state2 as day6end_state2,
    gameplay_day_2.dt20150526end_state3 as day6end_state3,
    gameplay_day_2.dt20150526end_state4 as day6end_state4,
    gameplay_day_2.dt20150526end_state5 as day6end_state5,
    gameplay_day_2.dt20150526end_state6 as day6end_state6,
    gameplay_day_2.dt20150526end_state7 as day6end_state7,
    gameplay_day_2.dt20150527end_state_1 as day7end_state_1,
    gameplay_day_2.dt20150527end_state1 as day7end_state1,
    gameplay_day_2.dt20150527end_state2 as day7end_state2,
    gameplay_day_2.dt20150527end_state3 as day7end_state3,
    gameplay_day_2.dt20150527end_state4 as day7end_state4,
    gameplay_day_2.dt20150527end_state5 as day7end_state5,
    gameplay_day_2.dt20150527end_state6 as day7end_state6,
    gameplay_day_2.dt20150527end_state7 as day7end_state7,
    career.career as career


from
    role_id_test
left join
    login_day_2
on
    role_id_test.role_id = login_day_2.role_id
left join
    items_buy_day_2
on
    role_id_test.role_id = items_buy_day_2.role_id
left join
    items_buy_day_free_2
on
    role_id_test.role_id = items_buy_day_free_2.role_id
left join
    role_cash_2
on
    role_id_test.role_id = role_cash_2.role_id
left join
    weapons_kaikong_day_2
on
    role_id_test.role_id = weapons_kaikong_day_2.role_id
left join
    weapons_xiangqian_day_list_2
on
    role_id_test.role_id = weapons_xiangqian_day_list_2.role_id
left join
    ronglian_times_day_2
on
    role_id_test.role_id = ronglian_times_day_2.role_id
left join
    ronglianbaoshi_times_day_2
on
    role_id_test.role_id = ronglianbaoshi_times_day_2.role_id
left join
    task_times_day_2
on
    role_id_test.role_id = task_times_day_2.role_id
left join
    battlewin_times_day_2
on
    role_id_test.role_id = battlewin_times_day_2.role_id
left join
    battlelose_times_day_2
on
    role_id_test.role_id = battlelose_times_day_2.role_id
left join
    combatwin_times_day_2
on
    role_id_test.role_id = combatwin_times_day_2.role_id
left join
    combatlose_times_day_2
on
    role_id_test.role_id = combatlose_times_day_2.role_id
left join
    gameplay_day_2
on
    role_id_test.role_id = gameplay_day_2.role_id
left join
    career
on
    role_id_test.role_id = career.role_id


insert overwrite local directory "/home/ysy/Documents/train_data"
ROW FORMAT SERDE 'org.apache.hadoop.hive.serde2.lazy.LazySimpleSerDe'
WITH SERDEPROPERTIES (
'field.delim'='\t',
'serialization.format'= '',
'serialization.null.format'=''  
) STORED AS TEXTFILE
select * from train_data_;

insert overwrite local directory "/home/ysy/Documents/test_data"
ROW FORMAT SERDE 'org.apache.hadoop.hive.serde2.lazy.LazySimpleSerDe'
WITH SERDEPROPERTIES (
'field.delim'='\t',
'serialization.format'= '',
'serialization.null.format'=''  
) STORED AS TEXTFILE
select * from test_data_;


